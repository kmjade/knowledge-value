---
tags:
  - opencode
  - ollama
  - batch
  - automation
  - workflow
created: <% tp.file.creation_date() %>
---

# âš¡ OpenCode æ‰¹å¤„ç†æ“ä½œ / Batch Operations

## ğŸ¯ æ“ä½œç±»å‹ / Operation Type

<%*
const batchTypes = [
    'ğŸ“ æ‰¹é‡æ–‡ä»¶åˆ†æ - Bulk file analysis',
    'ğŸ”„ æ‰¹é‡æ ¼å¼è½¬æ¢ - Bulk format conversion',
    'ğŸ·ï¸ æ‰¹é‡æ ‡ç­¾ç”Ÿæˆ - Bulk tag generation',
    'ğŸ“Š æ‰¹é‡æ•°æ®æå– - Bulk data extraction',
    'ğŸ”— æ‰¹é‡é“¾æ¥æ£€æŸ¥ - Bulk link verification',
    'ğŸ› ï¸ æ‰¹é‡ä»£ç é‡æ„ - Bulk code refactoring',
    'ğŸ“ æ‰¹é‡æ–‡æ¡£ç”Ÿæˆ - Bulk documentation generation',
    'ğŸ§ª æ‰¹é‡æµ‹è¯•ç”Ÿæˆ - Bulk test generation'
];

const batchValues = [
    'file-analysis', 'format-conversion', 'tag-generation', 
    'data-extraction', 'link-verification', 'code-refactoring',
    'documentation-generation', 'test-generation'
];

const selectedBatchType = await tp.system.suggester(
    batchTypes,
    batchValues,
    false,
    'é€‰æ‹©æ‰¹å¤„ç†ç±»å‹ / Select batch operation type:'
);
-%>

### ğŸ“‹ é€‰æ‹©çš„æ“ä½œ / Selected Operation
**ç±»å‹**: `<% selectedBatchType %>`
**åç§°**: `<% batchTypes[batchValues.indexOf(selectedBatchType)] %>`

---

## ğŸ“‚ ç›®æ ‡æ–‡ä»¶é€‰æ‹© / Target File Selection

### é€‰æ‹©èŒƒå›´ / Selection Scope

<%*
const scopes = [
    'ğŸ“ å½“å‰æ–‡ä»¶å¤¹ - Current folder',
    'ğŸŒ æ•´ä¸ªä»“åº“ - Entire vault', 
    'ğŸ·ï¸ æŒ‰æ ‡ç­¾ç­›é€‰ - Filter by tag',
    'ğŸ“… æŒ‰æ—¥æœŸç­›é€‰ - Filter by date',
    'ğŸ”¤ æŒ‰æ–‡ä»¶ç±»å‹ç­›é€‰ - Filter by file type',
    'ğŸ“‹ è‡ªå®šä¹‰æ–‡ä»¶åˆ—è¡¨ - Custom file list'
];

const scopeValues = ['folder', 'vault', 'tag', 'date', 'filetype', 'custom'];

const selectedScope = await tp.system.suggester(
    scopes,
    scopeValues,
    false,
    'é€‰æ‹©å¤„ç†èŒƒå›´ / Select processing scope:'
);

let filterCriteria = "";
let dataviewQuery = "";

// æ ¹æ®é€‰æ‹©èŒƒå›´è®¾ç½®æŸ¥è¯¢æ¡ä»¶
switch (selectedScope) {
    case 'folder':
        const currentFolder = tp.file.folder;
        dataviewQuery = `FROM "${currentFolder}"`;
        break;
        
    case 'tag':
        filterCriteria = await tp.system.prompt("è¾“å…¥æ ‡ç­¾ / Enter tag:");
        dataviewQuery = `FROM #${filterCriteria}`;
        break;
        
    case 'date':
        filterCriteria = await tp.system.prompt("è¾“å…¥æ—¥æœŸèŒƒå›´ (YYYY-MM-DD) / Enter date range:");
        const dateRange = filterCriteria.includes('..') ? filterCriteria : `>= ${filterCriteria}`;
        dataviewQuery = `FROM "" WHERE file.mday >= date("${dateRange}")`;
        break;
        
    case 'filetype':
        const fileTypes = ['.md', '.py', '.js', '.ts', '.java', '.cpp', '.go'];
        const selectedType = await tp.system.suggester(fileTypes, fileTypes, false, 'é€‰æ‹©æ–‡ä»¶ç±»å‹:');
        filterCriteria = selectedType;
        dataviewQuery = `WHERE contains(file.path, "${selectedType}")`;
        break;
        
    case 'custom':
        const customFiles = await tp.system.prompt("è¾“å…¥æ–‡ä»¶è·¯å¾„åˆ—è¡¨ (ç”¨é€—å·åˆ†éš”) / Enter file paths (comma-separated):");
        filterCriteria = customFiles;
        break;
        
    default:
        dataviewQuery = '';
}
-%>

| è®¾ç½® / Setting | å€¼ / Value |
|---------------|-----------|
| **èŒƒå›´ / Scope** | `<% scopes[scopeValues.indexOf(selectedScope)] %>` |
| **ç­›é€‰æ¡ä»¶ / Filter** | `<% filterCriteria || "æ— " %>` |

---

## ğŸ“Š ç”Ÿæˆçš„DataviewæŸ¥è¯¢ / Generated Dataview Query

<details>
<summary>æŸ¥è¯¢é¢„è§ˆ / Query Preview</summary>

```dataview
TABLE file.link as "æ–‡ä»¶", file.mtime as "ä¿®æ”¹æ—¶é—´", file.size as "å¤§å°"
<% dataviewQuery ? dataviewQuery : 'FROM ""' %>
SORT file.mtime DESC
LIMIT 20
```

**æŸ¥è¯¢è¯´æ˜ / Query Explanation**:
<%*
const explanations = {
    'folder': 'åˆ—å‡ºå½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶',
    'tag': `åˆ—å‡ºåŒ…å«æ ‡ç­¾ #${filterCriteria} çš„æ–‡ä»¶`,
    'date': `åˆ—å‡ºä¿®æ”¹æ—¥æœŸåœ¨ ${filterCriteria} ä¹‹åçš„æ–‡ä»¶`,
    'filetype': `åˆ—å‡ºæ‰€æœ‰ ${filterCriteria} æ–‡ä»¶`,
    'custom': 'å¤„ç†ç”¨æˆ·æŒ‡å®šçš„æ–‡ä»¶åˆ—è¡¨',
    'vault': 'å¤„ç†æ•´ä¸ªä»“åº“ä¸­çš„æ‰€æœ‰æ–‡ä»¶'
};
-%>
`<% explanations[selectedScope] %>`

</details>

---

## ğŸ¤– æ‰¹å¤„ç†é…ç½® / Batch Configuration

### æ¨¡å‹é€‰æ‹© / Model Selection

<%*
// æ£€æŸ¥å¯ç”¨æ¨¡å‹
const modelStatus = await tp.user.checkLocalModels();
const availableModels = modelStatus.status === 'available' 
    ? modelStatus.models.map(m => m.name)
    : ['qwen2.5-coder:7b', 'qwen2.5:7b', 'mistral-nemo:12b'];

const selectedModel = await tp.system.suggester(
    availableModels,
    availableModels,
    false,
    'é€‰æ‹©æ‰¹å¤„ç†æ¨¡å‹ / Select batch processing model:'
);

// æ‰¹å¤„ç†å¤§å°è®¾ç½®
const batchSize = await tp.system.prompt(
    "æ‰¹å¤„ç†å¤§å° (å»ºè®® 5-20) / Batch size (recommended 5-20):",
    "10"
);

const batchSizeNum = parseInt(batchSize) || 10;

// å¹¶å‘è®¾ç½®
const concurrency = await tp.system.prompt(
    "å¹¶å‘æ•°é‡ (å»ºè®® 1-3) / Concurrency (recommended 1-3):",
    "2"
);

const concurrencyNum = parseInt(concurrency) || 2;
-%>

| é…ç½®é¡¹ / Option | å€¼ / Value | è¯´æ˜ / Description |
|-----------------|-----------|-------------------|
| **ä½¿ç”¨æ¨¡å‹ / Model** | `<% selectedModel %>` | æ‰¹å¤„ç†ä½¿ç”¨çš„AIæ¨¡å‹ |
| **æ‰¹å¤„ç†å¤§å° / Batch Size** | `<% batchSizeNum %>` | æ¯æ‰¹å¤„ç†çš„æ–‡ä»¶æ•°é‡ |
| **å¹¶å‘æ•° / Concurrency** | `<% concurrencyNum %>` | åŒæ—¶å¤„ç†çš„æ‰¹æ¬¡æ•° |
| **é¢„è®¡æ€»æ—¶é—´ / Est. Total Time** | `<% Math.ceil(batchSizeNum / concurrencyNum) * 30 %>-<% Math.ceil(batchSizeNum / concurrencyNum) * 60 %>ç§’ | æ ¹æ®æ¨¡å‹æ€§èƒ½ä¼°ç®— |

---

## ğŸ“‹ ç”Ÿæˆçš„æ‰¹å¤„ç†è„šæœ¬ / Generated Batch Script

<%*
// æ ¹æ®æ“ä½œç±»å‹ç”Ÿæˆè„šæœ¬
let scriptContent = '';
let scriptName = '';
let fileExtension = '.sh'; // é»˜è®¤ä¸ºshellè„šæœ¬

switch (selectedBatchType) {
    case 'file-analysis':
        scriptName = 'æ‰¹é‡æ–‡ä»¶åˆ†æ';
        scriptContent = `#!/bin/bash
# æ‰¹é‡æ–‡ä»¶åˆ†æè„šæœ¬ / Bulk File Analysis Script
# Generated by OpenCode + Ollama Integration

set -e  # é‡åˆ°é”™è¯¯æ—¶é€€å‡º

echo "ğŸš€ å¼€å§‹æ‰¹é‡æ–‡ä»¶åˆ†æ..."
echo "ğŸ“Š é…ç½®ä¿¡æ¯:"
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo "   å¹¶å‘æ•°: ${concurrencyNum}"
echo ""

# å¤„ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ“ [æ‰¹${batch_id}] åˆ†ææ–‡ä»¶: $file"
    
    # ä½¿ç”¨OpenCodeåˆ†ææ–‡ä»¶
    opencode run "åˆ†æè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€ç»“æ„ã€å…³é”®ä¿¡æ¯å’Œæ½œåœ¨æ”¹è¿›ç‚¹ï¼Œæä¾›è¯¦ç»†çš„åˆ†ææŠ¥å‘Š" \\
        --model ollama/${selectedModel} \\
        --timeout 180 \\
        "$file" > "${file}.analysis.md" 2>&1
    
    if [ $? -eq 0 ]; then
        echo "âœ… [æ‰¹${batch_id}] å®Œæˆ: $file"
    else
        echo "âŒ [æ‰¹${batch_id}] å¤±è´¥: $file"
        echo "   é”™è¯¯ä¿¡æ¯å·²ä¿å­˜åˆ° ${file}.error.log"
    fi
    
    echo ""
}

# ä¸»å¤„ç†é€»è¾‘
batch_id=1
file_count=0

${selectedScope === 'custom' ? `
# å¤„ç†è‡ªå®šä¹‰æ–‡ä»¶åˆ—è¡¨
files="${filterCriteria}"
for file in \$(echo "$files" | tr ',' '\\n'); do
    if [ -f "$file" ]; then
        process_file "$file" "$batch_id"
        
        file_count=$((file_count + 1))
        if [ $((file_count % ${batchSizeNum})) -eq 0 ]; then
            batch_id=$((batch_id + 1))
            
            # ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
            wait
            echo "â³ ç­‰å¾…ä¸‹ä¸€æ‰¹æ¬¡..."
            sleep 5
        fi
        
        # å¹¶å‘æ§åˆ¶
        if [ $((file_count % ${concurrencyNum})) -eq 0 ]; then
            wait
        fi
    fi
done
` : `
# ä½¿ç”¨findæŸ¥æ‰¾æ–‡ä»¶
find_command="find . -name '*.md' -type f"

${selectedScope === 'folder' ? `find_command="find '${tp.file.folder}' -name '*.md' -type f"` : ''}
${selectedScope === 'tag' ? `# æ ¹æ®æ ‡ç­¾ç­›é€‰éœ€è¦æ‰‹åŠ¨å®ç°
echo "âš ï¸ åŸºäºæ ‡ç­¾çš„ç­›é€‰è¯·æ‰‹åŠ¨æä¾›æ–‡ä»¶åˆ—è¡¨"
exit 1` : ''}
${selectedScope === 'date' ? `find_command="find . -name '*.md' -type f -newermt '${filterCriteria}'"` : ''}
${selectedScope === 'filetype' ? `find_command="find . -name '${filterCriteria}' -type f"` : ''}

# æ‰§è¡ŒæŸ¥æ‰¾å’Œå¤„ç†
eval "$find_command" | head -$((${batchSizeNum} * 10)) | while read file; do
    if [ -f "$file" ]; then
        process_file "$file" "$batch_id"
        
        file_count=$((file_count + 1))
        if [ $((file_count % ${batchSizeNum})) -eq 0 ]; then
            batch_id=$((batch_id + 1))
            
            # ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
            wait
            echo "â³ ç­‰å¾…ä¸‹ä¸€æ‰¹æ¬¡..."
            sleep 5
        fi
        
        # å¹¶å‘æ§åˆ¶
        if [ $((file_count % ${concurrencyNum})) -eq 0 ]; then
            wait
        fi
    fi
done
`}

# ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
wait

echo ""
echo "ğŸ‰ æ‰¹é‡æ–‡ä»¶åˆ†æå®Œæˆï¼"
echo "ğŸ“Š å¤„ç†ç»Ÿè®¡:"
echo "   å¤„ç†æ–‡ä»¶æ•°: $file_count"
echo "   ç”ŸæˆæŠ¥å‘Šæ•°: $file_count"
echo "   æŠ¥å‘Šä½ç½®: å„æ–‡ä»¶åŒç›®å½•çš„ .analysis.md"
`;
        break;
        
    case 'tag-generation':
        scriptName = 'æ‰¹é‡æ ‡ç­¾ç”Ÿæˆ';
        scriptContent = `#!/bin/bash
# æ‰¹é‡æ ‡ç­¾ç”Ÿæˆè„šæœ¬ / Bulk Tag Generation Script
# Generated by OpenCode + Ollama Integration

set -e

echo "ğŸ·ï¸ å¼€å§‹æ‰¹é‡æ ‡ç­¾ç”Ÿæˆ..."
echo "ğŸ“Š é…ç½®ä¿¡æ¯:"
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo "   å¹¶å‘æ•°: ${concurrencyNum}"
echo ""

# å¤„ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ“ [æ‰¹${batch_id}] ç”Ÿæˆæ ‡ç­¾: $file"
    
    # è¯»å–æ–‡ä»¶å†…å®¹
    content=\$(cat "$file")
    
    # ä½¿ç”¨OpenCodeç”Ÿæˆæ ‡ç­¾
    tags=\$(opencode run "åŸºäºè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç”Ÿæˆ5-10ä¸ªç›¸å…³çš„æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”ï¼Œåªè¿”å›æ ‡ç­¾åˆ—è¡¨" \\
        --model ollama/${selectedModel} \\
        --timeout 120 \\
        "$file" 2>/dev/null | grep -o "[^,]*" | tr '\\n' ',' | sed 's/,$//')
    
    if [ $? -eq 0 ] && [ -n "$tags" ]; then
        # æ›´æ–°æ–‡ä»¶frontmatter
        temp_file="\${file}.tmp"
        
        # æ£€æŸ¥æ˜¯å¦å·²æœ‰frontmatter
        if grep -q "^---" "$file"; then
            # å·²æœ‰frontmatterï¼Œæ·»åŠ æ ‡ç­¾
            sed -i "/^tags:/a\\  - $tags" "$file"
        else
            # æ·»åŠ frontmatterå’Œæ ‡ç­¾
            cat > "$temp_file" << EOF
---
tags:
  - $tags
---

$content
EOF
            mv "$temp_file" "$file"
        fi
        
        echo "âœ… [æ‰¹${batch_id}] æ ‡ç­¾å·²æ·»åŠ : $tags"
    else
        echo "âŒ [æ‰¹${batch_id}] æ ‡ç­¾ç”Ÿæˆå¤±è´¥: $file"
    fi
    
    echo ""
}

# ä¸»å¤„ç†é€»è¾‘ï¼ˆåŒæ–‡ä»¶åˆ†æè„šæœ¬ï¼‰
${selectedScope === 'custom' ? `
files="${filterCriteria}"
for file in \$(echo "$files" | tr ',' '\\n'); do
    if [ -f "$file" ]; then
        process_file "$file" "1"
    fi
done
` : `
find . -name '*.md' -type f | head -$((${batchSizeNum} * 10)) | while read file; do
    process_file "$file" "1"
done
`}

wait
echo "ğŸ‰ æ‰¹é‡æ ‡ç­¾ç”Ÿæˆå®Œæˆï¼"
`;
        break;
        
    case 'code-refactoring':
        scriptName = 'æ‰¹é‡ä»£ç é‡æ„';
        scriptContent = `#!/bin/bash
# æ‰¹é‡ä»£ç é‡æ„è„šæœ¬ / Bulk Code Refactoring Script
# Generated by OpenCode + Ollama Integration

set -e

echo "ğŸ› ï¸ å¼€å§‹æ‰¹é‡ä»£ç é‡æ„..."
echo "ğŸ“Š é…ç½®ä¿¡æ¯:"
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo ""

# å¤„ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ”§ [æ‰¹${batch_id}] é‡æ„æ–‡ä»¶: $file"
    
    # åˆ›å»ºå¤‡ä»½
    cp "$file" "${file}.backup"
    
    # ä½¿ç”¨OpenCodeé‡æ„ä»£ç 
    opencode run "é‡æ„è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç ï¼Œæ”¹è¿›å¯è¯»æ€§ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œä¿æŒåŠŸèƒ½ä¸å˜ï¼Œç›´æ¥è¾“å‡ºé‡æ„åçš„å®Œæ•´ä»£ç " \\
        --model ollama/${selectedModel} \\
        --timeout 300 \\
        "$file" > "${file}.refactored" 2>&1
    
    if [ $? -eq 0 ]; then
        # éªŒè¯é‡æ„ç»“æœ
        if [ -s "${file}.refactored" ]; then
            mv "${file}.refactored" "$file"
            echo "âœ… [æ‰¹${batch_id}] é‡æ„å®Œæˆ: $file"
        else
            echo "âŒ [æ‰¹${batch_id}] é‡æ„ç»“æœä¸ºç©º: $file"
            mv "${file}.backup" "$file"
        fi
    else
        echo "âŒ [æ‰¹${batch_id}] é‡æ„å¤±è´¥: $file"
        mv "${file}.backup" "$file"
        rm -f "${file}.refactored"
    fi
    
    echo ""
}

# å¤„ç†ä»£ç æ–‡ä»¶
find . -name '*.py' -o -name '*.js' -o -name '*.ts' -o -name '*.java' | head -$((${batchSizeNum} * 5)) | while read file; do
    process_file "$file" "1"
done

wait
echo "ğŸ‰ æ‰¹é‡ä»£ç é‡æ„å®Œæˆï¼"
echo "ğŸ“Š å¤‡ä»½æ–‡ä»¶ä½ç½®: *.backup"
`;
        break;
        
    default:
        scriptName = 'é€šç”¨æ‰¹å¤„ç†è„šæœ¬';
        scriptContent = `#!/bin/bash
# é€šç”¨æ‰¹å¤„ç†è„šæœ¬ / Generic Batch Processing Script
# Generated by OpenCode + Ollama Integration

set -e

echo "âš¡ å¼€å§‹æ‰¹å¤„ç†æ“ä½œ..."
echo "ğŸ“Š é…ç½®ä¿¡æ¯:"
echo "   æ“ä½œç±»å‹: ${selectedBatchType}"
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo ""

# é€šç”¨å¤„ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ“ [æ‰¹${batch_id}] å¤„ç†æ–‡ä»¶: $file"
    
    # æ ¹æ®æ“ä½œç±»å‹æ‰§è¡Œä¸åŒçš„OpenCodeå‘½ä»¤
    case "${selectedBatchType}" in
        "data-extraction")
            opencode run "ä»æ–‡ä»¶ä¸­æå–å…³é”®æ•°æ®å’Œä¿¡æ¯ï¼Œç»“æ„åŒ–è¾“å‡º" --model ollama/${selectedModel} "$file"
            ;;
        "documentation-generation")
            opencode run "ä¸ºè¿™ä¸ªæ–‡ä»¶ç”Ÿæˆå®Œæ•´çš„æ–‡æ¡£è¯´æ˜" --model ollama/${selectedModel} "$file"
            ;;
        "test-generation")
            opencode run "ä¸ºè¿™ä¸ªä»£ç æ–‡ä»¶ç”Ÿæˆå…¨é¢çš„å•å…ƒæµ‹è¯•" --model ollama/${selectedModel} "$file"
            ;;
        "format-conversion")
            opencode run "å°†æ–‡ä»¶å†…å®¹è½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼" --model ollama/${selectedModel} "$file"
            ;;
        *)
            opencode run "å¯¹æ–‡ä»¶æ‰§è¡Œ${selectedBatchType}æ“ä½œ" --model ollama/${selectedModel} "$file"
            ;;
    esac
    
    echo "âœ… [æ‰¹${batch_id}] å¤„ç†å®Œæˆ: $file"
    echo ""
}

# æ‰§è¡Œå¤„ç†
find . -name '*.md' -type f | head -$((${batchSizeNum} * 5)) | while read file; do
    process_file "$file" "1"
done

wait
echo "ğŸ‰ æ‰¹å¤„ç†æ“ä½œå®Œæˆï¼"
`;
}

// è®¾ç½®è„šæœ¬æ–‡ä»¶å
scriptFileName = `${tp.date.now('YYYY-MM-DD')}-${scriptName.replaceAll(' ', '-')}.sh`;
-%>

<details>
<summary>ğŸ“„ å®Œæ•´è„šæœ¬ / Complete Script</summary>

```bash
<% scriptContent %>
```

</details>

---

## ğŸ“‹ æ‰§è¡Œè®¡åˆ’ / Execution Plan

### é˜¶æ®µ 1: å‡†å¤‡å·¥ä½œ / Phase 1: Preparation

| ä»»åŠ¡ / Task | çŠ¶æ€ / Status | å¤‡æ³¨ / Notes |
|-----------|-------------|-------------|
| [ ] æ£€æŸ¥OllamaæœåŠ¡çŠ¶æ€ | â³ å¾…æ‰§è¡Œ | `ollama serve` |
| [ ] éªŒè¯æ¨¡å‹å¯ç”¨æ€§ | â³ å¾…æ‰§è¡Œ | `ollama list` |
| [ ] å¤‡ä»½é‡è¦æ–‡ä»¶ | â³ å¾…æ‰§è¡Œ | åˆ›å»ºæ–‡ä»¶å¤‡ä»½ |
| [ ] è®¾ç½®æ‰§è¡Œæƒé™ | â³ å¾…æ‰§è¡Œ | `chmod +x script.sh` |

### é˜¶æ®µ 2: æ‰§è¡Œå¤„ç† / Phase 2: Execution

| æ­¥éª¤ / Step | å‘½ä»¤ / Command | é¢„æœŸæ—¶é—´ / Est. Time |
|-------------|----------------|-------------------|
| **1. ä¿å­˜è„šæœ¬** | åˆ›å»º `<% scriptFileName %>` æ–‡ä»¶ | 1åˆ†é’Ÿ |
| **2. è®¾ç½®æƒé™** | `chmod +x <% scriptFileName %>` | 10ç§’ |
| **3. æ‰§è¡Œè„šæœ¬** | `./<% scriptFileName %>` | `<% Math.ceil(batchSizeNum / concurrencyNum) * 60 %>ç§’ |
| **4. ç›‘æ§è¿›åº¦** | è§‚å¯Ÿç»ˆç«¯è¾“å‡º | æŒç»­ |

### é˜¶æ®µ 3: éªŒè¯ç»“æœ / Phase 3: Verification

| æ£€æŸ¥é¡¹ / Check Item | éªŒè¯æ–¹æ³• / Verification Method |
|-------------------|---------------------------|
| **å¤„ç†å®Œæˆåº¦** | æ£€æŸ¥è¾“å‡ºæ–‡ä»¶æ•°é‡ |
| **ç»“æœè´¨é‡** | æŸ¥çœ‹ç”Ÿæˆçš„å†…å®¹è´¨é‡ |
| **æ–‡ä»¶å®Œæ•´æ€§** | ç¡®è®¤åŸå§‹æ–‡ä»¶æœªæŸå |
| **å¤‡ä»½å®Œæ•´æ€§** | éªŒè¯å¤‡ä»½æ–‡ä»¶å­˜åœ¨ |

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®® / Performance Optimization

### ğŸš€ æ‰§è¡Œä¼˜åŒ–
```bash
# 1. è®¾ç½®ç¯å¢ƒå˜é‡ä¼˜åŒ–æ€§èƒ½
export OLLAMA_NUM_PARALLEL=4          # å¢åŠ å¹¶è¡Œå¤„ç†
export OLLAMA_MAX_LOADED_MODELS=2      # é¢„åŠ è½½æ¨¡å‹
export OLLAMA_GPU_MEMORY_FRACTION=0.8  # GPUå†…å­˜åˆ†é…

# 2. ä½¿ç”¨screenåå°æ‰§è¡Œ
screen -S opencode-batch ./<% scriptFileName %>

# 3. ç›‘æ§ç³»ç»Ÿèµ„æº
htop           # CPUå’Œå†…å­˜ç›‘æ§
nvidia-smi      # GPUç›‘æ§
iotop           # I/Oç›‘æ§
```

### ğŸ“Š èµ„æºç®¡ç†
<%*
// æ ¹æ®é…ç½®è®¡ç®—èµ„æºéœ€æ±‚
const estimatedMemoryPerModel = {
    'qwen2.5-coder:14b': 14000,
    'qwen2.5-coder:7b': 7000,
    'qwen2.5:7b': 7000,
    'mistral-nemo:12b': 12000
};

const modelMemory = estimatedMemoryPerModel[selectedModel] || 8000;
const totalMemoryNeeded = modelMemory * concurrencyNum;
-%>

| èµ„æº / Resource | é¢„ä¼°éœ€æ±‚ / Estimated Need | å»ºè®® / Recommendation |
|----------------|-------------------------|-------------------|
| **GPUå†…å­˜ / GPU VRAM** | `<% Math.round(totalMemoryNeeded / 1024) %>GB` | ç¡®ä¿æœ‰è¶³å¤Ÿçš„GPUå†…å­˜ |
| **ç³»ç»Ÿå†…å­˜ / System RAM** | `<% Math.round(totalMemoryNeeded * 1.5 / 1024) %>GB` | é¢„ç•™é¢å¤–ç©ºé—´ |
| **å¹¶å‘è¿›ç¨‹ / Concurrent Processes** | `<% concurrencyNum %>` | æ ¹æ®ç¡¬ä»¶è°ƒæ•´ |
| **ç£ç›˜ç©ºé—´ / Disk Space** | `<% batchSizeNum * 10 %>MB` | ç”¨äºè¾“å‡ºæ–‡ä»¶ |

---

## ğŸ“¤ ç»“æœæ±‡æ€» / Results Summary

> [!note] ğŸ“Š æ‰¹å¤„ç†ç»“æœæ±‡æ€» / Batch Processing Results Summary
> åœ¨æ­¤æ±‡æ€»æ‰€æœ‰æ‰¹å¤„ç†æ“ä½œçš„ç»“æœå’Œç»Ÿè®¡ä¿¡æ¯

<details>
<summary>ç»“æœç»Ÿè®¡æ¨¡æ¿ / Results Statistics Template</summary>

### ğŸ“Š å¤„ç†ç»Ÿè®¡ / Processing Statistics
- **å¼€å§‹æ—¶é—´**: 
- **ç»“æŸæ—¶é—´**: 
- **æ€»å¤„ç†æ—¶é—´**: 
- **å¤„ç†æ–‡ä»¶æ€»æ•°**: 
- **æˆåŠŸå¤„ç†æ•°**: 
- **å¤±è´¥å¤„ç†æ•°**: 
- **æˆåŠŸç‡**: 

### ğŸ“‹ å¤±è´¥æ–‡ä»¶åˆ—è¡¨ / Failed Files List
| æ–‡ä»¶å / Filename | é”™è¯¯åŸå›  / Error Reason | é‡è¯•çŠ¶æ€ / Retry Status |
|------------------|-----------------------|-----------------------|

### ğŸ¯ è´¨é‡è¯„ä¼° / Quality Assessment
| è¯„ä¼°é¡¹ / Assessment Item | è¯„åˆ† / Score | å¤‡æ³¨ / Comments |
|------------------------|-------------|-----------------|
| **å†…å®¹å‡†ç¡®æ€§** | | |
| **æ ¼å¼ä¸€è‡´æ€§** | | |
| **å®Œæ•´æ€§** | | |
| **å®ç”¨æ€§** | | |

### ğŸ”„ åç»­è¡ŒåŠ¨ / Follow-up Actions
- [ ] æ‰‹åŠ¨å¤„ç†å¤±è´¥æ–‡ä»¶
- [ ] è´¨é‡æ£€æŸ¥å’Œä¿®æ­£
- [ ] æ•´åˆç»“æœåˆ°ä¸»é¡¹ç›®
- [ ] æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œå¤‡ä»½
- [ ] æ›´æ–°æ–‡æ¡£å’Œç´¢å¼•

</details>

---

## âš ï¸ æ³¨æ„äº‹é¡¹ / Important Notes

> [!warning] ğŸ”’ å®‰å…¨æé†’ / Security Reminder
> - æ‰¹å¤„ç†æ“ä½œä¼šä¿®æ”¹å¤§é‡æ–‡ä»¶ï¼Œ**åŠ¡å¿…å¤‡ä»½**
> - å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒå…ˆè¿è¡Œè„šæœ¬
> - ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨ï¼Œé¿å…è¿‡è½½
> - å®šæœŸä¿å­˜ä¸­é—´ç»“æœ

> [!tip] ğŸ’¡ æ•ˆç‡æç¤º / Efficiency Tips
> - é€‰æ‹©åˆé€‚çš„æ‰¹å¤„ç†å¤§å°ï¼Œé¿å…å†…å­˜ä¸è¶³
> - æ ¹æ®ç¡¬ä»¶æ€§èƒ½è°ƒæ•´å¹¶å‘æ•°é‡
> - åœ¨ç©ºé—²æ—¶é—´æ‰§è¡Œå¤§å‹æ‰¹å¤„ç†ä»»åŠ¡
> - ä½¿ç”¨screenæˆ–tmuxé˜²æ­¢ä¸­æ–­

> [!info] ğŸ“ˆ æ€§èƒ½ç›‘æ§ / Performance Monitoring
> - ä½¿ç”¨`top`æˆ–`htop`ç›‘æ§CPUå’Œå†…å­˜
> - ä½¿ç”¨`nvidia-smi`ç›‘æ§GPUä½¿ç”¨æƒ…å†µ
> - å…³æ³¨å¤„ç†é€Ÿåº¦ï¼ŒåŠæ—¶è°ƒæ•´é…ç½®
> - è®°å½•æ¯æ¬¡æ‰¹å¤„ç†çš„æ€§èƒ½æ•°æ®

---

## ğŸ”— ç›¸å…³èµ„æº / Related Resources

### ğŸ“– å‚è€ƒæ–‡æ¡£
- **[OpenCodeæ‰¹å¤„ç†æ–‡æ¡£](https://opencode.ai/docs/batch-processing)** - æ‰¹å¤„ç†ä½¿ç”¨æŒ‡å—
- **[Shellè„šæœ¬æœ€ä½³å®è·µ](https://google.github.io/styleguide/shellguide.html)** - è„šæœ¬ç¼–å†™è§„èŒƒ
- **[Ollamaæ€§èƒ½ä¼˜åŒ–](https://github.com/ollama/ollama/blob/main/docs/faq.md)** - æ¨¡å‹ä¼˜åŒ–æŠ€å·§

### ğŸ› ï¸ å·¥å…·æ¨è
- **[GNU Parallel](https://www.gnu.org/software/parallel/)** - å¹¶è¡Œæ‰§è¡Œå·¥å…·
- **[jq](https://stedolan.github.io/jq/)** - JSONæ•°æ®å¤„ç†
- **[ripgrep](https://github.com/BurntSushi/ripgrep)** - å¿«é€Ÿæ–‡ä»¶æœç´¢

---

*æ­¤æ‰¹å¤„ç†æ¨¡æ¿åŸºäºOpenCode + Ollamaæœ€ä½³å®è·µè®¾è®¡ / This batch processing template is designed based on OpenCode + Ollama best practices*