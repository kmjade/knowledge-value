---
title: 故障排除与维护
tags: [ollama, troubleshooting]
---

# 故障排除与维护

## 1. 常规检查清单
| 项目 | 检查要点 |
|------|----------|
| 服务状态 | `ollama status` 是否显示 `ready` |
| 端口占用 | `netstat -ano \| find "11434"` 检查冲突 |
| 磁盘空间 | 确认模型目录至少有 20 GB 空闲 |
| 环境变量 | `OLLAMA_HOST`、`OLLAMA_PORT` 是否设置正确 |
| 权限 | 运行用户是否有写入模型目录的权限 |

## 2. 日志分析
- 默认日志文件位于 `~/.ollama/ollama.log`。使用以下命令查看最新 100 行：
```bash
tail -n 100 ~/.ollama/ollama.log
```
- 常见错误关键字：`BindError`, `OutOfMemory`, `ModelNotFound`。

## 3. 常见错误及解决方案
### a. `BindError: address already in use`
- **原因**：端口已被其他进程占用。
- **解决**：修改 `config.yaml` 中的 `port`，或停止占用进程。

### b. `OutOfMemoryError`
- **原因**：模型过大或系统内存不足。
- **解决**：
  1. 使用更小的模型（如 `phi`）。
  2. 启用模型量化：在 `config.yaml` 添加 `quantize: true`。
  3. 增加系统 swap 空间。

### c. `ModelNotFound`
- **原因**：请求的模型名称错误或未下载。
- **解决**：运行 `ollama list` 检查已下载模型，确认请求体中的 `model` 字段匹配。

## 4. 性能调优
- **GPU 加速**：在 `config.yaml` 中启用 `gpu: true`，并确保已安装对应驱动（NVIDIA CUDA）。
- **线程数**：通过环境变量 `OLLAMA_THREADS` 控制并发线程，默认值为 CPU 核心数。
- **缓存**：开启 `cache: true` 可缓存常用 token，提升响应速度。

## 5. 自动重启策略（Linux 示例）
创建系统服务以确保 Ollama 崩溃后自动恢复：
```ini
[Unit]
Description=Ollama Service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/ollama serve
Restart=on-failure
RestartSec=5
User=youruser

[Install]
WantedBy=multi-user.target
```
保存为 `/etc/systemd/system/ollama.service`，然后执行：
```bash
sudo systemctl daemon-reload
sudo systemctl enable ollama
sudo systemctl start ollama
```

## 6. 备份与恢复
- **备份模型**：复制 `~/.ollama/models/` 目录到安全位置。
- **恢复**：将备份目录粘贴回同路径，确保文件权限一致。

> 📌 **提示**：在 Obsidian 中使用 `[[故障排除与维护]]` 页面进行记录，结合 Dataview 可生成最近故障统计表。
