---
title: 故障排除与維護
tags: [ollama, troubleshooting]
---

# 故障排除与維護

## 1. 常规檢查清單
| 專案 | 檢查要點 |
|------|----------|
# 顯示
| 端口占用 | `netstat -ano \| find "11434"` 檢查冲突 |
| 磁碟空間 | 確認模型目錄至少有 20 GB 空闲 |
| 環境变量 | `OLLAMA_HOST`、`OLLAMA_PORT` 是否設置正确 |
| 权限 | 運行使用者是否有寫入模型目錄的权限 |

# 分析
# 查看
```bash
tail -n 100 ~/.ollama/ollama.log
```
- 常见错误關鍵字：`BindError`, `OutOfMemory`, `ModelNotFound`。

## 3. 常见错误及解決方案
### a. `BindError: address already in use`
- **原因**：端口已被其他进程占用。
# 修改

### b. `OutOfMemoryError`
- **原因**：模型过大或系統記憶體不足。
- **解決**：
  1. 使用更小的模型（如 `phi`）。
  2. 启用模型量化：在 `config.yaml` 新增 `quantize: true`。
  3. 增加系統 swap 空間。

### c. `ModelNotFound`
- **原因**：请求的模型名称错误或未下載。
- **解決**：運行 `ollama list` 檢查已下載模型，確認请求体中的 `model` 字段匹配。

## 4. 效能调优
- **GPU 加速**：在 `config.yaml` 中启用 `gpu: true`，并确保已安裝对应驅動程式（NVIDIA CUDA）。
- **线程数**：通過環境变量 `OLLAMA_THREADS` 控制并发线程，默认值为 CPU 核心数。
- **缓存**：开启 `cache: true` 可缓存常用 token，提升響應速度。

## 5. 自動重启策略（Linux 示例）
創建系統服务以确保 Ollama 崩溃后自動恢復：
```ini
[Unit]
Description=Ollama Service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/ollama serve
Restart=on-failure
RestartSec=5
User=youruser

[Install]
WantedBy=multi-user.target
```
儲存为 `/etc/systemd/system/ollama.service`，然后执行：
```bash
sudo systemctl daemon-reload
sudo systemctl enable ollama
sudo systemctl start ollama
```

## 6. 備份与恢復
- **備份模型**：複製 `~/.ollama/models/` 目錄到安全位置。
- **恢復**：将備份目錄貼上回同路徑，确保檔案权限一致。

> 📌 **提示**：在 Obsidian 中使用 `[[故障排除与維護]]` 頁面進行記錄，结合 Dataview 可生成最近故障統計表。
