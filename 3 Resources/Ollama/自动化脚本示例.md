---
title: 自動化腳本示例
tags: [ollama, automation]
---

# 自動化腳本示例

以下示例展示了在 **Windows PowerShell**、**macOS/Linux Bash** 与 **Python** 中使用 Ollama API 的常见自動化場景。

## 1. PowerShell：批量生成筆記摘要
```powershell
# 配置
$apiUrl = "http://localhost:11434/api/generate"
$model = "llama2"
$folder = "D:\Knowledge\knowledge-value\3 Resources\Ollama\Notes"

Get-ChildItem -Path $folder -Filter "*.md" | ForEach-Object {
    $content = Get-Content $_.FullName -Raw
    $prompt = "Summarize the following note in 3 bullet points:`n$content"
    $body = @{ model=$model; prompt=$prompt; stream=$false } | ConvertTo-Json
    $response = Invoke-RestMethod -Method Post -Uri $apiUrl -Body $body -ContentType "application/json"
    $summary = $response.response
    Add-Content -Path "$($_.FullName).summary.md" -Value "# Summary`n$summary"
    Write-Host "Summarized $($_.Name)"
}
```
> 此腳本遍历指定資料夾中的所有 Markdown 筆記，調用 Ollama 生成 3 条要點摘要，并儲存为 `<note>.summary.md`。

# 更新
```bash
#!/usr/bin/env bash
# 每日凌晨 2 点拉取最新模型（示例：mistral）
MODEL="mistral"
LOG="~/ollama_update.log"

curl -s -X POST "http://localhost:11434/api/pull" -d "{\"model\": \"$MODEL\"}" >> $LOG 2>&1

echo "$(date): Pulled $MODEL" >> $LOG
```
- 将此腳本儲存为 `pull_model.sh`，并使用 crontab 新增条目：`0 2 * * * /path/to/pull_model.sh`

## 3. Python：交互式问答助手
```python
import requests, json

API_URL = "http://localhost:11434/api/generate"
MODEL = "llama2"

def ask(prompt: str) -> str:
    payload = {
        "model": MODEL,
        "prompt": prompt,
        "stream": False,
    }
    resp = requests.post(API_URL, json=payload)
    resp.raise_for_status()
    return resp.json()["response"]

if __name__ == "__main__":
    print("Ollama Chat (type 'exit' to quit)")
    while True:
        user = input("You: ")
        if user.lower() in {"exit", "quit"}:
            break
        answer = ask(user)
        print(f"Bot: {answer}\n")
```
> 運行此腳本后即可在终端与本地模型進行对话，适合作为 Obsidian 自定义外掛的后端服务。

## 4. 自動化筆記連結生成（Obsidian 外掛腳本示例）
```javascript
// 用于 Obsidian 外掛的 TypeScript 示例
import { requestUrl } from "obsidian";

export async function generateLink(noteContent: string): Promise<string> {
  const response = await requestUrl({
    url: "http://localhost:11434/api/generate",
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "llama2",
      prompt: `Extract key concepts from the following note and return them as Obsidian wikilinks (format [[Concept]]):\n${noteContent}`,
      stream: false,
    }),
  });
  const data = JSON.parse(response.text);
  return data.response;
}
```
> 外掛調用此函数即可自動为筆記生成相關 wikilink，提升筆記互联度。

---

### 使用建議
# 管理
- 对于 **Cron** 任務，请确保 `ollama` 服务已啟動并在 PATH 中可访问。
- Python 示例依赖 `requests` 库：`pip install requests`。
- 若在 Obsidian 外掛中使用，请确保外掛已开启 **Custom JS** 功能，并在 `manifest.json` 中声明網路权限。

> 📌 **提示**：将这些腳本儲存到 `[[自動化腳本示例]]` 頁面，随时複製使用或根据实际需求進行改写。
