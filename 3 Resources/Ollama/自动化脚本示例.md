---
title: 自动化脚本示例
tags: [ollama, automation]
---

# 自动化脚本示例

以下示例展示了在 **Windows PowerShell**、**macOS/Linux Bash** 与 **Python** 中使用 Ollama API 的常见自动化场景。

## 1. PowerShell：批量生成笔记摘要
```powershell
# 配置
$apiUrl = "http://localhost:11434/api/generate"
$model = "llama2"
$folder = "D:\Knowledge\knowledge-value\3 Resources\Ollama\Notes"

Get-ChildItem -Path $folder -Filter "*.md" | ForEach-Object {
    $content = Get-Content $_.FullName -Raw
    $prompt = "Summarize the following note in 3 bullet points:`n$content"
    $body = @{ model=$model; prompt=$prompt; stream=$false } | ConvertTo-Json
    $response = Invoke-RestMethod -Method Post -Uri $apiUrl -Body $body -ContentType "application/json"
    $summary = $response.response
    Add-Content -Path "$($_.FullName).summary.md" -Value "# Summary`n$summary"
    Write-Host "Summarized $($_.Name)"
}
```
> 此脚本遍历指定文件夹中的所有 Markdown 笔记，调用 Ollama 生成 3 条要点摘要，并保存为 `<note>.summary.md`。

## 2. Bash (Linux/macOS)：定时模型更新
```bash
#!/usr/bin/env bash
# 每日凌晨 2 点拉取最新模型（示例：mistral）
MODEL="mistral"
LOG="~/ollama_update.log"

curl -s -X POST "http://localhost:11434/api/pull" -d "{\"model\": \"$MODEL\"}" >> $LOG 2>&1

echo "$(date): Pulled $MODEL" >> $LOG
```
- 将此脚本保存为 `pull_model.sh`，并使用 crontab 添加条目：`0 2 * * * /path/to/pull_model.sh`

## 3. Python：交互式问答助手
```python
import requests, json

API_URL = "http://localhost:11434/api/generate"
MODEL = "llama2"

def ask(prompt: str) -> str:
    payload = {
        "model": MODEL,
        "prompt": prompt,
        "stream": False,
    }
    resp = requests.post(API_URL, json=payload)
    resp.raise_for_status()
    return resp.json()["response"]

if __name__ == "__main__":
    print("Ollama Chat (type 'exit' to quit)")
    while True:
        user = input("You: ")
        if user.lower() in {"exit", "quit"}:
            break
        answer = ask(user)
        print(f"Bot: {answer}\n")
```
> 运行此脚本后即可在终端与本地模型进行对话，适合作为 Obsidian 自定义插件的后端服务。

## 4. 自动化笔记链接生成（Obsidian 插件脚本示例）
```javascript
// 用于 Obsidian 插件的 TypeScript 示例
import { requestUrl } from "obsidian";

export async function generateLink(noteContent: string): Promise<string> {
  const response = await requestUrl({
    url: "http://localhost:11434/api/generate",
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      model: "llama2",
      prompt: `Extract key concepts from the following note and return them as Obsidian wikilinks (format [[Concept]]):\n${noteContent}`,
      stream: false,
    }),
  });
  const data = JSON.parse(response.text);
  return data.response;
}
```
> 插件调用此函数即可自动为笔记生成相关 wikilink，提升笔记互联度。

---

### 使用建议
- 在 **PowerShell** 中运行时，请以管理员身份启动，以避免端口或文件权限问题。
- 对于 **Cron** 任务，请确保 `ollama` 服务已启动并在 PATH 中可访问。
- Python 示例依赖 `requests` 库：`pip install requests`。
- 若在 Obsidian 插件中使用，请确保插件已开启 **Custom JS** 功能，并在 `manifest.json` 中声明网络权限。

> 📌 **提示**：将这些脚本保存到 `[[自动化脚本示例]]` 页面，随时复制使用或根据实际需求进行改写。
