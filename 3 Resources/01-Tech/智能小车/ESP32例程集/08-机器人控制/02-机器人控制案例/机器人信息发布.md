---
title: 机器人信息发布
status: active
priority: medium
tags: [esp32/examples, robot-control/cases]
aliases: [机器人信息发布, 机器人数据查询]
created: 2026-02-19
modified: 2026-02-19
source: https://www.yahboom.com/public/upload/upload-html/1708329007/机器人信息发布.html
related:
  - [[MicroROS机器人控制板]]
  - [[连接microROS代理]]
  - [[机器人键盘控制]]
---

# 机器人信息发布

> 查询和发布机器人传感器数据与控制命令。

---

**注**：虚拟机需要与小车处在同一个局域网下，且ROS_DOMAIN_ID需要一致，可以查看【使用前必看】来设置板子上的IP和ROS_DOMAIN_ID。

---

## 1、程序功能说明

小车连接上代理后，会发布雷达、imu等传感器数据，可以在配套的虚拟机/树莓派5中，运行命令去查询这些信息，也可以发布速度、蜂鸣器等传感器的控制数据。

---

## 2、查询小车信息

### 2.1 启动并连接代理

以配套虚拟机为例，输入以下指令启动代理：

```bash
sudo docker run -it --rm -v /dev:/dev -v /dev/shm:/dev/shm --privileged --net=host microros/micro-ros-agent:humble udp4 --port 8090 -v4
```

![image-20240102115129150](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20240102115129150.png)

然后，打开小车开关，等待小车连接上代理，连接成功如下图所示：

![image-20231215164706528](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215164706528.png)

### 2.2 查询小车节点信息

终端输入以下指令查询节点：

```bash
ros2 node list
```

![image-20231215165454729](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215165454729.png)

然后输入以下指令查询该节点发布/订阅了哪些话题：

```bash
ros2 node info /YB_Car_Node
```

![image-20231220110334013](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231220110334013.png)

可以看出订阅的话题有：
- `/beep`：蜂鸣器控制
- `/cmd_vel`：小车速度控制
- `/servo_s1`：s1舵机云台控制
- `/servo_s2`：s1舵机云台控制

发布的话题有：
- `/imu`：imu模块数据
- `/odom`：里程计模块数据
- `/scan`：雷达模块数据

我们也可以通过查询话题命令，终端输入：

```bash
ros2 topic list
```

![image-20231220110433482](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231220110433482.png)

### 2.3 查询话题数据

查询雷达数据：

```bash
ros2 topic echo /scan
```

![image-20231215170527461](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215170527461.png)

查询imu数据：

```bash
ros2 topic echo /imu
```

![image-20231215170635077](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215170635077.png)

查询odom数据：

```bash
ros2 topic echo /odom_raw
```

![image-20231215170820806](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215170820806.png)

---

## 3、发布小车控制信息

### 3.1 控制蜂鸣器

首先查询以下蜂鸣器话题的相关信息，终端输入：

```bash
ros2 topic info /beep
```

![image-20231215171054137](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215171054137.png)

得知数据类型是std_msgs/msg/UInt16。然后输入以下指令打开蜂鸣器，终端输入：

```bash
ros2 topic pub /beep std_msgs/msg/UInt16 "data: 1"
```

![image-20231215171304563](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215171304563.png)

输入以下指令关闭蜂鸣器，终端输入：

```bash
ros2 topic pub /beep std_msgs/msg/UInt16 "data: 0"
```

![image-20231215171355932](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215171355932.png)

### 3.2 发布速度控制信息

我们假设发布小车以线速度0.5的速度，角速度0.2运动，终端输入：

```bash
ros2 topic pub /cmd_vel geometry_msgs/msg/Twist "{linear: {x: 0.5, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0.2}}"
```

![image-20231215172334672](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215172334672.png)

停车则输入：

```bash
ros2 topic pub /cmd_vel geometry_msgs/msg/Twist "{linear: {x: 0.0, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0.0}}"
```

![image-20231215172535292](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231215172535292.png)

### 3.3 控制云台舵机

这里需要注意的是s1舵机的范围是[-90,90]，s2舵机的范围是[-90,20]，超过范围的值，舵机不转动。

我们假设控制s1舵机转动30度，则终端输入：

```bash
ros2 topic pub /servo_s1 std_msgs/msg/Int32 "data: 30"
```

![image-20231220110647836](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231220110647836.png)

同理，控制s2舵机转动-30度则终端输入：

```bash
ros2 topic pub /servo_s2 std_msgs/msg/Int32 "data: -30"
```

![image-20231220110837675](https://www.yahboom.com/public/upload/upload-html/1708329007/image-20231220110837675.png)

---

## 相关文档

- [[连接microROS代理]] - 代理连接
- [[机器人键盘控制]] - 键盘控制
- [[机器人手柄控制]] - 手柄控制
