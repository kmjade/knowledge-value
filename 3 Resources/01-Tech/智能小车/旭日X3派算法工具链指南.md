---
title: æ—­æ—¥X3æ´¾ç®—æ³•å·¥å…·é“¾æŒ‡å—
tags:
  - para/resource/tech
  - æŠ€æœ¯/AI
  - æŠ€æœ¯/è¾¹ç¼˜è®¡ç®—
  - åœ°å¹³çº¿
  - æ—­æ—¥X3
  - ç®—æ³•å·¥å…·é“¾
status: active
aliases:
  - æ—­æ—¥X3å·¥å…·é“¾
  - BPUæ¨¡å‹è½¬æ¢
  - æ¨¡å‹é‡åŒ–æŒ‡å—
cssclasses:
  - resource-note
created: 2026-02-19
---

# æ—­æ—¥X3æ´¾ç®—æ³•å·¥å…·é“¾æŒ‡å—

> [!info] æŒ‡å—æ¦‚è¿°
> æœ¬æŒ‡å—è¯¦ç»†ä»‹ç»æ—­æ—¥X3æ´¾ç®—æ³•å·¥å…·é“¾çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬æ¨¡å‹å‡†å¤‡ã€éªŒè¯ã€è½¬æ¢ã€é‡åŒ–å’Œéƒ¨ç½²çš„å®Œæ•´æµç¨‹ã€‚

## ğŸ“š 6.1 ç®€ä»‹

### 6.1.1 ä½¿ç”¨æ³¨æ„äº‹é¡¹

**é‡è¦æç¤º**ï¼š
- ç®—æ³•å·¥å…·é“¾éœ€è¦åœ¨å¼€å‘æœºï¼ˆx86ï¼‰ä¸Šè¿›è¡Œæ“ä½œ
- å¼€å‘æœºéœ€è¦å®‰è£…Dockerç¯å¢ƒ
- æ¨¡å‹è½¬æ¢å’Œé‡åŒ–éœ€è¦æ»¡è¶³ç‰¹å®šçš„æ¡ä»¶
- éƒ¨åˆ†ç®—å­å¯èƒ½ä¸è¢«æ”¯æŒ

**æ”¯æŒçš„æ¨¡å‹æ ¼å¼**ï¼š
- **ONNX** - å¼€æ”¾ç¥ç»ç½‘ç»œäº¤æ¢æ ¼å¼
- **Caffe** - æ·±åº¦å­¦ä¹ æ¡†æ¶

**å·¥å…·é“¾ç‰ˆæœ¬**ï¼š
- æ³¨æ„å·¥å…·é“¾ç‰ˆæœ¬ä¸æ—­æ—¥X3æ´¾å›ºä»¶çš„å…¼å®¹æ€§
- ä½¿ç”¨åŒ¹é…çš„å·¥å…·é“¾ç‰ˆæœ¬

## ğŸš€ 6.2 å…¥é—¨æŒ‡å—

### 6.2.1 æ¦‚è¿°

æ—­æ—¥X3æ´¾ç®—æ³•å·¥å…·é“¾æä¾›å®Œæ•´çš„æ¨¡å‹éƒ¨ç½²æµç¨‹ï¼š

1. **æ¨¡å‹å‡†å¤‡** - å‡†å¤‡æµ®ç‚¹æ¨¡å‹
2. **æ¨¡å‹éªŒè¯** - éªŒè¯æ¨¡å‹å¯ç”¨æ€§
3. **æ¨¡å‹è½¬æ¢** - è½¬æ¢ä¸ºBPUæ ¼å¼
4. **æ¨¡å‹é‡åŒ–** - é‡åŒ–ä¸ºINT8æ ¼å¼
5. **æ¨¡å‹éƒ¨ç½²** - éƒ¨ç½²åˆ°æ—­æ—¥X3æ´¾

### 6.2.2 ç¯å¢ƒå®‰è£…

#### å¼€å‘æœºå‡†å¤‡

**ç³»ç»Ÿè¦æ±‚**ï¼š
- Ubuntu 18.04/20.04
- å†…å­˜ï¼šâ‰¥16GB
- ç¡¬ç›˜ï¼šâ‰¥100GB
- Dockerï¼šDocker CE 19.03+

#### ä½¿ç”¨Dockerç¯å¢ƒ

**å®‰è£…Docker**ï¼š
```bash
# æ›´æ–°aptç´¢å¼•
sudo apt-get update

# å®‰è£…ä¾èµ–
sudo apt-get install apt-transport-https ca-certificates curl software-properties-common

# æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# æ·»åŠ Docker APTæº
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

# å®‰è£…Docker CE
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io

# å¯åŠ¨Docker
sudo systemctl start docker
sudo systemctl enable docker

# éªŒè¯å®‰è£…
sudo docker run hello-world
```

**æ‹‰å–æ—­æ—¥X3æ´¾å·¥å…·é“¾é•œåƒ**ï¼š
```bash
# æ‹‰å–å·¥å…·é“¾Dockeré•œåƒ
sudo docker pull horizonai/x3pi_toolchain:latest

# éªŒè¯é•œåƒ
sudo docker images | grep x3pi_toolchain
```

### 6.2.3 å¿«é€Ÿä½“éªŒ

#### 6.2.3.1 å¼€å‘ç¯å¢ƒå‡†å¤‡

**åˆ›å»ºå·¥ä½œç›®å½•**ï¼š
```bash
mkdir -p ~/x3pi_toolchain
cd ~/x3pi_toolchain

# åˆ›å»ºå­ç›®å½•
mkdir -p models
mkdir -p calibration
mkdir -p output
```

**å‡†å¤‡æ¨¡å‹æ–‡ä»¶**ï¼š
- å°†æµ®ç‚¹æ¨¡å‹ï¼ˆONNX/Caffeï¼‰æ”¾å…¥`models`ç›®å½•
- å‡†å¤‡æ ¡å‡†æ•°æ®é›†ï¼ˆå¯é€‰ï¼Œç”¨äºPTQï¼‰

#### 6.2.3.2 æ¨¡å‹å‡†å¤‡

**æ”¯æŒçš„ç½‘ç»œç»“æ„**ï¼š

**å›¾åƒåˆ†ç±»**ï¼š
- MobileNet v1
- ResNetç³»åˆ—
- VGGç³»åˆ—

**ç›®æ ‡æ£€æµ‹**ï¼š
- YOLOv3
- YOLOv5
- FCOS
- SSDç³»åˆ—

**å›¾åƒåˆ†å‰²**ï¼š
- UNet
- DeepLabç³»åˆ—

**æ¨¡å‹æ ¼å¼è¦æ±‚**ï¼š

**ONNXæ¨¡å‹**ï¼š
- ç‰ˆæœ¬ï¼šopset version â‰¥ 11
- è¾“å…¥ï¼šå›ºå®šå°ºå¯¸æˆ–å¯å˜å°ºå¯¸
- ç®—å­ï¼šå¿…é¡»åœ¨æ”¯æŒçš„ç®—å­åˆ—è¡¨ä¸­

**Caffeæ¨¡å‹**ï¼š
- prototxtå’Œcaffemodelæ–‡ä»¶
- éƒ¨åˆ†å±‚å¯èƒ½ä¸æ”¯æŒ

#### 6.2.3.3 æ¨¡å‹éªŒè¯

**ä½¿ç”¨hb_mapper checkeréªŒè¯æ¨¡å‹**ï¼š

```bash
# å¯åŠ¨Dockerå®¹å™¨
sudo docker run -it --rm \
  -v ~/x3pi_toolchain:/workspace \
  horizonai/x3pi_toolchain:latest bash

# åœ¨å®¹å™¨ä¸­è¿è¡Œæ£€æŸ¥
hb_mapper checker \
  --model-type onnx \
  --model models/model.onnx \
  --check-output-dir output/checker
```

**æ£€æŸ¥å†…å®¹**ï¼š
- æ¨¡å‹ç»“æ„æ˜¯å¦åˆæ³•
- ç®—å­æ˜¯å¦è¢«æ”¯æŒ
- è¾“å…¥è¾“å‡ºå½¢çŠ¶æ˜¯å¦æ­£ç¡®
- å±æ€§å‚æ•°æ˜¯å¦åˆæ³•

**æ£€æŸ¥ç»“æœ**ï¼š
- æˆåŠŸï¼šè¾“å‡ºæ£€æŸ¥æŠ¥å‘Š
- å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹æ¨¡å‹

#### 6.2.3.4 æ¨¡å‹è½¬æ¢

**ä½¿ç”¨hb_mapper makertbinè½¬æ¢æ¨¡å‹**ï¼š

```bash
# åˆ›å»ºè½¬æ¢é…ç½®æ–‡ä»¶
cat > convert.yaml << EOF
model_parameters:
  onnx_model: 'models/model.onnx'
  output_dir: 'output/convert'
  working_dir: 'output/working'
EOF

# è¿è¡Œè½¬æ¢
hb_mapper makertbin \
  --config convert.yaml \
  --model-type onnx
```

**è½¬æ¢è¾“å‡º**ï¼š
- `.bin`æ–‡ä»¶ - BPUæ¨¡å‹æ–‡ä»¶
- `.yaml`æ–‡ä»¶ - æ¨¡å‹é…ç½®æ–‡ä»¶
- è½¬æ¢æŠ¥å‘Š

#### 6.2.3.5 æ¨¡å‹ä¸Šæ¿è¿è¡Œ

**ä¼ è¾“æ¨¡å‹åˆ°æ—­æ—¥X3æ´¾**ï¼š
```bash
# åœ¨å¼€å‘æœºä¸Š
scp output/convert/model.bin sunrise@<æ—­æ—¥X3æ´¾IP>:~/models/
scp output/convert/model.yaml sunrise@<æ—­æ—¥X3æ´¾IP>:~/models/
```

**åœ¨æ—­æ—¥X3æ´¾ä¸Šè¿è¡Œ**ï¼š
```python
import hobot_dnn
import numpy as np

# åŠ è½½è½¬æ¢åçš„æ¨¡å‹
model = hobot_dnn.Model("~/models/model")

# å‡†å¤‡è¾“å…¥æ•°æ®
input_data = np.random.rand(1, 3, 224, 224).astype(np.float32)

# æ‰§è¡Œæ¨ç†
outputs = model.forward(input_data)

# å¤„ç†ç»“æœ
print(outputs)
```

#### 6.2.3.6 å…¬ç‰ˆæ¨¡å‹æ€§èƒ½ç²¾åº¦æŒ‡æ ‡

**é¢„è®­ç»ƒæ¨¡å‹æ€§èƒ½**ï¼š

| æ¨¡å‹ | ä»»åŠ¡ | æ¨ç†é€Ÿåº¦ | ç²¾åº¦(mAP) | å¤‡æ³¨ |
|------|------|----------|-----------|------|
| Mobilenet v1 | åˆ†ç±» | ~30fps | Top-1:70.6% | ImageNet |
| YOLOv5s | æ£€æµ‹ | ~25fps | 37.4% | COCO |
| YOLOv3 | æ£€æµ‹ | ~20fps | 33.0% | COCO |
| UNet | åˆ†å‰² | ~15fps | - | VOC |

## ğŸ”§ 6.3 è¿›é˜¶æŒ‡å—(PTQ)

### 6.3.1 æ¦‚è¿°

PTQï¼ˆPost-Training Quantizationï¼‰æ˜¯è®­ç»ƒåé‡åŒ–æŠ€æœ¯ï¼Œå¯ä»¥åœ¨ä¸é‡æ–°è®­ç»ƒæ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå°†æµ®ç‚¹æ¨¡å‹é‡åŒ–ä¸ºINT8æ ¼å¼ï¼Œæ˜¾è‘—æå‡æ¨ç†é€Ÿåº¦ã€‚

**ä¼˜åŠ¿**ï¼š
- ä¸éœ€è¦é‡æ–°è®­ç»ƒ
- é‡åŒ–é€Ÿåº¦å¿«
- ç²¾åº¦æŸå¤±å°

**æµç¨‹**ï¼š
1. æ¨¡å‹å‡†å¤‡
2. æ¨¡å‹éªŒè¯
3. å‡†å¤‡æ ¡å‡†æ•°æ®
4. æ¨¡å‹é‡åŒ–
5. ç²¾åº¦éªŒè¯
6. æ€§èƒ½åˆ†æ

### 6.3.2 ç¯å¢ƒå®‰è£…

#### 6.3.2.1 äº¤ä»˜ç‰©ä½¿ç”¨è¯´æ˜

**ç¤ºä¾‹åŒ…æºç ç›®å½•ç»“æ„**ï¼š
```
x3pi_toolchain/
â”œâ”€â”€ Dockerfile              # Dockeré•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ hb_mapper              # é‡åŒ–å·¥å…·
â”œâ”€â”€ hb_perf                # æ€§èƒ½åˆ†æå·¥å…·
â”œâ”€â”€ hb_pack                # æ¨¡å‹æ‰“åŒ…å·¥å…·
â”œâ”€â”€ samples/               # ç¤ºä¾‹ä»£ç 
â””â”€â”€ docs/                  # æ–‡æ¡£
```

#### 6.3.2.2 å¼€å‘æœºéƒ¨ç½²

**å¼€å‘æœºå‡†å¤‡**ï¼š
- Ubuntu 18.04/20.04
- å†…å­˜â‰¥16GB
- ç¡¬ç›˜â‰¥100GB
- Dockerç¯å¢ƒ

**ä½¿ç”¨Dockerç¯å¢ƒ**ï¼š
```bash
# æ‹‰å–å®Œæ•´å·¥å…·é“¾é•œåƒ
sudo docker pull horizonai/x3pi_toolchain:full

# å¯åŠ¨å®¹å™¨
sudo docker run -it --rm \
  -v ~/x3pi_toolchain:/workspace \
  --device /dev/dri \
  --network host \
  horizonai/x3pi_toolchain:full bash
```

#### 6.3.2.3 å¼€å‘æ¿éƒ¨ç½²

**è¡¥å……æ–‡ä»¶å‡†å¤‡**ï¼š
```bash
# åœ¨æ—­æ—¥X3æ´¾ä¸Šåˆ›å»ºç›®å½•
mkdir -p ~/x3pi_libs
mkdir -p ~/models

# ä»å¼€å‘æœºå¤åˆ¶åº“æ–‡ä»¶
scp -r libs/* sunrise@<æ—­æ—¥X3æ´¾IP>:~/x3pi_libs/
```

#### 6.3.2.4 ç‰ˆæœ¬ç®¡ç†å·¥å…·ä½¿ç”¨è¯´æ˜

**ddk_vcs list** - æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬
```bash
ddk_vcs list
```

**ddk_vcs install** - å®‰è£…æŒ‡å®šç‰ˆæœ¬
```bash
ddk_vcs install 1.0.0
```

**ddk_vcs uninstall** - å¸è½½ç‰ˆæœ¬
```bash
ddk_vcs uninstall 1.0.0
```

**ddk_vcs patch** - åº”ç”¨è¡¥ä¸
```bash
ddk_vcs install patch_name
```

**ddk_vcs show** - æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬
```bash
ddk_vcs show
```

### 6.3.3 PTQåŸç†åŠæ­¥éª¤è¯¦è§£

#### 6.3.3.1 ç®€ä»‹

PTQæ˜¯è®­ç»ƒåé‡åŒ–æŠ€æœ¯ï¼Œé€šè¿‡ç»Ÿè®¡æµ®ç‚¹æ¨¡å‹çš„æ¿€æ´»å€¼åˆ†å¸ƒï¼Œè®¡ç®—é‡åŒ–å‚æ•°ï¼Œå°†æ¨¡å‹ä»FP32é‡åŒ–åˆ°INT8ã€‚

**é‡åŒ–ç±»å‹**ï¼š
- **æƒé‡é‡åŒ–** - å°†æ¨¡å‹æƒé‡é‡åŒ–ä¸ºINT8
- **æ¿€æ´»é‡åŒ–** - å°†ä¸­é—´æ¿€æ´»å€¼é‡åŒ–ä¸ºINT8

#### 6.3.3.2 æ¨¡å‹å‡†å¤‡

**å‡†å¤‡æµ®ç‚¹æ¨¡å‹**ï¼š
```bash
# ç¡®ä¿æ¨¡å‹æ˜¯ONNXæˆ–Caffeæ ¼å¼
# æ£€æŸ¥æ¨¡å‹è¾“å…¥è¾“å‡º
# ç¡®è®¤æ¨¡å‹ç»“æ„
```

**æ¨¡å‹è¦æ±‚**ï¼š
- å›ºå®šè¾“å…¥å°ºå¯¸
- æ”¯æŒçš„ç®—å­åˆ—è¡¨
- åˆç†çš„æ¨¡å‹ç»“æ„

#### 6.3.3.3 æ¨¡å‹éªŒè¯

**ä½¿ç”¨hb_mapper checkeréªŒè¯æ¨¡å‹**ï¼š

```bash
# éªŒè¯ONNXæ¨¡å‹
hb_mapper checker \
  --model-type onnx \
  --model models/model.onnx \
  --check-output-dir output/checker

# éªŒè¯Caffeæ¨¡å‹
hb_mapper checker \
  --model-type caffe \
  --model models/model.prototxt \
  --weights models/model.caffemodel \
  --check-output-dir output/checker
```

**æ£€æŸ¥å¼‚å¸¸å¤„ç†**ï¼š

| é”™è¯¯ç±»å‹ | åŸå›  | è§£å†³æ–¹æ³• |
|---------|------|----------|
| ç®—å­ä¸æ”¯æŒ | ç®—å­ä¸åœ¨æ”¯æŒåˆ—è¡¨ä¸­ | æ›¿æ¢ä¸ºç­‰ä»·ç®—å­æˆ–é‡å†™æ¨¡å‹ |
| è¾“å…¥å½¢çŠ¶ä¸æ”¯æŒ | åŠ¨æ€è¾“å…¥å½¢çŠ¶ | å›ºå®šè¾“å…¥å½¢çŠ¶ |
| å±æ€§ä¸åˆæ³• | ç®—å­å±æ€§å€¼é”™è¯¯ | ä¿®æ”¹æ¨¡å‹é…ç½® |

**æ£€æŸ¥ç»“æœè§£è¯»**ï¼š
- **æˆåŠŸ**ï¼šè¾“å‡ºæ£€æŸ¥æŠ¥å‘Šï¼Œå¯ä»¥ç»§ç»­ä¸‹ä¸€æ­¥
- **å¤±è´¥**ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹æ¨¡å‹

**æ£€æŸ¥ç»“æœçš„è°ƒä¼˜æŒ‡å¯¼**ï¼š
1. æ£€æŸ¥æ¨¡å‹ç»“æ„æ˜¯å¦åˆç†
2. ç¡®è®¤è¾“å…¥è¾“å‡ºå½¢çŠ¶
3. æ£€æŸ¥ç®—å­ä½¿ç”¨æ˜¯å¦è§„èŒƒ
4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

#### 6.3.3.4 æ¨¡å‹è½¬æ¢

**å‡†å¤‡æ ¡å‡†æ•°æ®**ï¼š
```bash
# æ”¶é›†ä»£è¡¨æ€§å›¾åƒæ•°æ®
# å»ºè®®æ•°é‡ï¼š100-1000å¼ 
# æ”¾å…¥calibrationç›®å½•
```

**æ ¡å‡†æ•°æ®è¦æ±‚**ï¼š
- ä¸å®é™…åº”ç”¨åœºæ™¯ç›¸ä¼¼
- è¦†ç›–å„ç§è¾“å…¥æƒ…å†µ
- æ•°æ®é¢„å¤„ç†ä¸æ¨ç†æ—¶ä¸€è‡´

**ä½¿ç”¨hb_mapper makertbinè½¬æ¢æ¨¡å‹**ï¼š

```bash
# åˆ›å»ºé‡åŒ–é…ç½®æ–‡ä»¶
cat > quantize.yaml << EOF
model_parameters:
  onnx_model: 'models/model.onnx'
  model_type: 'onnx'
  output_dir: 'output/quantize'
  working_dir: 'output/working'
  
  calibration_parameters:
    cal_data_dir: 'calibration/'
    calibration_size: 100
  
  quantization_parameters:
    calibration_method: 'KL'
    quantized_algorithm: 'normal'
EOF

# è¿è¡Œé‡åŒ–
hb_mapper makertbin \
  --config quantize.yaml \
  --model-type onnx
```

**æ¨¡å‹è½¬æ¢yamlé…ç½®å‚æ•°è¯´æ˜**ï¼š

**model_parameters**ï¼š
- `onnx_model` - ONNXæ¨¡å‹æ–‡ä»¶è·¯å¾„
- `model_type` - æ¨¡å‹ç±»å‹ï¼ˆonnx/caffeï¼‰
- `output_dir` - è¾“å‡ºç›®å½•
- `working_dir` - ä¸´æ—¶å·¥ä½œç›®å½•

**calibration_parameters**ï¼š
- `cal_data_dir` - æ ¡å‡†æ•°æ®ç›®å½•
- `calibration_size` - æ ¡å‡†æ•°æ®æ•°é‡

**quantization_parameters**ï¼š
- `calibration_method` - æ ¡å‡†æ–¹æ³•ï¼ˆKL/MIN_MAXï¼‰
- `quantized_algorithm` - é‡åŒ–ç®—æ³•ï¼ˆnormal/fastï¼‰

**è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»**ï¼š
1. è§£ææ¨¡å‹ç»“æ„
2. ç»Ÿè®¡æ ¡å‡†æ•°æ®çš„æ¿€æ´»å€¼åˆ†å¸ƒ
3. è®¡ç®—é‡åŒ–å‚æ•°ï¼ˆscaleå’Œzero_pointï¼‰
4. é‡åŒ–æ¨¡å‹æƒé‡å’Œåç½®
5. ç”Ÿæˆé‡åŒ–åçš„æ¨¡å‹æ–‡ä»¶

**è½¬æ¢ç»“æœè§£è¯»**ï¼š
- `.bin`æ–‡ä»¶ - INT8é‡åŒ–æ¨¡å‹
- `.yaml`æ–‡ä»¶ - é‡åŒ–å‚æ•°é…ç½®
- é‡åŒ–æŠ¥å‘Š - åŒ…å«é‡åŒ–ç²¾åº¦ä¿¡æ¯

**è½¬æ¢äº§å‡ºç‰©è§£è¯»**ï¼š
- `model.bin` - å¯éƒ¨ç½²çš„é‡åŒ–æ¨¡å‹
- `model.yaml` - æ¨¡å‹é…ç½®æ–‡ä»¶
- `quant_report.txt` - é‡åŒ–ç²¾åº¦æŠ¥å‘Š
- `layer_info.txt` - å±‚ä¿¡æ¯æŠ¥å‘Š

#### 6.3.3.5 æ¨¡å‹æ€§èƒ½åˆ†æ

**å¼€å‘æœºè¯„æµ‹æ€§èƒ½**ï¼š
```bash
# ä½¿ç”¨hb_perfå·¥å…·åˆ†ææ¨¡å‹æ€§èƒ½
hb_perf \
  --model output/quantize/model.bin \
  --model-config output/quantize/model.yaml \
  --iterations 100
```

**æ€§èƒ½æŒ‡æ ‡**ï¼š
- æ¨ç†æ—¶é—´ï¼ˆmsï¼‰
- ååé‡ï¼ˆFPSï¼‰
- å†…å­˜å ç”¨
- CPUåˆ©ç”¨ç‡

**å¼€å‘æ¿å®æµ‹æ€§èƒ½**ï¼š

**Pythonæµ‹è¯•**ï¼š
```python
import hobot_dnn
import time
import numpy as np

# åŠ è½½é‡åŒ–æ¨¡å‹
model = hobot_dnn.Model("~/models/model")

# å‡†å¤‡è¾“å…¥
input_data = np.random.rand(1, 3, 224, 224).astype(np.float32)

# æ€§èƒ½æµ‹è¯•
start_time = time.time()
for i in range(100):
    outputs = model.forward(input_data)
end_time = time.time()

avg_time = (end_time - start_time) / 100
fps = 1000 / avg_time

print(f"å¹³å‡æ¨ç†æ—¶é—´: {avg_time:.2f} ms")
print(f"å¹³å‡å¸§ç‡: {fps:.2f} FPS")
```

**æ¨¡å‹æ€§èƒ½ä¼˜åŒ–**ï¼š
1. ä½¿ç”¨æ›´å°çš„æ¨¡å‹
2. å‡å°‘è¾“å…¥åˆ†è¾¨ç‡
3. ä½¿ç”¨å¤šæ ¸BPUï¼ˆå¦‚æœæ”¯æŒï¼‰
4. ä¼˜åŒ–åå¤„ç†ä»£ç 

#### 6.3.3.6 æ¨¡å‹ç²¾åº¦åˆ†æ

**ç²¾åº¦åˆ†æ**ï¼š
```python
import numpy as np

# åŠ è½½æµ®ç‚¹æ¨¡å‹å’Œé‡åŒ–æ¨¡å‹
float_model = hobot_dnn.Model("float_model")
quant_model = hobot_dnn.Model("quant_model")

# å‡†å¤‡æµ‹è¯•æ•°æ®
test_images = [...]  # æµ‹è¯•å›¾åƒåˆ—è¡¨

# å¯¹æ¯”æ¨ç†ç»“æœ
float_results = []
quant_results = []

for img in test_images:
    float_output = float_model.forward(img)
    quant_output = quant_model.forward(img)
    
    float_results.append(float_output)
    quant_results.append(quant_output)

# è®¡ç®—ç²¾åº¦å·®å¼‚
mse = np.mean((np.array(float_results) - np.array(quant_results)) ** 2)
print(f"å‡æ–¹è¯¯å·®: {mse:.6f}")
```

**ç²¾åº¦è°ƒä¼˜**ï¼š

**è°ƒæ•´æ ¡å‡†æ•°æ®**ï¼š
- å¢åŠ æ ¡å‡†æ•°æ®æ•°é‡
- ç¡®ä¿æ ¡å‡†æ•°æ®çš„å¤šæ ·æ€§
- è°ƒæ•´æ ¡å‡†æ•°æ®çš„é¢„å¤„ç†

**è°ƒæ•´é‡åŒ–å‚æ•°**ï¼š
- å°è¯•ä¸åŒçš„æ ¡å‡†æ–¹æ³•ï¼ˆKL/MIN_MAXï¼‰
- è°ƒæ•´é‡åŒ–ç®—æ³•å‚æ•°
- ä¿®æ”¹å±‚çº§åˆ«çš„é‡åŒ–é…ç½®

**æ··åˆç²¾åº¦é‡åŒ–**ï¼š
- å¯¹æ•æ„Ÿå±‚ä½¿ç”¨FP16
- å¯¹ä¸æ•æ„Ÿå±‚ä½¿ç”¨INT8
- å¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½

#### 6.3.3.7 å…¶å®ƒå·¥å…·ä½¿ç”¨è¯´æ˜

**hb_perfå·¥å…·** - æ€§èƒ½åˆ†æï¼š
```bash
hb_perf --model model.bin --model-config model.yaml
```

**hb_packå·¥å…·** - æ¨¡å‹æ‰“åŒ…ï¼š
```bash
hb_pack --model model.bin --config model.yaml --output model.pack
```

**hb_model_infoå·¥å…·** - æ¨¡å‹ä¿¡æ¯ï¼š
```bash
hb_model_info --model model.bin
```

**hb_model_modifierå·¥å…·** - æ¨¡å‹ä¿®æ”¹ï¼š
```bash
hb_model_modifier --model model.bin --modify-config modify.yaml
```

**hb_model_verifierå·¥å…·** - æ¨¡å‹éªŒè¯ï¼š
```bash
hb_model_verifier --model model.bin --config model.yaml
```

**hb_eval_preprocesså·¥å…·** - é¢„å¤„ç†è¯„ä¼°ï¼š
```bash
hb_eval_preprocess --model model.bin --input image.jpg
```

### 6.3.4 æ¨¡å‹ç®—å­æ”¯æŒåˆ—è¡¨

#### 6.3.4.1 ä½¿ç”¨é™åˆ¶è¯´æ˜

- éƒ¨åˆ†ç®—å­å¯èƒ½ä¸è¢«å®Œå…¨æ”¯æŒ
- æŸäº›ç®—å­å±æ€§æœ‰é™åˆ¶
- åŠ¨æ€è¾“å…¥å½¢çŠ¶å¯èƒ½ä¸æ”¯æŒ

#### 6.3.4.2 æ”¯æŒçš„Caffeç®—å­åˆ—è¡¨

**å¸¸ç”¨ç®—å­**ï¼š
- Convolution
- BatchNorm
- ReLU
- Pooling (Max/Average)
- InnerProduct (Fully Connected)
- Softmax
- Sigmoid
- Tanh

**å®Œæ•´åˆ—è¡¨**ï¼šå‚è§å®˜æ–¹æ–‡æ¡£

#### 6.3.4.3 æ”¯æŒçš„ONNXç®—å­åˆ—è¡¨

**å¸¸ç”¨ç®—å­**ï¼š
- Conv
- BatchNormalization
- Relu
- MaxPool
- AveragePool
- Gemm (MatMul + Bias)
- Softmax
- Sigmoid
- Tanh
- Concat
- Resize

**å®Œæ•´åˆ—è¡¨**ï¼šå‚è§å®˜æ–¹æ–‡æ¡£

### 6.3.5 æ¨¡å‹ä¸Šæ¿è¿è¡Œ(runtime)åº”ç”¨å¼€å‘è¯´æ˜

#### 6.3.5.1 æ¨¡å‹æ¨ç†DNN APIä½¿ç”¨è¯´æ˜

**æ¨¡å‹æ¨ç†DNN APIè¯´æ˜**ï¼š
- æä¾›ç»Ÿä¸€çš„æ¨¡å‹æ¨ç†æ¥å£
- æ”¯æŒå¤šç§æ¨¡å‹æ ¼å¼
- è‡ªåŠ¨ç®¡ç†å†…å­˜

**æ¨¡å‹æ¨ç†DNN APIä½¿ç”¨ç¤ºä¾‹è¯´æ˜**ï¼š

```python
import hobot_dnn
import numpy as np

# åŠ è½½æ¨¡å‹
model = hobot_dnn.Model("~/models/model.bin")

# è·å–æ¨¡å‹ä¿¡æ¯
inputs = model.inputs
outputs = model.outputs

print(f"è¾“å…¥: {inputs}")
print(f"è¾“å‡º: {outputs}")

# å‡†å¤‡è¾“å…¥
input_data = np.random.rand(1, 3, 224, 224).astype(np.float32)

# æ‰§è¡Œæ¨ç†
result = model.forward(input_data)

# å¤„ç†è¾“å‡º
for i, output in enumerate(result):
    print(f"Output {i}: shape={output.shape}, dtype={output.dtype}")
```

#### 6.3.5.2 æ¨¡å‹ä¸Šæ¿åˆ†æå·¥å…·è¯´æ˜

**æ¦‚è¿°**ï¼šæä¾›æ¨¡å‹ä¸Šæ¿è¿è¡Œæ—¶çš„æ€§èƒ½åˆ†æå·¥å…·

**hrt_model_execå·¥å…·ä½¿ç”¨è¯´æ˜**ï¼š
```bash
# åœ¨æ—­æ—¥X3æ´¾ä¸Šè¿è¡Œ
hrt_model_exec \
  --model model.bin \
  --model-config model.yaml \
  --iterations 100
```

**hrt_bin_dumpå·¥å…·ä½¿ç”¨è¯´æ˜**ï¼š
```bash
# å¯¼å‡ºæ¨¡å‹binæ–‡ä»¶ä¿¡æ¯
hrt_bin_dump --model model.bin
```

#### 6.3.5.3 å…¬ç‰ˆæ¨¡å‹ç²¾åº¦è¯„æµ‹è¯´æ˜

**å…¬ç‰ˆæ¨¡å‹æ€§èƒ½ç²¾åº¦æŒ‡æ ‡**ï¼š

| æ¨¡å‹ | ä»»åŠ¡ | ç²¾åº¦æŒ‡æ ‡ | é‡åŒ–åç²¾åº¦ | å¤‡æ³¨ |
|------|------|----------|------------|------|
| Mobilenet v1 | åˆ†ç±» | Top-1:70.6% | 69.8% | ImageNet |
| YOLOv5s | æ£€æµ‹ | mAP:37.4% | 36.9% | COCO |
| YOLOv3 | æ£€æµ‹ | mAP:33.0% | 32.5% | COCO |
| UNet | åˆ†å‰² | mIoU:78.5% | 77.8% | VOC |

**è¯„æµ‹æ–¹æ³•è¯´æ˜**ï¼š
1. ä½¿ç”¨æ ‡å‡†æ•°æ®é›†ï¼ˆImageNetã€COCOã€VOCç­‰ï¼‰
2. ç»Ÿä¸€çš„è¯„ä¼°æŒ‡æ ‡
3. å¯¹æ¯”æµ®ç‚¹å’Œé‡åŒ–æ¨¡å‹ç²¾åº¦

## ğŸ”— ç›¸å…³èµ„æº

- [[æ—­æ—¥X3æ´¾å­¦ä¹ é¡¹ç›®]] - å½“å‰å­¦ä¹ é¡¹ç›®
- [[æ—­æ—¥X3æ´¾å¿«é€Ÿå¼€å§‹æ•™ç¨‹]] - ç³»ç»Ÿå®‰è£…å’Œå¿«é€Ÿä½“éªŒ
- [[æ—­æ—¥X3æ´¾Pythonå¼€å‘æŒ‡å—]] - Python APIå’Œå¼€å‘ç¤ºä¾‹

## ğŸŒ å®˜æ–¹èµ„æº

- [æ—­æ—¥X3æ´¾å¼€å‘è€…æ–‡æ¡£](https://developer.d-robotics.cc/api/v1/fileData/documents_pi/index.html#)
- [åœ°å¹³çº¿å®˜ç½‘](https://www.horizon.ai/)

## ğŸ’¡ å¼€å‘å»ºè®®

> [!tip] æ¨¡å‹è½¬æ¢
> 1. å…ˆåœ¨å¼€å‘æœºéªŒè¯æ¨¡å‹
> 2. å‡†å¤‡å……åˆ†çš„æ ¡å‡†æ•°æ®
> 3. ä»”ç»†æ£€æŸ¥è½¬æ¢é…ç½®
> 4. å¯¹æ¯”æµ®ç‚¹å’Œé‡åŒ–ç»“æœ

> [!tip] ç²¾åº¦ä¼˜åŒ–
> 1. å¢åŠ æ ¡å‡†æ•°æ®æ•°é‡å’Œå¤šæ ·æ€§
> 2. å°è¯•ä¸åŒçš„é‡åŒ–æ–¹æ³•
> 3. å¯¹ç²¾åº¦æ•æ„Ÿå±‚ä½¿ç”¨æ··åˆç²¾åº¦
> 4. ä¼˜åŒ–æ¨¡å‹ç»“æ„

> [!warning] æ³¨æ„äº‹é¡¹
> - å·¥å…·é“¾ç‰ˆæœ¬ä¸å›ºä»¶ç‰ˆæœ¬è¦åŒ¹é…
> - æ³¨æ„æ¨¡å‹è¾“å…¥è¾“å‡ºæ ¼å¼
> - é‡åŒ–æ•°æ®è¦ä»£è¡¨æ€§
> - å……åˆ†æµ‹è¯•é‡åŒ–æ¨¡å‹ç²¾åº¦

---
**åˆ›å»ºæ—¶é—´**: 2026-02-19
**æœ€åæ›´æ–°**: 2026-02-19
**æ ‡ç­¾**: #para/resource/tech #æŠ€æœ¯/AI #æŠ€æœ¯/è¾¹ç¼˜è®¡ç®— #åœ°å¹³çº¿ #æ—­æ—¥X3 #ç®—æ³•å·¥å…·é“¾
