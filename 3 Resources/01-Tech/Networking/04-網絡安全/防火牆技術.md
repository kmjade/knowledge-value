---
title: 防火牆技術
aliases:
  - Firewall Technology
  - 防火墙技术
  - WAF
para: resource
tags:
  - #para/resource/tech
  - #topic/networking
  - #topic/network-security
  - #protocol/firewall
  - #type/concept
  - #zettel/type/permanent
created: 2026-02-15
---

> [!summary] 防火牆技術概述
> 防火牆是網絡安全的第一道防線，負責控制進入和離開網絡的流量，根據預定規則允許或拒絕數據包。

---

## 📋 目錄

- [防火牆類型](#防火牆類型)
- [包過濾防火牆](#包過濾防火牆)
- [狀態檢測防火牆](#狀態檢測防火牆)
- [應用層防火牆](#應用層防火牆)
- [WAF](#waf)
- [防火牆規則設計](#防火牆規則設計)
- [防火牆部署](#防火牆部署)

---

## 🔥 防火牆類型

### 包過濾防火牆

| 特點 | 說明 |
|------|------|
| 工作層次 | 網絡層、傳輸層 |
| 匹配依據 | IP地址、端口、協議 |
| 狀態 | 無狀態 |
| 效能 | 高，處理速度快 |
| 安全性 | 低，無法檢查應用層內容 |

### 狀態檢測防火牆

| 特點 | 說明 |
|------|------|
| 工作層次 | 傳輸層及以上 |
| 匹配依據 | IP、端口、協議、連接狀態 |
| 狀態 | 有狀態追蹤 |
| 效能 | 中等，維護連接狀態 |
| 安全性 | 高，可檢測連接狀態 |

### 應用層防火牆

| 特點 | 說明 |
|------|------|
| 工作層次 | 應用層（HTTP, FTP等） |
| 匹配依據 | 應用層協議內容、URL、用戶 |
| 狀態 | 有狀態 |
| 效能 | 低，需要解析應用層協議 |
| 安全性 | 最高，深入檢查應用層內容 |

---

## 📦 包過濾防火牆

### ACL (Access Control List)

**定義**：ACL是允許或拒絕流量通過的規則列表。

**ACL類型**：
1. **標準ACL**：僅匹配源IP地址
2. **擴展ACL**：匹配源IP、目標IP、協議、端口等

### ACL規則示例

```
允許內部網訪問網際網：
permit tcp 192.168.1.0 0.0.0.255 any eq 80
permit tcp 192.168.1.0 0.0.0.255 any eq 443
deny ip any any

允許管理員SSH：
permit tcp 10.0.0.0 0.0.0.255 host 192.168.100.100 eq 22
```

### ACL處理順序

**順序匹配**：ACL按從上到下的順序匹配，匹配第一條規則後停止。

**隱式拒絕**：如果沒有匹配任何允許規則，默認拒絕。

---

## 🔒 狀態檢測防火牆

### 連接狀態追蹤

**狀態表**：

```
源IP    源端口    目標IP    目標端口    協議    狀態
A       12345      B       80       TCP      ESTABLISHED
C       54321      B       443      TCP      ESTABLISHED
```

**狀態轉換**：
```
NEW → ESTABLISHED → FIN_WAIT → CLOSED
```

### SYN Flood防護

**SYN Cookie**：
```
正常情況：
客戶端 SYN → 伺服器 SYN+ACK → 客戶端 ACK → ESTABLISHED

SYN Cookie：
客戶端 SYN → 伺服器 SYN+ACK (含Cookie)
            → 客戶端 ACK (返回Cookie)
            → ESTABLISHED
```

---

## 🌐 應用層防火牆

### 深度包檢測 (DPI)

**定義**：檢查數據包的內容，識別應用層協議。

**檢測能力**：
- 協議識別（HTTP, FTP, DNS, BitTorrent等）
- URL過濾
- 文件類型過濾
- 入侵檢測特徵

### 應用層防火牆功能

| 功能 | 說明 |
|------|------|
| 身份驗證 | 基於用戶認證控制訪問 |
| URL過濾 | 阻止訪問特定網站 |
| 內容過濾 | 阻止病毒、惡意軟體下載 |
| 應用程式控制 | 限制P2P、遊戲等帶寬 |

---

## 🛡️ WAF (Web Application Firewall)

### 定義

WAF是專門保護Web應用程式的防火牆，部署在Web應用程式之前。

### WAF工作模式

**反向代理模式**：
```
用戶 → WAF → Web應用程式
        ↓
    檢查請求
        ↓
    過濾惡意請求
        ↓
    轉發合法請求
```

### WAF檢測攻擊類型

| 攻擊類型 | 檢測方式 |
|----------|----------|
| SQL注入 | 語義分析、規則匹配 |
| XSS | 腳本過濾、HTML標籤過濾 |
| CSRF | Token驗證、Referer檢查 |
| 命令注入 | 輸入驗證、特殊字符過濾 |
| 文件上傳 | 文件類型、大小驗證 |

### WAF部署方式

| 部署方式 | 說明 |
|----------|------|
| 硬體WAF | 專門設備，性能好，成本高 |
| 軟體WAF | 安裝在伺服器，靈活，性能影響 |
| 雲端WAF | CDN+WAF服務，易於部署，按量付費 |

---

## 📋 防火牆規則設計

### 規則設計原則

1. **默認拒絕**：所有未明確允許的流量拒絕
2. **最小權限**：只開放必要的端口和協議
3. **從具體到一般**：先處理具體規則，最後是一般規則
4. **註釋規則**：為每條規則添加註釋
5. **定期審查**：定期檢查和清理無用規則

### 規則示例

```
# 允許內部網訪問DNS
permit udp 192.168.1.0 0.0.0.255 any eq 53

# 允許管理員訪問SSH
permit tcp 10.0.0.0 0.0.0.255 host 192.168.100.1 eq 22

# 允許Web訪問
permit tcp any any eq 80
permit tcp any any eq 443

# 拒絕其他所有流量
deny ip any any
```

### DMZ (Demilitarized Zone)

**定義**：DMZ是隔離公共網絡和私有網絡的中立區域。

```
┌─────────────────────────────────────────────┐
│      公網                                │
│         │                                 │
│   [Internet]                              │
│         │                                 │
├─────────┴─────────┐                       │
│                 │                       │
│           [防火牆]                        │
│                 │                       │
│      ┌──────────┴──────────┐            │
│      │                   │            │
│   DMZ             內網          │
│      │                   │            │
│ [Web伺服器]      [內部網絡]      │
└─────────────────────────────────────────────┘
```

---

## 🏗️ 防火牆部署

### 單一防火牆

```
          ┌─────┐
          │網際網│
          └──┬──┘
             │
        [防火牆]
             │
    ┌────────┴────────┐
    │                 │
[伺服器]          [內部網絡]
```

### 雙防火牆

```
          ┌─────┐
          │網際網│
          └──┬──┘
             │
        [防火牆A] ─────┬──── [防火牆B]
             │           │
    ┌────────┴────────┐
    │                 │
[伺服器]          [內部網絡]
```

### 分散式防火牆

```
網際網
   ↓
  [雲端防火牆]
   ↓
  [企業防火牆]
   ↓
各部門子網 → [部門防火牆]
```

---

## 📝 學習檢查清單

- [ ] 了解不同類型防火牆的特點和優缺點
- [ ] 掌握ACL規則的編寫和匹配順序
- [ ] 理解狀態檢測防火牆的工作原理
- [ ] 了解應用層防火牆的功能
- [ ] 掌握WAF的工作原理和檢測攻擊能力
- [ ] 能夠設計和部署防火牆規則
- [ ] 了解DMZ的作用和部署方式

---

## 🔗 相關連結

- 🔙 [[04-網絡安全|返回網絡安全]]
- 🔐 [[加密與認證]]
- 🛡️ [[常見網絡攻擊與防禦]]
- 🛠️ [[網絡診斷工具]]
