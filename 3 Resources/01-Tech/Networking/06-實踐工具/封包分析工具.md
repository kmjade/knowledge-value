---
title: å°åŒ…åˆ†æå·¥å…·
aliases:
  - Packet Analysis Tools
  - Wireshark
  - tcpdump
para: resource
tags:
  - #para/resource/tech
  - #topic/networking
  - #topic/tools
  - #type/guide
  - #zettel/type/permanent
  - #difficulty/intermediate
  - #learning/review
created: 2026-02-15
updated: 2026-02-15
---

> [!summary] å°åŒ…åˆ†æå·¥å…·æ¦‚è¿°
> å°åŒ…åˆ†æå·¥å…·ç”¨æ–¼æ•ç²ã€åˆ†æå’Œè§£ç¢¼ç¶²çµ¡æ•¸æ“šåŒ…ï¼Œæ·±å…¥ç†è§£ç¶²çµ¡é€šä¿¡å”è­°å’Œæ•…éšœæ’æŸ¥ã€‚

---

## ğŸ“‹ ç›®éŒ„

- [Wireshark](#wireshark)
- [tcpdump](#tcpdump)
- [tshark](#tshark)
- [æŠ“åŒ…å ´æ™¯](#æŠ“åŒ…å ´æ™¯)
- [å°åŒ…åˆ†ææŠ€å·§](#å°åŒ…åˆ†ææŠ€å·§)

---

## ğŸ¦… Wireshark

### å®šç¾©

Wiresharkæ˜¯é–‹æºçš„ç¶²çµ¡å”è­°åˆ†æå™¨ï¼Œæ”¯æŒå¹¾ç™¾ç¨®å”è­°ï¼Œæä¾›åœ–å½¢åŒ–ç”¨æˆ¶ç•Œé¢ã€‚

### WiresharkåŠŸèƒ½

| åŠŸèƒ½ | èªªæ˜ |
|------|------|
| å”è­°è§£æ | è‡ªå‹•è­˜åˆ¥å’Œè§£æå„ç¨®å”è­° |
| éæ¿¾å™¨ | å¼·å¤§çš„éæ¿¾èªæ³• |
| çµ±è¨ˆ | å¤šç¨®çµ±è¨ˆå’Œåœ–è¡¨ |
| å°å‡º/å°å…¥ | å¤šç¨®æ ¼å¼æ”¯æŒ |
| å¯¦æ™‚æ•ç² | æ”¯æŒå¤šå€‹æ¥å£åŒæ™‚æ•ç² |
| å½©è‰²ç€ç¢¼ | æŒ‰å”è­°/å­—æ®µç€è‰² |

### Wiresharkå®‰è£

```bash
# Ubuntu/Debian
sudo apt-get install wireshark

# CentOS/RHEL
sudo yum install wireshark

# macOS
brew install --cask wireshark
```

### Wiresharkéæ¿¾èªæ³•

#### åŸºæœ¬éæ¿¾å™¨

```wireshark
# IPåœ°å€
ip.addr == 192.168.1.1
ip.addr == 192.168.1.0/24

# TCPç«¯å£
tcp.port == 80
tcp.port == 443

# çµ„åˆæ¢ä»¶
ip.addr == 192.168.1.1 and tcp.port == 22

# å¦å®šæ¢ä»¶
!(tcp.port == 80)

# æ¯”è¼ƒ
tcp.len >= 100
```

#### éæ¿¾å™¨è¡¨é”å¼

| é‹ç¬¦ | èªªæ˜ | ç¤ºä¾‹ |
|------|------|------|
| == | ç­‰æ–¼ | ip.addr == 192.168.1.1 |
| != | ä¸ç­‰æ–¼ | ip.addr != 192.168.1.1 |
| and | é‚è¼¯ä¸” | ip.src == 192.168.1.1 and tcp.port == 80 |
| or | æˆ– | ip.src == 192.168.1.1 or ip.src == 192.168.1.2 |
| not | é | not tcp |
| && | é‚è¼¯èˆ‡ | ip.src == 192.168.1.1 && ip.dst == 192.168.1.2 |
| \|\|\| | æˆ–å¤š | tcp.port == 80 || tcp.port == 443 |
| in | åŒ…å« | tcp.port in {22, 80, 443} |

#### éæ¿¾å™¨å”è­°å­—æ®µ

```wireshark
# TCPæ¨™èªŒ
tcp.flags.syn == 1
tcp.flags.ack == 1
tcp.flags.fin == 1
tcp.flags.reset == 1

# HTTPè«‹æ±‚
http.request.method == "GET"
http.request.uri contains "login"
http.response.code == 404

# DNSæŸ¥è©¢
dns.qry.name == "example.com"
dns.flags.response == 1

# Ethernet
eth.src == aa:bb:cc:dd:ee:ff
eth.dst == 11:22:33:44:55:66
```

### é«˜ç´šéæ¿¾æŠ€å·§

```wireshark
# æ•æ‰ç‰¹å®šä¸»æ©Ÿçš„é€šä¿¡
ip.host == 192.168.1.1

# æ•æ‰TCPä¸‰æ¬¡æ¡æ‰‹
tcp.flags.syn == 1 and tcp.flags.ack == 0
tcp.flags.ack == 1 and tcp.seq == 1

# æ•æ‰é‡å‚³åŒ…
tcp.analysis.retransmission

# æ•æ‰TCPçª—å£æ›´æ–°
tcp.analysis.window_update

# æ•æ‰TCPé›¶çª—å£
tcp.analysis.zero_window

# æ•æ‰HTTP 404/500éŒ¯èª¤
http.response.code == 404 or http.response.code == 500
```

---

## ğŸ’» tcpdump

### å®šç¾©

tcpdumpæ˜¯å‘½ä»¤è¡Œçš„ç¶²çµ¡åŒ…æŠ“å–å·¥å…·ï¼ŒåŠŸèƒ½å¼·å¤§ï¼Œè¼•é‡ç´šã€‚

### tcpdumpå®‰è£

```bash
# Ubuntu/Debian
sudo apt-get install tcpdump

# CentOS/RHEL
sudo yum install tcpdump

# macOS
brew install tcpdump
```

### tcpdumpåŸºæœ¬ç”¨æ³•

```bash
# æ•æ‰æ‰€æœ‰ç¶²å¡æµé‡
sudo tcpdump -i any

# æ•æ‰æŒ‡å®šæ¥å£
sudo tcpdump -i eth0

# æ•æ‰æŒ‡å®šæ•¸æ“šåŒ…
sudo tcpdump -i eth0 host 192.168.1.1

# æ•æ‰æŒ‡å®šç«¯å£
sudo tcpdump -i eth0 port 22

# æ•æ‰TCP SYNåŒ…
sudo tcpdump -i eth0 'tcp[tcpflags] == tcp-syn'

# ä¿å­˜åˆ°æ–‡ä»¶
sudo tcpdump -i eth0 -w capture.pcap

# è®€å–æ–‡ä»¶
tcpdump -r capture.pcap
```

### tcpdumpéæ¿¾å™¨

```bash
# è¤‡é›œéæ¿¾å™¨
sudo tcpdump -i eth0 'tcp and port 80'
sudo tcpdump -i eth0 'ip host 192.168.1.1 and not port 22'

# TCPæ¨™èªŒéæ¿¾
sudo tcpdump -i eth0 'tcp[tcpflags] & (tcp-syn|tcp-fin)'

# åŒ…é•·åº¦éæ¿¾
sudo tcpdump -i eth0 'less 100'

# å­—ç¬¦ä¸²éæ¿¾
sudo tcpdump -i eth0 -A 'tcp port 80' | grep "GET"
```

### tcpdumpè¼¸å‡ºæ ¼å¼

```bash
# é»˜èªè¼¸å‡º
tcpdump -i eth0

# è©³ç´°è¼¸å‡ºï¼ˆ- vï¼‰
tcpdump -i eth0 -v

# åå…­é€²åˆ¶è¼¸å‡ºï¼ˆ- xï¼‰
tcpdump -i eth0 -x

# ASCIIè¼¸å‡ºï¼ˆ- Aï¼‰
tcpdump -i eth0 -A

# é¡¯ç¤ºæ™‚é–“æˆ³ï¼ˆ- tï¼‰
tcpdump -i eth0 -tttt

# ä¸è§£æåŸŸåï¼ˆ- nï¼‰
tcpdump -i eth0 -n
```

### tcpdumpå¯¦ç”¨æŠ€å·§

```bash
# ç’°è·¯æ¨¡å¼æ•ç²
sudo tcpdump -i eth0 -c 1000

# æ—‹è½‰æ•ç²ï¼ˆä¿å­˜å¤šå€‹æ–‡ä»¶ï¼‰
sudo tcpdump -i eth0 -w capture_%Y%m%d_%H%M%S.pcap -G 3600

# éæ¿¾å™¨æ•ç²ä¸¦ä¿å­˜
sudo tcpdump -i eth0 'port 80 or port 443' -w web_traffic.pcap

# æŸ¥çœ‹æ•ç²åŒ…çš„çµ±è¨ˆ
tcpdump -r capture.pcap -q
```

---

## ğŸ–¥ï¸ tshark

### å®šç¾©

tsharkæ˜¯Wiresharkçš„å‘½ä»¤è¡Œç‰ˆæœ¬ï¼Œæ”¯æŒWiresharkçš„çµ•å¤§å¤šæ•¸åŠŸèƒ½ã€‚

### tsharkå®‰è£

```bash
tsharkæ˜¯Wiresharkå¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œå®‰è£Wiresharkå¾Œå³å¯ä½¿ç”¨
```

### tsharkåŸºæœ¬ç”¨æ³•

```bash
# åˆ—å‡ºæ•ç²çš„åŒ…
tshark -r capture.pcap

# é¡¯ç¤ºç‰¹å®šå”è­°
tshark -r capture.pcap -Y http

# é¡¯ç¤ºç‰¹å®šå­—æ®µ
tshark -r capture.pcap -T fields -e ip.src -e ip.dst -e tcp.len

# åªé¡¯ç¤ºæ‘˜è¦
tshark -r capture.pcap -q

# è¼¸å‡ºåˆ°æ–‡ä»¶
tshark -r capture.pcap -T fields -E separator=, > output.csv
```

### tsharkå¸¸ç”¨å‘½ä»¤

```bash
# çµ±è¨ˆæ‘˜è¦
tshark -r capture.pcap -q -z io,phs

# å”è­°åˆ†å±¤çµ±è¨ˆ
tshark -r capture.pcap -q -z conv,tcp

# HTTPè«‹æ±‚çµ±è¨ˆ
tshark -r capture.pcap -Y http -T fields -e http.request.method -e http.request.uri

# éæ¿¾ä¸¦çµ±è¨ˆ
tshark -r capture.pcap -Y "http.request.method == \"GET\"" -T fields -e http.host
```

---

## ğŸ¯ æŠ“åŒ…å ´æ™¯

### å ´æ™¯1ï¼šæ•æ‰HTTPæµé‡

```bash
# Wireshark
# éæ¿¾å™¨ï¼šhttp.request.method == "GET"
# åˆ†æï¼šæŸ¥çœ‹HTTPè«‹æ±‚å’ŒéŸ¿æ‡‰é ­

# tcpdump
tcpdump -i eth0 -A 'tcp port 80 and (((ip[2:2] & 0x4000) = 0) or ((ip[2] & 0x4000) = 0)) and (tcp[13] & 0x7 and tcp[13] & 2) = 2)'
```

### å ´æ™¯2ï¼šåˆ†æTCPé€£æ¥å•é¡Œ

```bash
# Wireshark
# éæ¿¾å™¨ï¼štcp.analysis.retransmission
# åˆ†æï¼šæŸ¥çœ‹é‡å‚³åŒ…ã€TCPçª—å£ã€RTT

# tcpdump
tcpdump -i eth0 'tcp[tcpflags] & (tcp-syn|tcp-ack)' -vv
```

### å ´æ™¯3ï¼šæª¢æ¸¬DNSæŸ¥è©¢

```bash
# Wireshark
# éæ¿¾å™¨ï¼šdns.qry.name
# åˆ†æï¼šæŸ¥çœ‹DNSæŸ¥è©¢å’ŒéŸ¿æ‡‰

# tcpdump
tcpdump -i eth0 -n 'udp port 53'
```

### å ´æ™¯4ï¼šåˆ†æSSL/TLSæ¡æ‰‹

```bash
# Wireshark
# éæ¿¾å™¨ï¼šssl.handshake.type == 1
# åˆ†æï¼šæŸ¥çœ‹ClientHelloã€ServerHelloã€è­‰æ›¸äº¤æ›

# æç¤ºï¼šéœ€è¦å®‰è£SSLå¯†é‘°æ‰èƒ½æŸ¥çœ‹è§£å¯†å…§å®¹
```

---

## ğŸ”¬ å°åŒ…åˆ†ææŠ€å·§

### 1. ä½¿ç”¨é¡è‰²ç€ç¢¼

**ç›®çš„**ï¼šé€šéé¡è‰²å€åˆ†ä¸åŒé¡å‹çš„æµé‡ã€‚

```
Wireshark â†’ View â†’ Coloring Rules
- TCPæµé‡ï¼šè—è‰²
- UDPæµé‡ï¼šç¶ è‰²
- HTTPæµé‡ï¼šç´…è‰²
- DNSæµé‡ï¼šé»ƒè‰²
```

### 2. ä½¿ç”¨çµ±è¨ˆå·¥å…·

**ç›®çš„**ï¼šå¿«é€Ÿäº†è§£ç¶²çµ¡æµé‡åˆ†ä½ˆã€‚

```
Wireshark â†’ Statistics â†’ Protocol Hierarchy
Wireshark â†’ Statistics â†’ Conversations
Wireshark â†’ Statistics â†’ Endpoints
```

### 3. ä½¿ç”¨æµè¿½è¹¤

**ç›®çš„**ï¼šæŸ¥çœ‹å®Œæ•´TCP/UDPå°è©±ã€‚

```
å³éµé»æ“ŠæŸå€‹æ•¸æ“šåŒ… â†’ Follow â†’ TCP Stream
```

### 4. ä½¿ç”¨å°ˆå®¶ä¿¡æ¯

**ç›®çš„**ï¼šäº†è§£å”è­°çš„æ¨™æº–å­—æ®µå«ç¾©ã€‚

```
Wireshark â†’ Analyze â†’ Expert Info
```

### 5. è‡ªå®šç¾©åˆ—

**ç›®çš„**ï¼šåªé¡¯ç¤ºé—œéµå­—æ®µï¼Œæé«˜åˆ†ææ•ˆç‡ã€‚

```
Edit â†’ Preferences â†’ Columns
æ·»åŠ ï¼šip.src, ip.dst, tcp.len, http.request.uri
```

### 6. ä½¿ç”¨æ™‚é–“æ ¼å¼

**ç›®çš„**ï¼šç²¾ç¢ºåˆ†ææ™‚é–“é–“éš”ã€‚

```
View â†’ Time Display Format
- UTCæ™‚é–“
- ç§’ç²¾åº¦ï¼ˆè‡ªå®šç¾©ï¼‰
```

---

## ğŸ“ å­¸ç¿’æª¢æŸ¥æ¸…å–®

- [ ] ç†Ÿç·´ä½¿ç”¨Wiresharkçš„åœ–å½¢ç•Œé¢å’ŒåŠŸèƒ½
- [ ] æŒæ¡Wiresharkéæ¿¾èªæ³•
- [ ] èƒ½å¤ ä½¿ç”¨tcpdumpé€²è¡Œå‘½ä»¤è¡ŒæŠ“åŒ…
- [ ] äº†è§£tsharkçš„åŸºæœ¬ç”¨æ³•
- [ ] æŒæ¡ä¸åŒæŠ“åŒ…å ´æ™¯çš„æ•ç²æ–¹æ³•
- [ ] æŒæ¡å°åŒ…åˆ†æçš„å¯¦ç”¨æŠ€å·§
- [ ] èƒ½å¤ åˆ†æTCP/UDP/HTTPç­‰å”è­°
- [ ] èƒ½å¤ è­˜åˆ¥ç¶²çµ¡æ•…éšœå’Œå®‰å…¨äº‹ä»¶

---

## ğŸ”— ç›¸é—œé€£çµ

- ğŸ”™ [[06-å¯¦è¸å·¥å…·|è¿”å›å¯¦è¸å·¥å…·]]
- ğŸ“ [[ç¶²çµ¡è¨ºæ–·å·¥å…·]]
- ğŸ”’ [[ç¶²çµ¡æ•ˆèƒ½å„ªåŒ–]]
- ğŸ” [[æ•…éšœæ’æŸ¥]]
