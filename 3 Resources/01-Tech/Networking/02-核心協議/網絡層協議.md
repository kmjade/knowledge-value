---
title: 網路層協議
aliases:
  - Network Layer Protocols
  - 网络层协议
para: resource
tags:
  - #para/resource/tech
  - #topic/networking
  - #topic/protocols
  - #layer/network
  - #protocol/ip
  - #protocol/icmp
  - #protocol/arp
  - #type/concept
  - #zettel/type/permanent
created: 2026-02-15
---

> [!summary] 網路層協議概述
> 網路層協議負責數據包的路由選擇和尋址，將數據從源主機傳輸到目標主機，跨越多個網路。

---

## 📋 目錄

- [IP協議](#ip協議)
- [ICMP協議](#icmp協議)
- [ARP協議](#arp協議)
- [路由協議](#路由協議)

---

## 🌐 IP協議

### 定義

IP (Internet Protocol) 是網路層的核心協議，負責在源主機和目標主機之間傳輸數據包。

### IPv4 vs IPv6

| 特性 | IPv4 | IPv6 |
|------|-------|-------|
| 地址長度 | 32位 (4字節) | 128位 (16字節) |
| 地址格式 | 點分十進制 | 冒號分隔的十六進制 |
| 地址數量 | 約43億 | 約3.4×10³⁸ |
| 地址類型 | 公網/私有/廣播/組播 | 公網/私有/廣播/組播/任播 |
| DHCP | 通用 | 廣泛使用 |
| NAT | 普遍使用 | 較少使用 |

### IPv4地址分類

```
A類: 0.0.0.0 - 127.255.255.255 (255.0.0.0/8)
B類: 128.0.0.0 - 191.255.255.255 (255.255.0.0/16)
C類: 192.0.0.0 - 223.255.255.255 (255.255.255.0/24)
D類: 224.0.0.0 - 239.255.255.255 (組播)
E類: 240.0.0.0 - 255.255.255.255 (保留)
```

### IPv4特殊地址

| 地址類型 | 地址範圍 | 說明 |
|----------|----------|------|
| 私有地址 | 10.0.0.0/8<br>172.16.0.0/12<br>192.168.0.0/16 | 內網使用，不路由到公網 |
| 廣播地址 | 255.255.255.255 | 廣播到整個網段 |
| 回環地址 | 127.0.0.0/8 | 本地回環測試 |
| 鏈路本地地址 | 169.254.0.0/16 | 自動配置失敗時使用 |

### IPv6地址格式

```
2001:0db8:85a3:0000:0000:8a2e:0370:7334
│     │       │       │        │        │      │      │
│     │       │       │        │        │      │      └─ 接口ID (64位)
│     │       │       │        │        │      └─ 子網ID (16位)
│     │       │       │        │        └─ 全局路由前綴 (48位)
│     │       │       │        └─ 接口ID (16位)
│     │       │       └─ 連接本地標識 (16位)
│     │       └─ 下一級聚合標識 (24位)
│     └─ 全球路由前綴 (16位)
```

### IP數據包格式

```
┌────────────────────────────────────────────────────────┐
│ 版本 (4) │ IHL (4) │ TOS (8) │ 總長度 (16)            │
├────────────────────────────────────────────────────┤
│ 標識 (16) │ 標誌 (3) │ 片偏移 (13)              │
├────────────────────────────────────────────────────┤
│ TTL (8) │ 協議 (8) │ 頭部校驗和 (16)              │
├────────────────────────────────────────────────────┤
│ 源IP地址 (32)                                    │
├────────────────────────────────────────────────────┤
│ 目標IP地址 (32)                                  │
├────────────────────────────────────────────────────┤
│ 選項和填充 (變長)                                │
├────────────────────────────────────────────────────┤
│ 數據 (變長)                                     │
└────────────────────────────────────────────────────┘
```

---

## 📡 ICMP (Internet Control Message Protocol)

### 定義

ICMP 是用於傳遞網路控制訊息和錯誤報告的協議，運行在IP協議之上。

### ICMP消息類型

| 類型 | 消息碼 | 說明 |
|------|---------|------|
| 0 | 0 | Echo Reply (Ping回應) |
| 3 | 0-15 | Destination Unreachable (目標不可達) |
| 4 | 0 | Source Quench (源端抑制) |
| 5 | 0-3 | Redirect (重定向) |
| 8 | 0 | Echo Request (Ping請求) |
| 11 | 0 | Time Exceeded (超時) |
| 12 | 0 | Parameter Problem (參數問題) |

### ICMP用途

1. **Ping測試**：測試網路連通性
2. **Traceroute**：追蹤數據包路由路徑
3. **錯誤報告**：報告網路錯誤（目標不可達、超時等）

### Ping命令

```bash
# 基本Ping
ping www.example.com

# 指定次數
ping -c 4 www.example.com

# 指定包大小
ping -s 1024 www.example.com

# 指定間隔
ping -i 2 www.example.com

# 查看詳細路由
ping -R www.example.com
```

---

## 🔗 ARP協議

### 定義

ARP (Address Resolution Protocol) 是用於將IP地址解析為MAC地址的協議。

### ARP工作流程

```
1. 主機A發送ARP請求
   └─ "誰有192.168.1.2？告訴我MAC地址"
      (廣播到整個網段)

2. 目標主機B收到ARP請求
   └─ "我是192.168.1.2，我的MAC是aa:bb:cc:dd:ee:ff"
      (單播回應給主機A)

3. 主機A收到ARP回應
   └─ 更新ARP緩存表
      192.168.1.2 → aa:bb:cc:dd:ee:ff
```

### ARP報文格式

```
┌─────────────────────────────────────────────────┐
│ 硬體類型 (16) │ 協議類型 (16)         │
├─────────────────────────────────────────────┤
│ 硬體長度 (16) │ 協議長度 (16)         │
├─────────────────────────────────────────────┤
│ 操作碼 (16) │ 發送者MAC (48)       │
├─────────────────────────────────────────────┤
│ 發送者IP (32)                       │
├─────────────────────────────────────────────┤
│ 目標MAC (48) │ 目標IP (32)         │
└─────────────────────────────────────────────┘
```

### ARP緩存

```
IP地址           MAC地址           過期時間
192.168.1.1     aa:bb:cc:dd:ee:01  300秒
192.168.1.2     aa:bb:cc:dd:ee:02  300秒
192.168.1.254   aa:bb:cc:dd:ee:ff  300秒
```

### ARP攻擊與防護

**ARP欺騙**：攻擊者發送偽造的ARP回應，將網關MAC映射到攻擊者MAC。

**防護措施**：
- 靜態ARP表
- 動態ARP檢測 (DAI)
- 交換機端口安全
- ARP防火牆

---

## 🛣️ 路由協議

### 定義

路由協議是路由器之間用於交換路由資訊的協議。

### 路由協議分類

#### 距離向量協議

- **RIP (Routing Information Protocol)**
  - 度量：跳數
  - 優點：簡單，易於配置
  - 缺點：收斂慢，最大跳數15

- **BGP (Border Gateway Protocol)**
  - 度量：路徑屬性
  - 優點：可擴展，支持策略路由
  - 缺點：配置複雜

#### 鏈路狀態協議

- **OSPF (Open Shortest Path First)**
  - 度量：帶寬、延遲
  - 優點：收斂快，支持大型網路
  - 缺點：配置複雜

- **IS-IS (Intermediate System to Intermediate System)**
  - 優點：可擴展，支持多協議
  - 缺點：配置複雜

### 路由表

```
目標網路         下一跳           接口          度量
192.168.2.0/24   192.168.1.2       eth0           1
10.0.0.0/8       192.168.1.1       eth1           2
0.0.0.0/0        192.168.1.254     eth1           10
```

### 靜態路由 vs 動態路由

| 特性 | 靜態路由 | 動態路由 |
|------|----------|----------|
| 配置 | 手動配置 | 自動學習 |
| 適用 | 小型、穩定網路 | 中大型網路 |
| 維護 | 需要手動維護 | 自動適應網路變化 |
| 資源占用 | 低 | 高 |

---

## 📝 學習檢查清單

- [ ] 理解IPv4和IPv6的區別
- [ ] 掌握IP數據包格式
- [ ] 了解ICMP的消息類型和用途
- [ ] 理解ARP的工作原理和攻擊防護
- [ ] 知道常見路由協議的特點
- [ ] 理解靜態路由和動態路由的區別

---

## 🔗 相關連結

- 🔙 [[02-核心協議|返回核心協議]]
- 🌊 [[TCP協議深入]]
- 🔗 [[傳輸層協議]]
- 🌐 [[數據鏈路層協議]]
- 🛠️ [[網絡診斷工具]]
