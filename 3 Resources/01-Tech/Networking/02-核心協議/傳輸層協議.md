---
title: 傳輸層協議
aliases:
  - Transport Layer Protocols
  - 传输层协议
  - TCP UDP
para: resource
tags:
  - #para/resource/tech
  - #topic/networking
  - #topic/protocols
  - #layer/transport
  - #protocol/tcp
  - #protocol/udp
  - #type/concept
  - #zettel/type/permanent
created: 2026-02-15
---

> [!summary] 傳輸層協議概述
> 傳輸層協議負責在源主機和目標主機之間提供端到端的數據傳輸服務，主要包括TCP和UDP兩大協議。

---

## 📋 目錄

- [TCP](#tcp)
- [UDP](#udp)
- [TCP vs UDP 對比](#tcp-vs-udp-對比)

---

## 🔌 TCP (Transmission Control Protocol)

### 定義

TCP 是一種面向連接的、可靠的、基於字節流的傳輸層協議。

### TCP特點

| 特點 | 說明 |
|------|------|
| 面向連接 | 傳輸前必須建立連接 |
| 可靠傳輸 | 確認機制、重傳、流量控制 |
| 全雙工 | 支持同時雙向傳輸 |
| 字節流 | 傳輸單位為字節 |
| 點到點 | 端到端通訊 |

### TCP報文格式

```
┌─────────────────────────────────────────────────────┐
│         源端口 (16 bits)      目標端口 (16 bits)    │
├─────────────────────┬─────────────────────┤
│         序列號 (32 bits)                        │
├─────────────────────────────────────────────────────┤
│         確認號 (32 bits)                        │
├─────────────────────────────────────────────────────┤
│         數據偏移 (4 bits)│保留 (6 bits)│標誌 (6 bits)│ 窗口大小 (16 bits)  │
├─────────────────────────────────────────────────────┤
│         校驗和 (16 bits)                         │
├─────────────────────────────────────────────────────┤
│         緊急指針 (16 bits)                       │
├─────────────────────────────────────────────────────┤
│         選項 (32 bits)                         │
├─────────────────────────────────────────────────────┤
│         數據 (變長)                             │
└─────────────────────────────────────────────────────┘
```

### TCP三次握手

```
客戶端                                          伺服器
  │                                               │
  │─── 1. SYN, seq=x ───────────────────────────→│
  │                                               │
  │←── 2. SYN+ACK, seq=y, ack=x+1 ──────────────│
  │                                               │
  │─── 3. ACK, ack=y+1 ────────────────────────→│
  │                                               │
  │    連接建立 ✓                               │
  │                                               │
  └───────────────────────────────────────────────────┘
```

**詳細說明**：
1. **SYN (Synchronize)**：客戶端發送連接請求，設置序列號
2. **SYN+ACK**：伺服器確認收到SYN，並發送自己的SYN
3. **ACK**：客戶端確認收到伺服器的SYN

### TCP四次揮手

```
客戶端                                          伺服器
  │                                               │
  │←── 1. FIN, seq=u ────────────────────────────│
  │                                               │
  │─── 2. ACK, ack=u+1 ───────────────────────→│
  │                                               │
  │─── 3. FIN, seq=v ────────────────────────→│
  │                                               │
  │←── 4. ACK, ack=v+1 ────────────────────────│
  │                                               │
  │    連接關閉 ✓                               │
  │                                               │
  └───────────────────────────────────────────────────┘
```

### TCP流量控制

**滑動視窗協議**：
```
視窗大小 = 可接收的數據量
視窗滿 → 暫停發送
視窗可用 → 繼續發送
```

**目的**：防止發送方發送過快，導致接收方緩存溢出。

### TCP擁塞控制

**擁塞窗口算法**：
1. **慢啟動 (Slow Start)**：視窗從1開始，指數增長
2. **擁塞避免 (Congestion Avoidance)**：視窗線性增長
3. **快恢復 (Fast Recovery)**：丟包時視窗減半

---

## 🚀 UDP (User Datagram Protocol)

### 定義

UDP 是一種無連接的、不可靠的、基於數據報的傳輸層協議。

### UDP特點

| 特點 | 說明 |
|------|------|
| 無連接 | 傳輸前無需建立連接 |
| 不可靠傳輸 | 無確認機制、無重傳 |
| 面向數據報 | 傳輸單位為數據報 |
| 報頭簡單 | 僅8字節 |
| 高效 | 低開銷，傳輸速度快 |

### UDP報文格式

```
┌─────────────────────────────────────┐
│   源端口 (16 bits)    目標端口 (16 bits)   │
├─────────────────┬─────────────────┤
│   長度 (16 bits)     校驗和 (16 bits)  │
├─────────────────────────────────────────┤
│   數據 (變長)                      │
└─────────────────────────────────────────┘
```

**總報文大小**：8字節（頭部）+ 數據

### UDP優勢

1. **低延遲**：無連接建立和確認開銷
2. **高吞吐量**：無流量控制和擁塞控制限制
3. **簡單**：實現簡單，資源占用少
4. **支持組播和廣播**：天然支持一對多通訊

### UDP劣勢

1. **不可靠**：丟包無重傳，可能出現亂序
2. **無流控**：可能使接收方緩存溢出
3. **無擁塞控制**：可能加劇網路擁塞

---

## 🔄 TCP vs UDP 對比

### 對比表

| 特性 | TCP | UDP |
|------|-----|-----|
| 連接類型 | 面向連接 | 無連接 |
| 可靠性 | 高（確認、重傳） | 低（無確認） |
| 傳輸順序 | 有序 | 可能亂序 |
| 流量控制 | 有 | 無 |
| 擁塞控制 | 有 | 無 |
| 開銷 | 高 | 低 |
| 數據量 | 字節流 | 數據報 |
| 報頭大小 | 20-60字節 | 8字節 |

### 選擇TCP的場景

- ✅ Web瀏覽 (HTTP)
- ✅ 電子郵件 (SMTP, POP3, IMAP)
- ✅ 檔案傳輸 (FTP)
- ✅ 遠程登入 (SSH, Telnet)
- ✅ 要求可靠性的數據傳輸

### 選擇UDP的場景

- ✅ 視訊會議和流媒體
- ✅ 線上遊戲
- ✅ DNS查詢
- ✅ VoIP (語音通訊)
- ✅ 實時數據傳輸
- ✅ 組播和廣播應用

---

## 💡 實踐示例

### TCP連接示例

```bash
# 使用netcat創建TCP連接
nc -l 8080  # 監聽TCP端口8080
nc localhost 8080  # 連接到本地TCP端口8080

# 使用telnet測試TCP連接
telnet www.example.com 80
```

### UDP數據報示例

```bash
# 使用netcat發送UDP數據報
echo "Hello UDP" | nc -u localhost 8080

# 使用nc監聽UDP端口
nc -u -l 8080
```

---

## 📝 學習檢查清單

- [ ] 理解TCP的三次握手和四次揮手過程
- [ ] 了解TCP的流量控制和擁塞控制機制
- [ ] 掌握TCP報文格式
- [ ] 理解UDP的特點和優劣勢
- [ ] 掌握UDP報文格式
- [ ] 能夠根據場景選擇TCP或UDP

---

## 🔗 相關連結

- 🔙 [[02-核心協議|返回核心協議]]
- 🌊 [[TCP協議深入]]
- 📤 [[應用程式層協議]]
- 🌐 [[網絡層協議]]
- 🛠️ [[06-實踐工具]]
