---
title: 應用程式層協議
aliases:
  - Application Layer Protocols
  - 应用层协议
  - 应用层
para: resource
tags:
  - #para/resource/tech
  - #topic/networking
  - #topic/protocols
  - #layer/application
  - #type/concept
  - #zettel/type/permanent
created: 2026-02-15
---

> [!summary] 應用程式層協議概述
> 應用程式層協議為應用程式提供網路服務接口，包括HTTP、FTP、SMTP、DNS、DHCP、SSH等常用協議。

---

## 📋 目錄

- [FTP](#ftp)
- [SMTP/POP3/IMAP](#smtppop3imap)
- [DNS](#dns)
- [DHCP](#dhcp)
- [SSH/Telnet](#sshtelnet)
- [其他協議](#其他協議)

---

## 📤 FTP (檔案傳輸協議)

### 定義

FTP (File Transfer Protocol) 是用於在客戶端和伺服器之間傳輸檔案的標準網路協議。

### 連接方式

| 連接方式 | 端口 | 說明 |
|----------|------|------|
| 主動連接 | 20, 21 | 客戶端主動發起連接 |
| 被動連接 | 20, 21 | 客戶端等待伺服器連接 |

**端口說明**：
- **21 (控制端口)**：用於傳輸命令
- **20 (數據端口)**：用於傳輸數據

### 工作模式

```
主動模式 (Active)              被動模式 (Passive)
客戶端打開數據端口 ←────→ 伺服器   客戶端 ←──── 伺服器打開數據端口
```

### 常用命令

```bash
# 連接
ftp ftp.example.com

# 匿名登入
anonymous

# 傳輸檔案
put filename

# 下載檔案
get filename

# 列出檔案
ls

# 切換目錄
cd /path

# 創建目錄
mkdir dirname

# 刪除檔案
delete filename
```

### FTP vs SFTP

| 特性 | FTP | SFTP |
|------|-----|-------|
| 安全性 | 明文傳輸 | SSH加密 |
| 端口 | 20/21 | 22 |
| 防火牆 | 需要主動/被動模式 | 無需特殊配置 |

---

## 📧 SMTP/POP3/IMAP (電子郵件協議)

### SMTP (Simple Mail Transfer Protocol)

**定義**：用於發送電子郵件的協議。

**端口**：25 (標準), 587 (提交), 465 (SMTP over SSL/TLS)

**工作流程**：
```
發件人 → SMTP伺服器 → 收件人SMTP伺服器 → 收件人郵箱
```

```bash
# 測試SMTP連接
telnet smtp.gmail.com 587
EHLO mail.example.com
STARTTLS
AUTH LOGIN username password
MAIL FROM: sender@example.com
RCPT TO: recipient@example.com
DATA
Subject: Test Email
From: sender@example.com
To: recipient@example.com

This is a test email.
.
QUIT
```

### POP3 (Post Office Protocol v3)

**定義**：用於接收電子郵件的協議。

**端口**：110 (標準), 995 (POP3 over SSL/TLS)

**特點**：
- 郵件下載到本地後從伺服器刪除
- 適合單設備使用

### IMAP (Internet Message Access Protocol)

**定義**：用於接收和管理電子郵件的協議。

**端口**：143 (標準), 993 (IMAP over SSL/TLS)

**特點**：
- 郵件保留在伺服器
- 支持多設備同步
- 支持郵件夾管理

### 協議對比

| 特性 | POP3 | IMAP |
|------|------|------|
| 伺服器存儲 | 否 | 是 |
| 多設備同步 | 否 | 是 |
| 郵件夾管理 | 否 | 是 |
| 帶寬需求 | 低 | 高 |

---

## 🔍 DNS (Domain Name System)

### 定義

DNS 是將網域名稱轉換為IP地址的分佈式數據庫系統。

### DNS查詢類型

| 記錄類型 | 說明 | 示例 |
|----------|------|------|
| A | 將網域名稱映射到IPv4地址 | www.example.com → 192.0.2.1 |
| AAAA | 將網域名稱映射到IPv6地址 | www.example.com → 2001:db8::1 |
| MX | 指定郵件伺服器 | example.com → mail.example.com |
| CNAME | 網域名稱別名 | www.example.com → example.com |
| NS | 指定名稱伺服器 | example.com → ns1.example.com |
| TXT | 文本記錄，用於驗證 | _dmarc.example.com → v=DMARC1 |
| SRV | 服務記錄 | _sip._tcp.example.com |

### DNS查詢過程

```
客戶端
  │
  ├─ 查詢緩存
  │    └─ 未找到
  │
  ├─ 查詢本地DNS伺服器
  │    └─ 未找到
  │
  ├─ 查詢根名稱伺服器
  │    ├─ 查詢頂級域名伺服器
  │    ├─ 查詢二級域名伺服器
  │    └─ 查詢三級域名伺服器
  │
  └─ 返回IP地址
```

### DNS遞歸與迭代

**遞歸查詢**：DNS伺服器向其他DNS伺服器查詢，直到找到答案或報告錯誤。

**迭代查詢**：DNS伺服器返回下一級DNS伺服器的地址，客戶端自己繼續查詢。

### 常用DNS工具

```bash
# nslookup (Windows通用)
nslookup www.example.com
nslookup -type=MX example.com
nslookup -type=NS example.com

# dig (Linux/Mac，功能更強)
dig www.example.com
dig +short www.example.com
dig MX example.com
dig NS example.com
dig +trace www.example.com  # 追蹤DNS查詢過程
```

### DNS緩存

**TTL (Time To Live)**：DNS記錄的有效時間。

**常見TTL值**：
- 300秒 (5分鐘) - 頻繁變更的記錄
- 3600秒 (1小時) - 一般記錄
- 86400秒 (1天) - 穩定記錄
- 604800秒 (1周) - 很少變更的記錄

---

## 🖥️ DHCP (Dynamic Host Configuration Protocol)

### 定義

DHCP 是用於自動分配網路配置（IP地址、子網掩碼、網關、DNS）的協議。

### 端口

- **67 (UDP)**：DHCP伺服器
- **68 (UDP)**：DHCP客戶端

### DHCP分配過程 (DORA)

```
客戶端                                    DHCP伺服器
  │                                           │
  │─── 1. Discover (廣播) ───────────────────→│
  │                                           │
  │←── 2. Offer (廣播/單播) ──────────────│
  │                                           │
  │─── 3. Request (廣播/單播) ───────────→│
  │                                           │
  │←── 4. ACK (單播) ────────────────────│
  │                                           │
  └─ 獲得IP地址                             │
```

### DHCP選項

| 選項 | 說明 | 示例 |
|------|------|------|
| Subnet Mask | 子網掩碼 | 255.255.255.0 |
| Router | 默認網關 | 192.168.1.1 |
| DNS Server | DNS伺服器 | 8.8.8.8 |
| IP Address Lease Time | 租約時間 | 86400秒 |
| Domain Name | 域名 | example.com |

### DHCP租約續約

租約過期後：
1. **T1階段**：租約50%時間到達，客戶端請求續約
2. **T2階段**：租約87.5%時間到達，客戶端廣播請求續約
3. **過期階段**：租約到期，IP釋放

---

## 🔐 SSH (Secure Shell)

### 定義

SSH 是一種加密的遠程登入協議，用於安全地執行遠程命令和傳輸檔案。

### 端口

**22 (TCP)**：SSH標準端口

### SSH vs Telnet

| 特性 | SSH | Telnet |
|------|-----|--------|
| 安全性 | 加密傳輸 | 明文傳輸 |
| 認證 | 密碼/公鑰 | 密碼 |
| 端口 | 22 | 23 |
| 安全性 | 高 | 低（不建議使用）|

### SSH連接

```bash
# 基本連接
ssh username@hostname

# 指定端口
ssh -p 2222 username@hostname

# 使用私鑰
ssh -i ~/.ssh/id_rsa username@hostname

# 執行遠程命令
ssh username@hostname "ls -la"

# 隧道轉發（本地轉發）
ssh -L 8080:localhost:80 username@hostname
```

### SCP/SFTP (檔案傳輸)

```bash
# SCP - 檔案傳輸
# 上傳檔案
scp localfile.txt username@hostname:/remote/path/

# 下載檔案
scp username@hostname:/remote/path/file.txt localfile.txt

# 遞歸傳輸
scp -r localdir username@hostname:/remote/path/

# SFTP - 交互式檔案傳輸
sftp username@hostname
```

### SSH密鑰認證

```bash
# 生成密鑰對
ssh-keygen -t rsa -b 4096

# 將公鑰複製到伺服器
ssh-copy-id username@hostname

# 或手動複製
cat ~/.ssh/id_rsa.pub | ssh username@hostname 'cat >> ~/.ssh/authorized_keys'
```

---

## 🌐 Telnet

### 定義

Telnet 是一種早期的遠程登入協議，現在已被SSH取代。

### 端口

**23 (TCP)**：Telnet標準端口

### 使用場景

由於Telnet不加密，現在主要用於：
- 網絡設備調試
- 服務端口連接測試
- SMTP/HTTP協議調試

```bash
# 測試SMTP連接
telnet smtp.gmail.com 587

# 測試HTTP連接
telnet www.example.com 80
```

---

## 📋 其他協議

### TFTP (Trivial File Transfer Protocol)

- **端口**：69 (UDP)
- **特點**：無認證，簡單快速，用於無盤啟動和網絡設備
- **用途**：傳輸啟動鏡像和配置檔案

### NTP (Network Time Protocol)

- **端口**：123 (UDP)
- **用途**：同步網路設備時間
- **層級**：Stratum-1 (主時間伺服器), Stratum-2, Stratum-3...

### SNMP (Simple Network Management Protocol)

- **端口**：161 (UDP查詢), 162 (UDP告警)
- **用途**：監控和管理網路設備
- **版本**：SNMPv1, SNMPv2c, SNMPv3

---

## 📝 學習檢查清單

- [ ] 了解FTP的連接方式和傳輸模式
- [ ] 理解SMTP、POP3、IMAP的區別和用途
- [ ] 掌握DNS查詢過程和記錄類型
- [ ] 理解DHCP分配過程和租約機制
- [ ] 掌握SSH連接、認證和檔案傳輸
- [ ] 了解Telnet的使用場景和局限性

---

## 🔗 相關連結

- 🔙 [[02-核心協議|返回核心協議]]
- 📤 [[HTTP協議]]
- 📧 [[TCP協議深入]]
- 🔐 [[加密與認證]]
- 🛠️ [[06-實踐工具]]
