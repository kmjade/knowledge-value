---
title: æ’ä»¶å¼€å‘æŒ‡å—
status: active
priority: high
tags: [clawdbot, plugins, development, tutorial]
aliases: [æ’ä»¶å¼€å‘, Pluginå¼€å‘]
created: 2026-01-31
modified: 2026-01-31
---

# æ’ä»¶å¼€å‘æŒ‡å—

> æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä»é›¶å¼€å§‹å¼€å‘ ClawdBot æ’ä»¶ï¼Œæ‰©å±•å¹³å°åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [æ’ä»¶æ¦‚è¿°](#æ’ä»¶æ¦‚è¿°)
- [å¼€å‘ç¯å¢ƒæ­å»º](#å¼€å‘ç¯å¢ƒæ­å»º)
- [ç¬¬ä¸€ä¸ªæ’ä»¶](#ç¬¬ä¸€ä¸ªæ’ä»¶)
- [æ’ä»¶æ¶æ„](#æ’ä»¶æ¶æ„)
- [æ ¸å¿ƒAPI](#æ ¸å¿ƒapi)
- [è¿›é˜¶åŠŸèƒ½](#è¿›é˜¶åŠŸèƒ½)
- [æµ‹è¯•ä¸è°ƒè¯•](#æµ‹è¯•ä¸è°ƒè¯•)
- [æ‰“åŒ…ä¸å‘å¸ƒ](#æ‰“åŒ…ä¸å‘å¸ƒ)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ’ä»¶æ¦‚è¿°

### ä»€ä¹ˆæ˜¯æ’ä»¶ï¼Ÿ

ClawdBot æ’ä»¶æ˜¯ç‹¬ç«‹çš„ Python åŒ…ï¼Œå¯ä»¥æ‰©å±•å¹³å°çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ¯ä¸ªæ’ä»¶æä¾›ç‰¹å®šçš„åŠŸèƒ½ï¼Œå¦‚æ•°æ®æºè¿æ¥ã€æ•°æ®å¤„ç†ã€é€šçŸ¥å‘é€ç­‰ã€‚

### æ’ä»¶ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **æ•°æ®æºæ’ä»¶** | è¿æ¥å¤–éƒ¨æ•°æ®æº | MySQL, MongoDB, API |
| **å¤„ç†å™¨æ’ä»¶** | å¤„ç†å’Œè½¬æ¢æ•°æ® | æ•°æ®æ¸…æ´—ã€æ ¼å¼è½¬æ¢ |
| **åŠ¨ä½œæ’ä»¶** | æ‰§è¡Œç‰¹å®šæ“ä½œ | å‘é€é‚®ä»¶ã€ä¸Šä¼ æ–‡ä»¶ |
| **é›†æˆæ’ä»¶** | é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡ | Slack, GitHub, Jira |
| **UIæ’ä»¶** | æ‰©å±•Webç•Œé¢ | è‡ªå®šä¹‰ä»ªè¡¨ç›˜ |

### æ’ä»¶ç»“æ„

```
my-plugin/
â”œâ”€â”€ plugin/                    # æ’ä»¶ä¸»åŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ core.py                # æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ config.py              # é…ç½®å¤„ç†
â”‚   â””â”€â”€ utils.py               # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/                     # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_core.py
â”œâ”€â”€ static/                    # é™æ€èµ„æºï¼ˆUIæ’ä»¶ï¼‰
â”œâ”€â”€ templates/                 # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ manifest.yaml              # æ’ä»¶æ¸…å•
â”œâ”€â”€ requirements.txt           # ä¾èµ–
â”œâ”€â”€ setup.py                   # å®‰è£…è„šæœ¬
â”œâ”€â”€ README.md                  # æ–‡æ¡£
â””â”€â”€ LICENSE                    # è®¸å¯è¯
```

---

## å¼€å‘ç¯å¢ƒæ­å»º

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.9+
- ClawdBot CLI
- Git

### 2. å®‰è£…å¼€å‘å·¥å…·

```bash
# å®‰è£… ClawdBot CLI
pip install clawdbot-cli

# å®‰è£…å¼€å‘ä¾èµ–
pip install clawdbot-dev-tools

# éªŒè¯å®‰è£…
clawdbot --version
```

### 3. åˆ›å»ºæ’ä»¶é¡¹ç›®

```bash
# ä½¿ç”¨æ¨¡æ¿åˆ›å»ºæ’ä»¶
clawdbot plugin create my-awesome-plugin

# è¿›å…¥é¡¹ç›®ç›®å½•
cd my-awesome-plugin

# æŸ¥çœ‹é¡¹ç›®ç»“æ„
ls -la
```

ç”Ÿæˆçš„é¡¹ç›®ç»“æ„ï¼š

```
my-awesome-plugin/
â”œâ”€â”€ .clawdbot/                # ClawdBoté…ç½®
â”œâ”€â”€ my_awesome_plugin/         # æ’ä»¶åŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ plugin.py
â”œâ”€â”€ tests/
â”œâ”€â”€ manifest.yaml
â”œâ”€â”€ setup.py
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

### 4. æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate   # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å®‰è£…æ’ä»¶ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
pip install -e .
```

---

## ç¬¬ä¸€ä¸ªæ’ä»¶

### æ’ä»¶æ¸…å•ï¼ˆmanifest.yamlï¼‰

```yaml
# manifest.yaml
name: my-awesome-plugin
display_name: æˆ‘çš„è¶…æ£’æ’ä»¶
version: "0.1.0"
description: ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ’ä»¶
author: Your Name <your@email.com>
license: MIT

# æ’ä»¶ç±»å‹
type: processor

# å…¼å®¹æ€§
clawdbot:
  min_version: "2.0.0"
  max_version: "2.99.0"

# æƒé™éœ€æ±‚
permissions:
  - network: ["api.example.com"]
  - filesystem:
      read: ["./data/*"]

# é…ç½®é¡¹
config_schema:
  api_key:
    type: string
    required: true
    description: APIå¯†é’¥
  timeout:
    type: integer
    default: 30
    description: è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

# å…¥å£ç‚¹
entry_point: my_awesome_plugin.plugin:MyAwesomePlugin
```

### æ’ä»¶ä¸»ç±»

```python
# my_awesome_plugin/plugin.py
from clawdbot.plugins import BasePlugin, PluginContext, PluginResult
from typing import Dict, Any

class MyAwesomePlugin(BasePlugin):
    """æˆ‘çš„ç¬¬ä¸€ä¸ªæ’ä»¶"""

    # æ’ä»¶å…ƒæ•°æ®
    metadata = {
        "name": "my-awesome-plugin",
        "version": "0.1.0",
        "description": "ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ’ä»¶"
    }

    def __init__(self, config: Dict[str, Any]):
        """åˆå§‹åŒ–æ’ä»¶"""
        super().__init__(config)

        # ä»é…ç½®ä¸­è¯»å–å‚æ•°
        self.api_key = config.get("api_key")
        self.timeout = config.get("timeout", 30)

        # åˆå§‹åŒ–å…¶ä»–èµ„æº
        self.client = None

    async def initialize(self, context: PluginContext):
        """æ’ä»¶åˆå§‹åŒ–ï¼ˆå¯é€‰ï¼‰"""
        # åœ¨è¿™é‡Œæ‰§è¡Œä¸€æ¬¡æ€§åˆå§‹åŒ–æ“ä½œ
        self.logger.info("æ’ä»¶åˆå§‹åŒ–ä¸­...")

        # åˆå§‹åŒ–å®¢æˆ·ç«¯
        self.client = await self.create_client()

    async def execute(
        self,
        inputs: Dict[str, Any],
        context: PluginContext
    ) -> PluginResult:
        """
        æ‰§è¡Œæ’ä»¶æ ¸å¿ƒé€»è¾‘

        Args:
            inputs: è¾“å…¥æ•°æ®
            context: æ‰§è¡Œä¸Šä¸‹æ–‡

        Returns:
            PluginResult: æ‰§è¡Œç»“æœ
        """
        try:
            # å¤„ç†è¾“å…¥æ•°æ®
            processed_data = await self.process_data(inputs)

            # è¿”å›æˆåŠŸç»“æœ
            return PluginResult(
                success=True,
                data=processed_data,
                message="å¤„ç†æˆåŠŸ"
            )

        except Exception as e:
            # è¿”å›å¤±è´¥ç»“æœ
            self.logger.error(f"æ’ä»¶æ‰§è¡Œå¤±è´¥: {e}")
            return PluginResult(
                success=False,
                error=str(e),
                message="å¤„ç†å¤±è´¥"
            )

    async def process_data(self, data: Dict[str, Any]) -> Dict[str, Any]:
        """å¤„ç†æ•°æ®ï¼ˆç¤ºä¾‹å®ç°ï¼‰"""
        # è¿™é‡Œå®ç°ä½ çš„ä¸šåŠ¡é€»è¾‘
        result = {
            "original": data,
            "processed": f"å·²å¤„ç†: {data}",
            "timestamp": self.get_current_timestamp()
        }
        return result

    async def shutdown(self, context: PluginContext):
        """æ’ä»¶æ¸…ç†ï¼ˆå¯é€‰ï¼‰"""
        self.logger.info("æ’ä»¶å…³é—­ä¸­...")

        # æ¸…ç†èµ„æº
        if self.client:
            await self.client.close()

    # è¾…åŠ©æ–¹æ³•
    async def create_client(self):
        """åˆ›å»ºå®¢æˆ·ç«¯"""
        # å®ç°å®¢æˆ·ç«¯åˆ›å»ºé€»è¾‘
        return SomeAPIClient(self.api_key, timeout=self.timeout)

    def get_current_timestamp(self) -> str:
        """è·å–å½“å‰æ—¶é—´æˆ³"""
        from datetime import datetime
        return datetime.now().isoformat()
```

### æµ‹è¯•æ’ä»¶

```python
# tests/test_plugin.py
import pytest
from my_awesome_plugin.plugin import MyAwesomePlugin

@pytest.fixture
async def plugin():
    """åˆ›å»ºæ’ä»¶å®ä¾‹"""
    config = {
        "api_key": "test_key",
        "timeout": 10
    }
    plugin = MyAwesomePlugin(config)
    await plugin.initialize(None)
    yield plugin
    await plugin.shutdown(None)

@pytest.mark.asyncio
async def test_plugin_execute(plugin):
    """æµ‹è¯•æ’ä»¶æ‰§è¡Œ"""
    inputs = {
        "message": "Hello, World!"
    }

    result = await plugin.execute(inputs, None)

    assert result.success is True
    assert "processed" in result.data
    assert "timestamp" in result.data

@pytest.mark.asyncio
async def test_plugin_error_handling(plugin):
    """æµ‹è¯•é”™è¯¯å¤„ç†"""
    # ä¼ å…¥æ— æ•ˆè¾“å…¥
    result = await plugin.execute({}, None)

    # éªŒè¯é”™è¯¯å¤„ç†
    assert result.success is False
    assert result.error is not None
```

è¿è¡Œæµ‹è¯•ï¼š

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio

# è¿è¡Œæµ‹è¯•
pytest tests/

# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
pytest tests/ -v
```

---

## æ’ä»¶æ¶æ„

### æ ¸å¿ƒç±»å›¾

```
BasePlugin (æŠ½è±¡åŸºç±»)
    â”‚
    â”œâ”€â”€ metadata (å…ƒæ•°æ®)
    â”œâ”€â”€ config (é…ç½®)
    â”œâ”€â”€ logger (æ—¥å¿—å™¨)
    â”‚
    â”œâ”€â”€ initialize(ctx)      # åˆå§‹åŒ–
    â”œâ”€â”€ execute(inputs, ctx) # æ‰§è¡Œ
    â””â”€â”€ shutdown(ctx)       # æ¸…ç†
           â”‚
           â–¼
    MyPlugin (ä½ çš„æ’ä»¶)
```

### ç”Ÿå‘½å‘¨æœŸ

```mermaid
stateDiagram-v2
    [*] --> Loaded: åŠ è½½æ’ä»¶
    Loaded --> Initialized: initialize()
    Initialized --> Ready: åˆå§‹åŒ–å®Œæˆ
    Ready --> Executing: execute()
    Executing --> Ready: æ‰§è¡Œå®Œæˆ
    Ready --> Error: æ‰§è¡Œå¤±è´¥
    Error --> Ready: é‡è¯•
    Ready --> Shutdown: shutdown()
    Shutdown --> [*]
```

### æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·è¯·æ±‚
    â”‚
    â–¼
éªŒè¯è¾“å…¥
    â”‚
    â–¼
è°ƒç”¨ execute()
    â”‚
    â”œâ”€â–º è·å–æ•°æ®
    â”‚   â”‚
    â”‚   â–¼
    â”‚  å¤„ç†æ•°æ®
    â”‚   â”‚
    â”‚   â–¼
    â”‚  è¿”å›ç»“æœ
    â”‚
    â””â”€â–º é”™è¯¯å¤„ç†
        â”‚
        â–¼
    è¿”å›é”™è¯¯ç»“æœ
```

---

## æ ¸å¿ƒAPI

### 1. é…ç½®API

```python
class MyPlugin(BasePlugin):
    def __init__(self, config: Dict[str, Any]):
        # è·å–é…ç½®å€¼
        self.api_key = config.get("api_key")
        self.timeout = config.get("timeout", 30)

        # å¸¦é»˜è®¤å€¼å’ŒéªŒè¯
        self.max_retries = self.get_config(
            key="max_retries",
            default=3,
            validator=lambda x: x > 0
        )

        # è·å–åµŒå¥—é…ç½®
        db_config = self.get_nested_config("database", {})

        # éªŒè¯å¿…éœ€é…ç½®
        self.validate_config(config)
```

### 2. æ—¥å¿—API

```python
class MyPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # ä¸åŒçº§åˆ«çš„æ—¥å¿—
        self.logger.debug("è°ƒè¯•ä¿¡æ¯")
        self.logger.info("å¤„ç†å¼€å§‹")
        self.logger.warning("è­¦å‘Šä¿¡æ¯")
        self.logger.error("é”™è¯¯ä¿¡æ¯")
        self.logger.critical("ä¸¥é‡é”™è¯¯")

        # ç»“æ„åŒ–æ—¥å¿—
        self.logger.info(
            "å¤„ç†å®Œæˆ",
            extra={
                "task_id": context.task_id,
                "duration": 1.5,
                "items_processed": 100
            }
        )
```

### 3. ä¸Šä¸‹æ–‡API

```python
class MyPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # è·å–ä»»åŠ¡ä¿¡æ¯
        task_id = context.task_id
        task_type = context.task_type

        # è·å–ç”¨æˆ·ä¿¡æ¯
        user_id = context.user_id
        user_permissions = context.permissions

        # è®¿é—®å…±äº«å­˜å‚¨
        shared_data = await context.get_shared_data("key")
        await context.set_shared_data("key", value)

        # å‘é€è¿›åº¦æ›´æ–°
        await context.send_progress(50, "æ­£åœ¨å¤„ç†...")

        # å‘é€é€šçŸ¥
        await context.send_notification({
            "type": "info",
            "message": "å¤„ç†å®Œæˆ"
        })
```

### 4. æ•°æ®åº“API

```python
class MyPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # æŸ¥è¯¢æ•°æ®
        results = await context.db.query(
            "SELECT * FROM users WHERE id = %s",
            [user_id]
        )

        # æ’å…¥æ•°æ®
        await context.db.execute(
            "INSERT INTO logs (message, created_at) VALUES (%s, NOW())",
            ["Log message"]
        )

        # äº‹åŠ¡æ“ä½œ
        async with context.db.transaction() as tx:
            await tx.execute("UPDATE users SET name = %s WHERE id = %s", ["John", 1])
            await tx.execute("INSERT INTO audit (action) VALUES (%s)", ["update"])
```

### 5. ç½‘ç»œAPI

```python
class MyPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # HTTP GET è¯·æ±‚
        response = await context.http.get(
            "https://api.example.com/data",
            headers={"Authorization": f"Bearer {self.api_key}"}
        )
        data = response.json()

        # HTTP POST è¯·æ±‚
        response = await context.http.post(
            "https://api.example.com/submit",
            json={"key": "value"}
        )

        # å¸¦é‡è¯•çš„è¯·æ±‚
        response = await context.http.get(
            "https://api.example.com/data",
            retries=3,
            backoff=2  # æŒ‡æ•°é€€é¿
        )
```

---

## è¿›é˜¶åŠŸèƒ½

### 1. å¼‚æ­¥ä»»åŠ¡

```python
class AsyncPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡
        results = await asyncio.gather(
            self.fetch_data_1(),
            self.fetch_data_2(),
            self.fetch_data_3()
        )

        # ä½¿ç”¨é˜Ÿåˆ—å¤„ç†å¤§é‡ä»»åŠ¡
        queue = asyncio.Queue()

        # ç”Ÿäº§è€…
        await self.produce_tasks(queue, inputs)

        # æ¶ˆè´¹è€…ï¼ˆå¤šä¸ªworkerï¼‰
        workers = [
            self.process_tasks(queue) for _ in range(5)
        ]
        await asyncio.gather(*workers)
```

### 2. æµå¼å¤„ç†

```python
class StreamPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # æµå¼è¯»å–å¤§æ–‡ä»¶
        async for line in self.read_stream(inputs["file_path"]):
            processed = await self.process_line(line)

            # å‘é€è¿›åº¦æ›´æ–°
            await context.send_progress(
                progress=0.5,
                message=f"å·²å¤„ç†: {processed}"
            )

    async def read_stream(self, file_path):
        """å¼‚æ­¥è¯»å–æ–‡ä»¶æµ"""
        async with aiofiles.open(file_path, 'r') as f:
            async for line in f:
                yield line.strip()
```

### 3. ç¼“å­˜æœºåˆ¶

```python
class CachedPlugin(BasePlugin):
    def __init__(self, config):
        super().__init__(config)
        self.cache_enabled = config.get("cache_enabled", True)
        self.cache_ttl = config.get("cache_ttl", 3600)

    async def execute(self, inputs, context):
        # æ£€æŸ¥ç¼“å­˜
        cache_key = self.generate_cache_key(inputs)

        if self.cache_enabled:
            cached_result = await context.cache.get(cache_key)
            if cached_result:
                self.logger.info("ä»ç¼“å­˜è¿”å›ç»“æœ")
                return PluginResult(success=True, data=cached_result)

        # æ‰§è¡Œå®é™…å¤„ç†
        result = await self.process_data(inputs)

        # ä¿å­˜åˆ°ç¼“å­˜
        if self.cache_enabled:
            await context.cache.set(cache_key, result, ttl=self.cache_ttl)

        return PluginResult(success=True, data=result)
```

### 4. é”™è¯¯é‡è¯•

```python
class RetryPlugin(BasePlugin):
    async def execute(self, inputs, context):
        max_retries = 3
        retry_delay = 1

        for attempt in range(max_retries):
            try:
                result = await self.call_external_api(inputs)
                return PluginResult(success=True, data=result)

            except TemporaryError as e:
                if attempt < max_retries - 1:
                    self.logger.warning(f"é‡è¯• {attempt + 1}/{max_retries}: {e}")
                    await asyncio.sleep(retry_delay * (2 ** attempt))  # æŒ‡æ•°é€€é¿
                else:
                    raise

        raise MaxRetriesExceeded("è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°")
```

### 5. æ‰¹å¤„ç†

```python
class BatchPlugin(BasePlugin):
    async def execute(self, inputs, context):
        items = inputs["items"]
        batch_size = 100

        # åˆ†æ‰¹å¤„ç†
        for i in range(0, len(items), batch_size):
            batch = items[i:i + batch_size]

            # å¤„ç†æ‰¹æ¬¡
            await self.process_batch(batch)

            # å‘é€è¿›åº¦
            progress = ((i + batch_size) / len(items)) * 100
            await context.send_progress(
                progress=min(progress, 100),
                message=f"å·²å¤„ç† {min(i + batch_size, len(items))}/{len(items)} é¡¹"
            )
```

---

## æµ‹è¯•ä¸è°ƒè¯•

### å•å…ƒæµ‹è¯•

```python
import pytest
from unittest.mock import AsyncMock, patch

class TestMyPlugin:
    @pytest.fixture
    def plugin_config(self):
        return {
            "api_key": "test_key",
            "timeout": 10
        }

    @pytest.fixture
    async def plugin(self, plugin_config):
        plugin = MyPlugin(plugin_config)
        await plugin.initialize(None)
        yield plugin
        await plugin.shutdown(None)

    @pytest.mark.asyncio
    async def test_success_case(self, plugin):
        inputs = {"data": "test"}
        result = await plugin.execute(inputs, None)

        assert result.success is True
        assert "processed" in result.data

    @pytest.mark.asyncio
    async def test_error_case(self, plugin):
        inputs = {}
        result = await plugin.execute(inputs, None)

        assert result.success is False

    @pytest.mark.asyncio
    @patch('my_plugin.ExternalAPI')
    async def test_external_api_call(self, mock_api, plugin):
        # Mock å¤–éƒ¨API
        mock_api.return_value.fetch_data = AsyncMock(return_value={"data": "test"})

        inputs = {"id": 123}
        result = await plugin.execute(inputs, None)

        assert result.success is True
        mock_api.assert_called_once()
```

### é›†æˆæµ‹è¯•

```python
@pytest.mark.integration
class TestPluginIntegration:
    async def test_full_workflow(self):
        # åˆ›å»ºçœŸå®çš„ä¸Šä¸‹æ–‡
        context = await self.create_test_context()

        plugin = MyPlugin(self.config)
        await plugin.initialize(context)

        try:
            # æ‰§è¡Œå®Œæ•´æµç¨‹
            inputs = self.create_test_inputs()
            result = await plugin.execute(inputs, context)

            assert result.success is True

            # éªŒè¯æ•°æ®åº“çŠ¶æ€
            records = await context.db.query("SELECT * FROM results WHERE task_id = %s", [context.task_id])
            assert len(records) > 0

        finally:
            await plugin.shutdown(context)
```

### è°ƒè¯•æŠ€å·§

```python
class DebugPlugin(BasePlugin):
    async def execute(self, inputs, context):
        # å¯ç”¨è¯¦ç»†æ—¥å¿—
        self.logger.setLevel(logging.DEBUG)

        # æ‰“å°è°ƒè¯•ä¿¡æ¯
        self.logger.debug(f"è¾“å…¥: {inputs}")
        self.logger.debug(f"é…ç½®: {self.config}")

        # ä½¿ç”¨ pdb è°ƒè¯•
        import pdb; pdb.set_trace()

        # æ€§èƒ½åˆ†æ
        import time
        start = time.time()

        # ... æ‰§è¡Œé€»è¾‘ ...

        duration = time.time() - start
        self.logger.info(f"æ‰§è¡Œè€—æ—¶: {duration:.2f}ç§’")
```

---

## æ‰“åŒ…ä¸å‘å¸ƒ

### 1. æ‰“åŒ…æ’ä»¶

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
# åœ¨ manifest.yaml ä¸­æ›´æ–° version: "1.0.0"

# 2. æ„å»ºåˆ†å‘åŒ…
clawdbot plugin build

# è¿™å°†ç”Ÿæˆï¼š
# dist/my-awesome-plugin-1.0.0.tar.gz
# dist/my-awesome-plugin-1.0.0.whl

# 3. éªŒè¯åŒ…
clawdbot plugin validate dist/my-awesome-plugin-1.0.0.whl
```

### 2. æœ¬åœ°æµ‹è¯•

```bash
# å®‰è£…æ‰“åŒ…å¥½çš„æ’ä»¶
pip install dist/my-awesome-plugin-1.0.0.whl

# åœ¨ ClawdBot ä¸­åŠ è½½æ’ä»¶
clawdbot plugin install my-awesome-plugin --local

# æµ‹è¯•æ’ä»¶
clawdbot plugin test my-awesome-plugin
```

### 3. å‘å¸ƒåˆ°æ’ä»¶å¸‚åœº

```bash
# 1. ç™»å½•æ’ä»¶å¸‚åœº
clawdbot plugin login

# 2. å‘å¸ƒæ’ä»¶
clawdbot plugin publish dist/my-awesome-plugin-1.0.0.whl

# å‘å¸ƒæˆåŠŸåï¼Œç”¨æˆ·å¯ä»¥è¿™æ ·å®‰è£…ï¼š
# clawdbot plugin install my-awesome-plugin
```

### 4. æŒç»­é›†æˆ

```yaml
# .github/workflows/ci.yml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-asyncio

      - name: Run tests
        run: pytest tests/ -v

      - name: Build plugin
        run: clawdbot plugin build
```

---

## æœ€ä½³å®è·µ

### 1. ä»£ç è´¨é‡

```python
# âœ… å¥½çš„å®è·µ
class WellStructuredPlugin(BasePlugin):
    """æ¸…æ™°çš„æ–‡æ¡£å­—ç¬¦ä¸²"""

    async def process_data(self, data: Dict[str, Any]) -> Dict[str, Any]:
        """
        å¤„ç†è¾“å…¥æ•°æ®

        Args:
            data: è¾“å…¥æ•°æ®å­—å…¸

        Returns:
            å¤„ç†åçš„æ•°æ®

        Raises:
            ValueError: å½“æ•°æ®æ ¼å¼ä¸æ­£ç¡®æ—¶
        """
        # å®ç°é€»è¾‘
        pass

# âŒ é¿å…çš„åšæ³•
class BadPlugin(BasePlugin):
    def process_data(self, data):  # ç¼ºå°‘ç±»å‹æ³¨è§£
        # å¤„ç†æ•°æ®  # ç¼ºå°‘æ–‡æ¡£å­—ç¬¦ä¸²
        pass
```

### 2. é”™è¯¯å¤„ç†

```python
class RobustPlugin(BasePlugin):
    async def execute(self, inputs, context):
        try:
            result = await self.process(inputs)

        except ValidationError as e:
            # ä¸šåŠ¡é€»è¾‘é”™è¯¯
            return PluginResult(
                success=False,
                error_code="VALIDATION_ERROR",
                message=f"è¾“å…¥éªŒè¯å¤±è´¥: {e}"
            )

        except NetworkError as e:
            # ç½‘ç»œé”™è¯¯
            self.logger.error(f"ç½‘ç»œé”™è¯¯: {e}")
            return PluginResult(
                success=False,
                error_code="NETWORK_ERROR",
                message="ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"
            )

        except Exception as e:
            # æœªé¢„æœŸçš„é”™è¯¯
            self.logger.exception(f"æœªçŸ¥é”™è¯¯: {e}")
            return PluginResult(
                success=False,
                error_code="INTERNAL_ERROR",
                message="å†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"
            )
```

### 3. æ€§èƒ½ä¼˜åŒ–

```python
class OptimizedPlugin(BasePlugin):
    # ä½¿ç”¨ç±»å˜é‡ç¼“å­˜ä¸å˜æ•°æ®
    STATIC_DATA = self.load_static_data()

    async def execute(self, inputs, context):
        # ä½¿ç”¨å¼‚æ­¥IO
        async with aiohttp.ClientSession() as session:
            result = await session.get(url)

        # ä½¿ç”¨ç”Ÿæˆå™¨å¤„ç†å¤§æ•°æ®
        for item in self.process_generator(large_data):
            yield item

        # æ‰¹é‡æ“ä½œæ•°æ®åº“
        await self.batch_insert(items, batch_size=100)
```

### 4. å®‰å…¨å®è·µ

```python
class SecurePlugin(BasePlugin):
    async def execute(self, inputs, context):
        # éªŒè¯è¾“å…¥
        if not self.validate_inputs(inputs):
            raise ValidationError("æ— æ•ˆè¾“å…¥")

        # æ¸…ç†æ•æ„Ÿæ•°æ®
        safe_inputs = self.sanitize(inputs)

        # ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
        await context.db.query(
            "SELECT * FROM users WHERE id = %s",
            [user_id]  # å‚æ•°åŒ–
        )

        # ä¸è®°å½•æ•æ„Ÿä¿¡æ¯
        self.logger.info(f"å¤„ç†è¯·æ±‚: {task_id}")  # ä¸è®°å½•å®Œæ•´inputs
```

### 5. æ–‡æ¡£

```python
class DocumentedPlugin(BasePlugin):
    """
    æˆ‘çš„è¶…æ£’æ’ä»¶

    è¿™ä¸ªæ’ä»¶å®ç°äº†ä»¥ä¸‹åŠŸèƒ½ï¼š
    - åŠŸèƒ½1
    - åŠŸèƒ½2
    - åŠŸèƒ½3

    é…ç½®é¡¹ï¼š
        api_key (str): APIå¯†é’¥
        timeout (int): è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

    ç¤ºä¾‹ï¼š
        >>> plugin = MyPlugin({"api_key": "xxx"})
        >>> result = await plugin.execute({"data": "test"}, context)
    """

    def example_usage(self):
        """
        æä¾›ä½¿ç”¨ç¤ºä¾‹

        ç¤ºä¾‹ä»£ç ï¼š
        ```python
        inputs = {"key": "value"}
        result = await plugin.execute(inputs, context)
        ```
        """
        pass
```

---

## å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [æ’ä»¶APIæ–‡æ¡£](https://docs.clawdbot.dev/plugins/api)
- [æ’ä»¶å¸‚åœºæŒ‡å—](https://docs.clawdbot.dev/plugins/marketplace)
- [æœ€ä½³å®è·µ](https://docs.clawdbot.dev/plugins/best-practices)

### ç¤ºä¾‹æ’ä»¶
- [å®˜æ–¹æ’ä»¶ä»“åº“](https://github.com/clawdbot/plugins)
- [ç¤¾åŒºæ’ä»¶](https://marketplace.clawdbot.dev)

### ç›¸å…³æ–‡æ¡£
- [[ClawdBotå®Œæ•´æŒ‡å—]] - ClawdBot å®Œæ•´ä½¿ç”¨æŒ‡å—
- [[æ’ä»¶å®‰å…¨è§„èŒƒ]] - æ’ä»¶å®‰å…¨å¼€å‘è§„èŒƒ
- [[æ€§èƒ½ä¼˜åŒ–å®è·µ]] - æ’ä»¶æ€§èƒ½ä¼˜åŒ–æŒ‡å—

---

*åˆ›å»ºæ—¶é—´: 2026-01-31*
*æœ€åæ›´æ–°: 2026-01-31*
*åˆ†ç±»: 3 Resources*
