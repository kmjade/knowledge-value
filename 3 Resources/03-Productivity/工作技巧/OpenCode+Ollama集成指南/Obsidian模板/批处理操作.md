---
tags:
  - opencode
  - ollama
  - batch
  - automation
  - workflow
created: <% tp.file.creation_date() %>
---

# âš¡ OpenCode æ‰¹è™•ç†æ“ä½œ / Batch Operations

## ğŸ¯ æ“ä½œç±»å‹ / Operation Type

<%*
const batchTypes = [
# åˆ†æ
    'ğŸ”„ æ‰¹é‡æ ¼å¼è½¬æ¢ - Bulk format conversion',
    'ğŸ·ï¸ æ‰¹é‡æ¨™ç±¤ç”Ÿæˆ - Bulk tag generation',
    'ğŸ“Š æ‰¹é‡æ•¸æ“šæå– - Bulk data extraction',
    'ğŸ”— æ‰¹é‡é€£çµæª¢æŸ¥ - Bulk link verification',
    'ğŸ› ï¸ æ‰¹é‡ä»£ç¢¼é‡æ„ - Bulk code refactoring',
    'ğŸ“ æ‰¹é‡æ–‡æª”ç”Ÿæˆ - Bulk documentation generation',
    'ğŸ§ª æ‰¹é‡æ¸¬è©¦ç”Ÿæˆ - Bulk test generation'
];

const batchValues = [
    'file-analysis', 'format-conversion', 'tag-generation', 
    'data-extraction', 'link-verification', 'code-refactoring',
    'documentation-generation', 'test-generation'
];

const selectedBatchType = await tp.system.suggester(
    batchTypes,
    batchValues,
    false,
    'é¸æ“‡æ‰¹è™•ç†ç±»å‹ / Select batch operation type:'
);
-%>

### ğŸ“‹ é¸æ“‡çš„æ“ä½œ / Selected Operation
**ç±»å‹**: `<% selectedBatchType %>`
**åç§°**: `<% batchTypes[batchValues.indexOf(selectedBatchType)] %>`

---

## ğŸ“‚ ç›®æ¨™æª”æ¡ˆé¸æ“‡ / Target File Selection

### é¸æ“‡èŒƒå›´ / Selection Scope

<%*
const scopes = [
    'ğŸ“ å½“å‰è³‡æ–™å¤¾ - Current folder',
    'ğŸŒ æ•´ä¸ªä»“åº“ - Entire vault', 
    'ğŸ·ï¸ æŒ‰æ¨™ç±¤ç¯©é¸ - Filter by tag',
    'ğŸ“… æŒ‰æ—¥æœŸç¯©é¸ - Filter by date',
    'ğŸ”¤ æŒ‰æª”æ¡ˆç±»å‹ç¯©é¸ - Filter by file type',
    'ğŸ“‹ è‡ªå®šä¹‰æª”æ¡ˆåˆ—è¡¨ - Custom file list'
];

const scopeValues = ['folder', 'vault', 'tag', 'date', 'filetype', 'custom'];

const selectedScope = await tp.system.suggester(
    scopes,
    scopeValues,
    false,
    'é¸æ“‡è™•ç†èŒƒå›´ / Select processing scope:'
);

let filterCriteria = "";
let dataviewQuery = "";

// æ ¹æ®é¸æ“‡èŒƒå›´è¨­ç½®æŸ¥è©¢æ¡ä»¶
switch (selectedScope) {
    case 'folder':
        const currentFolder = tp.file.folder;
        dataviewQuery = `FROM "${currentFolder}"`;
        break;
        
    case 'tag':
        filterCriteria = await tp.system.prompt("è¼¸å…¥æ¨™ç±¤ / Enter tag:");
        dataviewQuery = `FROM #${filterCriteria}`;
        break;
        
    case 'date':
        filterCriteria = await tp.system.prompt("è¼¸å…¥æ—¥æœŸèŒƒå›´ (YYYY-MM-DD) / Enter date range:");
        const dateRange = filterCriteria.includes('..') ? filterCriteria : `>= ${filterCriteria}`;
        dataviewQuery = `FROM "" WHERE file.mday >= date("${dateRange}")`;
        break;
        
    case 'filetype':
        const fileTypes = ['.md', '.py', '.js', '.ts', '.java', '.cpp', '.go'];
        const selectedType = await tp.system.suggester(fileTypes, fileTypes, false, 'é¸æ“‡æª”æ¡ˆç±»å‹:');
        filterCriteria = selectedType;
        dataviewQuery = `WHERE contains(file.path, "${selectedType}")`;
        break;
        
    case 'custom':
        const customFiles = await tp.system.prompt("è¼¸å…¥æª”æ¡ˆè·¯å¾‘åˆ—è¡¨ (ç”¨é€—å·åˆ†éš”) / Enter file paths (comma-separated):");
        filterCriteria = customFiles;
        break;
        
    default:
        dataviewQuery = '';
}
-%>

| è¨­ç½® / Setting | å€¼ / Value |
|---------------|-----------|
| **èŒƒå›´ / Scope** | `<% scopes[scopeValues.indexOf(selectedScope)] %>` |
| **ç¯©é¸æ¡ä»¶ / Filter** | `<% filterCriteria || "ç„¡" %>` |

---

## ğŸ“Š ç”Ÿæˆçš„DataviewæŸ¥è©¢ / Generated Dataview Query

<details>
<summary>æŸ¥è©¢é è¦½ / Query Preview</summary>

```dataview
# ä¿®æ”¹
<% dataviewQuery ? dataviewQuery : 'FROM ""' %>
SORT file.mtime DESC
LIMIT 20
```

**æŸ¥è©¢èªªæ˜ / Query Explanation**:
<%*
const explanations = {
    'folder': 'åˆ—å‡ºå½“å‰è³‡æ–™å¤¾ä¸‹çš„æ‰€æœ‰æª”æ¡ˆ',
    'tag': `åˆ—å‡ºåŒ…å«æ¨™ç±¤ #${filterCriteria} çš„æª”æ¡ˆ`,
# ä¿®æ”¹
    'filetype': `åˆ—å‡ºæ‰€æœ‰ ${filterCriteria} æª”æ¡ˆ`,
    'custom': 'è™•ç†ä½¿ç”¨è€…æŒ‡å®šçš„æª”æ¡ˆåˆ—è¡¨',
    'vault': 'è™•ç†æ•´ä¸ªä»“åº“ä¸­çš„æ‰€æœ‰æª”æ¡ˆ'
};
-%>
`<% explanations[selectedScope] %>`

</details>

---

# é…ç½®

### æ¨¡å‹é¸æ“‡ / Model Selection

<%*
// æª¢æŸ¥å¯ç”¨æ¨¡å‹
const modelStatus = await tp.user.checkLocalModels();
const availableModels = modelStatus.status === 'available' 
    ? modelStatus.models.map(m => m.name)
    : ['qwen2.5-coder:7b', 'qwen2.5:7b', 'mistral-nemo:12b'];

const selectedModel = await tp.system.suggester(
    availableModels,
    availableModels,
    false,
    'é¸æ“‡æ‰¹è™•ç†æ¨¡å‹ / Select batch processing model:'
);

// æ‰¹è™•ç†å¤§å°è¨­ç½®
const batchSize = await tp.system.prompt(
    "æ‰¹è™•ç†å¤§å° (å»ºè­° 5-20) / Batch size (recommended 5-20):",
    "10"
);

const batchSizeNum = parseInt(batchSize) || 10;

// å¹¶å‘è¨­ç½®
const concurrency = await tp.system.prompt(
    "å¹¶å‘æ•°é‡ (å»ºè­° 1-3) / Concurrency (recommended 1-3):",
    "2"
);

const concurrencyNum = parseInt(concurrency) || 2;
-%>

# é…ç½®
|-----------------|-----------|-------------------|
| **ä½¿ç”¨æ¨¡å‹ / Model** | `<% selectedModel %>` | æ‰¹è™•ç†ä½¿ç”¨çš„AIæ¨¡å‹ |
| **æ‰¹è™•ç†å¤§å° / Batch Size** | `<% batchSizeNum %>` | æ¯æ‰¹è™•ç†çš„æª”æ¡ˆæ•°é‡ |
| **å¹¶å‘æ•° / Concurrency** | `<% concurrencyNum %>` | åŒæ—¶è™•ç†çš„æ‰¹æ¬¡æ•° |
| **é¢„è®¡æ€»æ™‚é–“ / Est. Total Time** | `<% Math.ceil(batchSizeNum / concurrencyNum) * 30 %>-<% Math.ceil(batchSizeNum / concurrencyNum) * 60 %>ç§’ | æ ¹æ®æ¨¡å‹æ•ˆèƒ½ä¼°ç®— |

---

## ğŸ“‹ ç”Ÿæˆçš„æ‰¹è™•ç†è…³æœ¬ / Generated Batch Script

<%*
// æ ¹æ®æ“ä½œç±»å‹ç”Ÿæˆè…³æœ¬
let scriptContent = '';
let scriptName = '';
let fileExtension = '.sh'; // é»˜è®¤ä¸ºshellè…³æœ¬

switch (selectedBatchType) {
    case 'file-analysis':
# åˆ†æ
        scriptContent = `#!/bin/bash
# åˆ†æ
# Generated by OpenCode + Ollama Integration

set -e  # é‡åˆ°é”™è¯¯æ—¶é€€å‡º

# åˆ†æ
# é…ç½®
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo "   å¹¶å‘æ•°: ${concurrencyNum}"
echo ""

# è™•ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
# åˆ†æ
    
# åˆ†æ
# åˆ†æ
        --model ollama/${selectedModel} \\
        --timeout 180 \\
        "$file" > "${file}.analysis.md" 2>&1
    
    if [ $? -eq 0 ]; then
        echo "âœ… [æ‰¹${batch_id}] å®Œæˆ: $file"
    else
        echo "âŒ [æ‰¹${batch_id}] å¤±è´¥: $file"
        echo "   é”™è¯¯è³‡è¨Šå·²å„²å­˜åˆ° ${file}.error.log"
    fi
    
    echo ""
}

# ä¸»è™•ç†é€»è¾‘
batch_id=1
file_count=0

${selectedScope === 'custom' ? `
# è™•ç†è‡ªå®šä¹‰æª”æ¡ˆåˆ—è¡¨
files="${filterCriteria}"
for file in \$(echo "$files" | tr ',' '\\n'); do
    if [ -f "$file" ]; then
        process_file "$file" "$batch_id"
        
        file_count=$((file_count + 1))
        if [ $((file_count % ${batchSizeNum})) -eq 0 ]; then
            batch_id=$((batch_id + 1))
            
            # ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
            wait
            echo "â³ ç­‰å¾…ä¸‹ä¸€æ‰¹æ¬¡..."
            sleep 5
        fi
        
        # å¹¶å‘æ§åˆ¶
        if [ $((file_count % ${concurrencyNum})) -eq 0 ]; then
            wait
        fi
    fi
done
` : `
# ä½¿ç”¨findå°‹æ‰¾æª”æ¡ˆ
find_command="find . -name '*.md' -type f"

${selectedScope === 'folder' ? `find_command="find '${tp.file.folder}' -name '*.md' -type f"` : ''}
${selectedScope === 'tag' ? `# æ ¹æ®æ¨™ç±¤ç¯©é¸éœ€è¦æ‰‹å‹•å¯¦ç¾
echo "âš ï¸ åŸºäºæ¨™ç±¤çš„ç¯©é¸è¯·æ‰‹å‹•æä¾›æª”æ¡ˆåˆ—è¡¨"
exit 1` : ''}
${selectedScope === 'date' ? `find_command="find . -name '*.md' -type f -newermt '${filterCriteria}'"` : ''}
${selectedScope === 'filetype' ? `find_command="find . -name '${filterCriteria}' -type f"` : ''}

# æ‰§è¡Œå°‹æ‰¾å’Œè™•ç†
eval "$find_command" | head -$((${batchSizeNum} * 10)) | while read file; do
    if [ -f "$file" ]; then
        process_file "$file" "$batch_id"
        
        file_count=$((file_count + 1))
        if [ $((file_count % ${batchSizeNum})) -eq 0 ]; then
            batch_id=$((batch_id + 1))
            
            # ç­‰å¾…å½“å‰æ‰¹æ¬¡å®Œæˆ
            wait
            echo "â³ ç­‰å¾…ä¸‹ä¸€æ‰¹æ¬¡..."
            sleep 5
        fi
        
        # å¹¶å‘æ§åˆ¶
        if [ $((file_count % ${concurrencyNum})) -eq 0 ]; then
            wait
        fi
    fi
done
`}

# ç­‰å¾…æ‰€æœ‰ä»»å‹™å®Œæˆ
wait

echo ""
# åˆ†æ
echo "ğŸ“Š è™•ç†çµ±è¨ˆ:"
echo "   è™•ç†æª”æ¡ˆæ•°: $file_count"
echo "   ç”Ÿæˆå ±å‘Šæ•°: $file_count"
echo "   å ±å‘Šä½ç½®: å„æª”æ¡ˆåŒç›®éŒ„çš„ .analysis.md"
`;
        break;
        
    case 'tag-generation':
        scriptName = 'æ‰¹é‡æ¨™ç±¤ç”Ÿæˆ';
        scriptContent = `#!/bin/bash
# æ‰¹é‡æ¨™ç±¤ç”Ÿæˆè…³æœ¬ / Bulk Tag Generation Script
# Generated by OpenCode + Ollama Integration

set -e

echo "ğŸ·ï¸ é–‹å§‹æ‰¹é‡æ¨™ç±¤ç”Ÿæˆ..."
# é…ç½®
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo "   å¹¶å‘æ•°: ${concurrencyNum}"
echo ""

# è™•ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ“ [æ‰¹${batch_id}] ç”Ÿæˆæ¨™ç±¤: $file"
    
    # è®€å–æª”æ¡ˆå…§å®¹
    content=\$(cat "$file")
    
    # ä½¿ç”¨OpenCodeç”Ÿæˆæ¨™ç±¤
    tags=\$(opencode run "åŸºäºé€™å€‹æª”æ¡ˆçš„å…§å®¹ï¼Œç”Ÿæˆ5-10ä¸ªç›¸é—œçš„æ¨™ç±¤ï¼Œç”¨é€—å·åˆ†éš”ï¼Œåªè¿”å›æ¨™ç±¤åˆ—è¡¨" \\
        --model ollama/${selectedModel} \\
        --timeout 120 \\
        "$file" 2>/dev/null | grep -o "[^,]*" | tr '\\n' ',' | sed 's/,$//')
    
    if [ $? -eq 0 ] && [ -n "$tags" ]; then
# æ›´æ–°
        temp_file="\${file}.tmp"
        
        # æª¢æŸ¥æ˜¯å¦å·²æœ‰frontmatter
        if grep -q "^---" "$file"; then
            # å·²æœ‰frontmatterï¼Œæ–°å¢æ¨™ç±¤
            sed -i "/^tags:/a\\  - $tags" "$file"
        else
            # æ–°å¢frontmatterå’Œæ¨™ç±¤
            cat > "$temp_file" << EOF
---
tags:
  - $tags
---

$content
EOF
            mv "$temp_file" "$file"
        fi
        
        echo "âœ… [æ‰¹${batch_id}] æ¨™ç±¤å·²æ–°å¢: $tags"
    else
        echo "âŒ [æ‰¹${batch_id}] æ¨™ç±¤ç”Ÿæˆå¤±è´¥: $file"
    fi
    
    echo ""
}

# åˆ†æ
${selectedScope === 'custom' ? `
files="${filterCriteria}"
for file in \$(echo "$files" | tr ',' '\\n'); do
    if [ -f "$file" ]; then
        process_file "$file" "1"
    fi
done
` : `
find . -name '*.md' -type f | head -$((${batchSizeNum} * 10)) | while read file; do
    process_file "$file" "1"
done
`}

wait
echo "ğŸ‰ æ‰¹é‡æ¨™ç±¤ç”Ÿæˆå®Œæˆï¼"
`;
        break;
        
    case 'code-refactoring':
        scriptName = 'æ‰¹é‡ä»£ç¢¼é‡æ„';
        scriptContent = `#!/bin/bash
# æ‰¹é‡ä»£ç¢¼é‡æ„è…³æœ¬ / Bulk Code Refactoring Script
# Generated by OpenCode + Ollama Integration

set -e

echo "ğŸ› ï¸ é–‹å§‹æ‰¹é‡ä»£ç¢¼é‡æ„..."
# é…ç½®
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo ""

# è™•ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ”§ [æ‰¹${batch_id}] é‡æ„æª”æ¡ˆ: $file"
    
    # å‰µå»ºå‚™ä»½
    cp "$file" "${file}.backup"
    
    # ä½¿ç”¨OpenCodeé‡æ„ä»£ç¢¼
    opencode run "é‡æ„é€™å€‹æª”æ¡ˆä¸­çš„ä»£ç¢¼ï¼Œæ”¹è¿›å¯è¯»æ€§ã€æ•ˆèƒ½å’Œå¯ç¶­è­·æ€§ï¼Œä¿æŒåŠŸèƒ½ä¸å˜ï¼Œç›´æ¥è¼¸å‡ºé‡æ„åçš„å®Œæ•´ä»£ç¢¼" \\
        --model ollama/${selectedModel} \\
        --timeout 300 \\
        "$file" > "${file}.refactored" 2>&1
    
    if [ $? -eq 0 ]; then
        # é©—è­‰é‡æ„çµæœ
        if [ -s "${file}.refactored" ]; then
            mv "${file}.refactored" "$file"
            echo "âœ… [æ‰¹${batch_id}] é‡æ„å®Œæˆ: $file"
        else
            echo "âŒ [æ‰¹${batch_id}] é‡æ„çµæœä¸ºç©º: $file"
            mv "${file}.backup" "$file"
        fi
    else
        echo "âŒ [æ‰¹${batch_id}] é‡æ„å¤±è´¥: $file"
        mv "${file}.backup" "$file"
        rm -f "${file}.refactored"
    fi
    
    echo ""
}

# è™•ç†ä»£ç¢¼æª”æ¡ˆ
find . -name '*.py' -o -name '*.js' -o -name '*.ts' -o -name '*.java' | head -$((${batchSizeNum} * 5)) | while read file; do
    process_file "$file" "1"
done

wait
echo "ğŸ‰ æ‰¹é‡ä»£ç¢¼é‡æ„å®Œæˆï¼"
echo "ğŸ“Š å‚™ä»½æª”æ¡ˆä½ç½®: *.backup"
`;
        break;
        
    default:
        scriptName = 'é€šç”¨æ‰¹è™•ç†è…³æœ¬';
        scriptContent = `#!/bin/bash
# é€šç”¨æ‰¹è™•ç†è…³æœ¬ / Generic Batch Processing Script
# Generated by OpenCode + Ollama Integration

set -e

echo "âš¡ é–‹å§‹æ‰¹è™•ç†æ“ä½œ..."
# é…ç½®
echo "   æ“ä½œç±»å‹: ${selectedBatchType}"
echo "   æ¨¡å‹: ${selectedModel}"
echo "   æ‰¹å¤§å°: ${batchSizeNum}"
echo ""

# é€šç”¨è™•ç†å‡½æ•°
process_file() {
    local file="$1"
    local batch_id="$2"
    
    echo "ğŸ“ [æ‰¹${batch_id}] è™•ç†æª”æ¡ˆ: $file"
    
    # æ ¹æ®æ“ä½œç±»å‹æ‰§è¡Œä¸åŒçš„OpenCodeå‘½ä»¤
    case "${selectedBatchType}" in
        "data-extraction")
            opencode run "ä»æª”æ¡ˆä¸­æå–é—œéµæ•¸æ“šå’Œè³‡è¨Šï¼Œç»“æ„åŒ–è¼¸å‡º" --model ollama/${selectedModel} "$file"
            ;;
        "documentation-generation")
            opencode run "ä¸ºé€™å€‹æª”æ¡ˆç”Ÿæˆå®Œæ•´çš„æ–‡æª”èªªæ˜" --model ollama/${selectedModel} "$file"
            ;;
        "test-generation")
            opencode run "ä¸ºé€™å€‹ä»£ç¢¼æª”æ¡ˆç”Ÿæˆå…¨é¢çš„å•å…ƒæ¸¬è©¦" --model ollama/${selectedModel} "$file"
            ;;
        "format-conversion")
            opencode run "å°†æª”æ¡ˆå…§å®¹è½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼" --model ollama/${selectedModel} "$file"
            ;;
        *)
            opencode run "å¯¹æª”æ¡ˆæ‰§è¡Œ${selectedBatchType}æ“ä½œ" --model ollama/${selectedModel} "$file"
            ;;
    esac
    
    echo "âœ… [æ‰¹${batch_id}] è™•ç†å®Œæˆ: $file"
    echo ""
}

# æ‰§è¡Œè™•ç†
find . -name '*.md' -type f | head -$((${batchSizeNum} * 5)) | while read file; do
    process_file "$file" "1"
done

wait
echo "ğŸ‰ æ‰¹è™•ç†æ“ä½œå®Œæˆï¼"
`;
}

// è¨­ç½®è…³æœ¬æª”æ¡ˆå
scriptFileName = `${tp.date.now('YYYY-MM-DD')}-${scriptName.replaceAll(' ', '-')}.sh`;
-%>

<details>
<summary>ğŸ“„ å®Œæ•´è…³æœ¬ / Complete Script</summary>

```bash
<% scriptContent %>
```

</details>

---

## ğŸ“‹ æ‰§è¡Œè¨ˆåŠƒ / Execution Plan

### éšæ®µ 1: å‡†å¤‡å·¥ä½œ / Phase 1: Preparation

| ä»»å‹™ / Task | ç‹€æ…‹ / Status | å¤‡æ³¨ / Notes |
|-----------|-------------|-------------|
| [ ] æª¢æŸ¥OllamaæœåŠ¡ç‹€æ…‹ | â³ å¾…æ‰§è¡Œ | `ollama serve` |
| [ ] é©—è­‰æ¨¡å‹å¯ç”¨æ€§ | â³ å¾…æ‰§è¡Œ | `ollama list` |
| [ ] å‚™ä»½é‡è¦æª”æ¡ˆ | â³ å¾…æ‰§è¡Œ | å‰µå»ºæª”æ¡ˆå‚™ä»½ |
| [ ] è¨­ç½®æ‰§è¡Œæƒé™ | â³ å¾…æ‰§è¡Œ | `chmod +x script.sh` |

### éšæ®µ 2: æ‰§è¡Œè™•ç† / Phase 2: Execution

| æ­¥éª¤ / Step | å‘½ä»¤ / Command | é¢„æœŸæ™‚é–“ / Est. Time |
|-------------|----------------|-------------------|
| **1. å„²å­˜è…³æœ¬** | å‰µå»º `<% scriptFileName %>` æª”æ¡ˆ | 1åˆ†é’Ÿ |
| **2. è¨­ç½®æƒé™** | `chmod +x <% scriptFileName %>` | 10ç§’ |
| **3. æ‰§è¡Œè…³æœ¬** | `./<% scriptFileName %>` | `<% Math.ceil(batchSizeNum / concurrencyNum) * 60 %>ç§’ |
| **4. ç›£æ§è¿›åº¦** | è§‚å¯Ÿç»ˆç«¯è¼¸å‡º | æŒçºŒ |

### éšæ®µ 3: é©—è­‰çµæœ / Phase 3: Verification

# æ–¹æ³•
|-------------------|---------------------------|
| **è™•ç†å®Œæˆåº¦** | æª¢æŸ¥è¼¸å‡ºæª”æ¡ˆæ•°é‡ |
# æŸ¥çœ‹
| **æª”æ¡ˆå®Œæ•´æ€§** | ç¢ºèªåŸå§‹æª”æ¡ˆæœªæŸå |
| **å‚™ä»½å®Œæ•´æ€§** | é©—è­‰å‚™ä»½æª”æ¡ˆå­˜åœ¨ |

---

## âš¡ æ•ˆèƒ½å„ªåŒ–å»ºè­° / Performance Optimization

### ğŸš€ æ‰§è¡Œå„ªåŒ–
```bash
# 1. è¨­ç½®ç’°å¢ƒå˜é‡å„ªåŒ–æ•ˆèƒ½
export OLLAMA_NUM_PARALLEL=4          # å¢åŠ å¹¶è¡Œè™•ç†
export OLLAMA_MAX_LOADED_MODELS=2      # é¢„åŠ è½½æ¨¡å‹
export OLLAMA_GPU_MEMORY_FRACTION=0.8  # GPUè¨˜æ†¶é«”åˆ†é…

# 2. ä½¿ç”¨screenåå°æ‰§è¡Œ
screen -S opencode-batch ./<% scriptFileName %>

# 3. ç›£æ§ç³»çµ±è³‡æº
htop           # CPUå’Œè¨˜æ†¶é«”ç›£æ§
nvidia-smi      # GPUç›£æ§
iotop           # I/Oç›£æ§
```

# ç®¡ç†
<%*
# é…ç½®
const estimatedMemoryPerModel = {
    'qwen2.5-coder:14b': 14000,
    'qwen2.5-coder:7b': 7000,
    'qwen2.5:7b': 7000,
    'mistral-nemo:12b': 12000
};

const modelMemory = estimatedMemoryPerModel[selectedModel] || 8000;
const totalMemoryNeeded = modelMemory * concurrencyNum;
-%>

| è³‡æº / Resource | é¢„ä¼°éœ€æ±‚ / Estimated Need | å»ºè­° / Recommendation |
|----------------|-------------------------|-------------------|
| **GPUè¨˜æ†¶é«” / GPU VRAM** | `<% Math.round(totalMemoryNeeded / 1024) %>GB` | ç¡®ä¿æœ‰è¶³å¤ çš„GPUè¨˜æ†¶é«” |
| **ç³»çµ±è¨˜æ†¶é«” / System RAM** | `<% Math.round(totalMemoryNeeded * 1.5 / 1024) %>GB` | é¢„ç•™é¢å¤–ç©ºé–“ |
| **å¹¶å‘è¿›ç¨‹ / Concurrent Processes** | `<% concurrencyNum %>` | æ ¹æ®ç¡¬é«”è°ƒæ•´ |
| **ç£ç¢Ÿç©ºé–“ / Disk Space** | `<% batchSizeNum * 10 %>MB` | ç”¨äºè¼¸å‡ºæª”æ¡ˆ |

---

## ğŸ“¤ çµæœå½™ç¸½ / Results Summary

> [!note] ğŸ“Š æ‰¹è™•ç†çµæœå½™ç¸½ / Batch Processing Results Summary
> åœ¨æ­¤å½™ç¸½æ‰€æœ‰æ‰¹è™•ç†æ“ä½œçš„çµæœå’Œçµ±è¨ˆè³‡è¨Š

<details>
<summary>çµæœçµ±è¨ˆæ¨¡æ¿ / Results Statistics Template</summary>

### ğŸ“Š è™•ç†çµ±è¨ˆ / Processing Statistics
- **é–‹å§‹æ™‚é–“**: 
- **çµæŸæ™‚é–“**: 
- **æ€»è™•ç†æ™‚é–“**: 
- **è™•ç†æª”æ¡ˆæ€»æ•°**: 
- **æˆåŠŸè™•ç†æ•°**: 
- **å¤±è´¥è™•ç†æ•°**: 
- **æˆåŠŸç‡**: 

### ğŸ“‹ å¤±è´¥æª”æ¡ˆåˆ—è¡¨ / Failed Files List
| æª”æ¡ˆå / Filename | é”™è¯¯åŸå›  / Error Reason | é‡è¯•ç‹€æ…‹ / Retry Status |
|------------------|-----------------------|-----------------------|

### ğŸ¯ å“è³ªè©•ä¼° / Quality Assessment
| è©•ä¼°é¡¹ / Assessment Item | è¯„åˆ† / Score | å¤‡æ³¨ / Comments |
|------------------------|-------------|-----------------|
| **å…§å®¹å‡†ç¡®æ€§** | | |
| **æ ¼å¼ä¸€è‡´æ€§** | | |
| **å®Œæ•´æ€§** | | |
| **å®ç”¨æ€§** | | |

### ğŸ”„ å¾ŒçºŒè¡ŒåŠ¨ / Follow-up Actions
- [ ] æ‰‹å‹•è™•ç†å¤±è´¥æª”æ¡ˆ
- [ ] å“è³ªæª¢æŸ¥å’Œä¿®æ­£
- [ ] æ•´åˆçµæœåˆ°ä¸»å°ˆæ¡ˆ
- [ ] æ¸…ç†ä¸´æ—¶æª”æ¡ˆå’Œå‚™ä»½
# æ›´æ–°

</details>

---

## âš ï¸ æ³¨æ„äº‹é … / Important Notes

> [!warning] ğŸ”’ å®‰å…¨æé†’ / Security Reminder
# ä¿®æ”¹
> - å»ºè­°åœ¨æ¸¬è©¦ç’°å¢ƒå…ˆé‹è¡Œè…³æœ¬
> - ç›£æ§ç³»çµ±è³‡æºä½¿ç”¨ï¼Œé¿å…è¿‡è½½
> - å®šæœŸå„²å­˜ä¸­é—´çµæœ

# æ•ˆç‡
> - é¸æ“‡åˆé€‚çš„æ‰¹è™•ç†å¤§å°ï¼Œé¿å…è¨˜æ†¶é«”ä¸è¶³
> - æ ¹æ®ç¡¬é«”æ•ˆèƒ½è°ƒæ•´å¹¶å‘æ•°é‡
> - åœ¨ç©ºé—²æ™‚é–“æ‰§è¡Œå¤§å‹æ‰¹è™•ç†ä»»å‹™
> - ä½¿ç”¨screenæˆ–tmuxé˜²æ­¢ä¸­æ–­

> [!info] ğŸ“ˆ æ•ˆèƒ½ç›£æ§ / Performance Monitoring
> - ä½¿ç”¨`top`æˆ–`htop`ç›£æ§CPUå’Œè¨˜æ†¶é«”
> - ä½¿ç”¨`nvidia-smi`ç›£æ§GPUä½¿ç”¨æƒ…å†µ
# é…ç½®
> - è¨˜éŒ„æ¯æ¬¡æ‰¹è™•ç†çš„æ•ˆèƒ½æ•¸æ“š

---

## ğŸ”— ç›¸é—œè³‡æº / Related Resources

### ğŸ“– åƒè€ƒæ–‡æª”
# æŒ‡å—
- **[Shellè…³æœ¬æœ€ä½³å¯¦è¸](https://google.github.io/styleguide/shellguide.html)** - è…³æœ¬ç·¨å¯«è¦ç¯„
- **[Ollamaæ•ˆèƒ½å„ªåŒ–](https://github.com/ollama/ollama/blob/main/docs/faq.md)** - æ¨¡å‹å„ªåŒ–æŠ€å·§

### ğŸ› ï¸ å·¥å…·æ¨è
- **[GNU Parallel](https://www.gnu.org/software/parallel/)** - å¹¶è¡Œæ‰§è¡Œå·¥å…·
- **[jq](https://stedolan.github.io/jq/)** - JSONæ•¸æ“šè™•ç†
- **[ripgrep](https://github.com/BurntSushi/ripgrep)** - å¿«é€Ÿæª”æ¡ˆæœå°‹

---

*æ­¤æ‰¹è™•ç†æ¨¡æ¿åŸºäºOpenCode + Ollamaæœ€ä½³å¯¦è¸è¨­è¨ˆ / This batch processing template is designed based on OpenCode + Ollama best practices*