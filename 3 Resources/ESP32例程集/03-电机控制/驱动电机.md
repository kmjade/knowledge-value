---
title: 驱动电机
status: active
priority: medium
tags: [esp32/examples, pwm, motor]
aliases: [电机控制, PWM电机]
created: 2026-02-19
modified: 2026-02-19
source: https://www.yahboom.com/public/upload/upload-html/1706346807/%E9%A9%B1%E5%8A%A8%E7%94%B5%E6%9C%BA.html
related:
  - [[MicroROS机器人控制板]]
  - [[ESP32开发基础]]
---

# 驱动电机

> 使用microROS控制板的PWM输出，学习ESP32如何控制电机。

---

## 📋 目录

- [实验目的](#一实验目的)
- [硬件连接](#二硬件连接)
- [核心代码解析](#三核心代码解析)
- [编译下载烧录固件](#四编译下载烧录固件)
- [实验效果](#五实验效果)

---

## 一、实验目的

使用microROS控制板的PWM输出，学习ESP32如何控制电机。

---

## 二、硬件连接

如下图所示，microROS控制板集成了四路编码器电机控制接口，需要额外连接编码器电机，电机控制接口支持310电机，还需要把type-C数据线连接电脑与microROS控制板作为烧录固件功能。

![image-20240111152814048](https://www.yahboom.com/public/upload/upload-html/1706346807/image-20240111152814048.png)

四路电机接口分别对应名称为:左前轮->Motor1，左后轮->Motor2，右前轮->Motor3，右后轮->Motor4。

![image-20240111155522592](https://www.yahboom.com/public/upload/upload-html/1706346807/image-20240111155522592.png)

电机接口线序，在microROS控制板背面有详细线序丝印，这里以Motor1为例，M1+和M1-是控制电机转动的接口，GND和VCC是编码器的供电电路，H1A和H1B为编码器脉冲检测引脚。

![image-20240111160116671](https://www.yahboom.com/public/upload/upload-html/1706346807/image-20240111160116671.png)

> **注意**: 如果是使用亚博智能配套的310电机和电机线，白色线壳端连接到microROS控制板上的接口，黑色线壳端连接到310电机接口。

---

## 三、核心代码解析

程序源码对应的虚拟机路径为：

```
~/esp/Samples/esp32_samples/pwm_motor
```

在开始编写代码之前，需要先从ESP32库里导入bdc_motor组件，在pwm_motor组件里新建一个idf_component.yml文件，然后添加以下内容导入bdc_motor组件依赖。

```yaml
dependencies:
  bdc_motor: "^0.1.0"
```

### 初始化电机

由于四路电机的初始化过程类似，需要注意的是ESP32S3的定时器组最多驱动三路电机，所以电机Motor1、Motor2、Motor3使用定时器组0，电机Motor4使用定时器组1。这里以初始化电机Motor1为例。

首先初始化电机Motor1的GPIO M1A和M1B为PWM输出，频率为25KHz，选择定时器组0为电机Motor1的PWM输出定时器组。

```c
static void PwmMotor_Init_M1(void)
{
    bdc_motor_config_t motor_config = {
        .pwm_freq_hz = PWM_MOTOR_FREQ_HZ,
        .pwma_gpio_num = PWM_GPIO_M1B,
        .pwmb_gpio_num = PWM_GPIO_M1A,
    };

    bdc_motor_mcpwm_config_t mcpwm_config = {
        .group_id = PWM_MOTOR_TIMER_GROUP_ID_M1,
        .resolution_hz = PWM_MOTOR_TIMER_RESOLUTION_HZ,
    };

    bdc_motor_handle_t motor = NULL;
    ESP_ERROR_CHECK(bdc_motor_new_mcpwm_device(&motor_config, &mcpwm_config, &motor));
    ESP_ERROR_CHECK(bdc_motor_enable(motor));
    motor_m1 = motor;
}
```

### 控制电机速度

速度输入大于0表示车轮向前方向转，速度小于0表示车轮向后方向转，速度等于0表示电机停止。

```c
static void PwmMotor_Set_Speed_M1(int speed)
{
    speed = PwmMotor_Ignore_Dead_Zone(speed);
    speed = PwmMotor_Limit_Speed(speed);

    if (speed > 0) // forward
    {
        ESP_ERROR_CHECK(bdc_motor_forward(motor_m1));
        ESP_ERROR_CHECK(bdc_motor_set_speed(motor_m1, speed));
    }
    else if (speed < 0) // back
    {
        ESP_ERROR_CHECK(bdc_motor_reverse(motor_m1));
        ESP_ERROR_CHECK(bdc_motor_set_speed(motor_m1, -speed));
    }
    else // stop
    {
        if (stop_brake) ESP_ERROR_CHECK(bdc_motor_brake(motor_m1));
        else ESP_ERROR_CHECK(bdc_motor_coast(motor_m1));
    }
}
```

由于310电机的启动电压为3~5V，所以需要增加死区过滤，控制电机才更加敏捷。

---

## 四、编译下载烧录固件

> **注意**: 由于烧录完固件后，连接的电机会转动，请先将小车架空，避免小车在桌面乱动。

使用Type-C数据线连接虚拟机/电脑与microROS控制板，如果系统弹窗选择连接到虚拟机上。

激活ESP-IDF开发环境，注意每次打开新终端都需要先激活ESP-IDF开发环境才可以编译固件。

```bash
source ~/esp/esp-idf/export.sh
```

进入项目目录

```bash
cd ~/esp/Samples/esp32_samples/pwm_motor
```

编译、烧录、打开串口模拟器

```bash
idf.py build flash monitor
```

如果需要退出串口模拟器，请按**Ctrl+]**。

---

## 五、实验效果

串口模拟器打印"hello yahboom"欢迎词。将小车机器人架空后，观察小车的四路电机，先同时向前转1秒，再刹车停止1秒，然后向后转1秒，再滑行停止1秒，一直往复进行，同时在串口模拟器中也有打印当前的电机状态。

---

## 🔗 相关文档

- [[读取电机编码器数据]] - 编码器读取实验
- [[PID控制电机速度]] - PID速度控制
