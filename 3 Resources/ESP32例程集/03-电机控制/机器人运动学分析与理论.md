---
title: 机器人运动学分析与理论
status: active
priority: medium
tags: [esp32/examples, kinematics, theory]
aliases: [运动学分析, 机器人运动学]
created: 2026-02-19
modified: 2026-02-19
source: https://www.yahboom.com/public/upload/upload-html/1706346845/%E6%9C%BA%E5%99%A8%E4%BA%BA%E8%BF%90%E5%8A%A8%E5%AD%A6%E5%88%86%E6%9E%90%E7%90%86%E8%AE%BA.html
related:
  - [[MicroROS机器人控制板]]
  - [[机器人控制笔记]]
---

# 机器人运动学分析与理论

> 使用microROS控制板的编码电机接口，学习ESP32控制机器人小车运动，分析小车的运动学方程。

---

## 📋 目录

- [实验目的](#一实验目的)
- [硬件连接](#二硬件连接)
- [建立运动学模型](#三建立运动学模型)
- [核心代码解析](#四核心代码解析)
- [编译下载烧录固件](#五编译下载烧录固件)
- [实验效果](#六实验效果)

---

## 一、实验目的

使用microROS控制板的编码电机接口，学习ESP32控制机器人小车运动，分析小车的运动学方程。由于真实车子存在结构误差，在运动过程中会阻力和摩擦力等因素，较为复杂，简单起见，这里仅局限于四轮小车处于理想状态下做分析。

---

## 二、硬件连接

如下图所示，microROS控制板集成了四路编码器电机控制接口，需要额外连接编码器电机，电机控制接口支持310电机，还需要把type-C数据线连接电脑与microROS控制板作为烧录固件功能。

![image-20240111152814048](https://www.yahboom.com/public/upload/upload-html/1706346845/image-20240111152814048.png)

四路电机接口分别对应名称为:左前轮->Motor1，左后轮->Motor2，右前轮->Motor3，右后轮->Motor4。

---

## 三、建立运动学模型

将四驱小车抽象为下图模型，其中W表示左右电机中心点的间隔；L表示前后电机中心点的间隔；电机M1、M2、M3、M4表示小车的四个驱动电机；V表示小车的线速度（前进后退速度），ω表示小车角速度（旋转速度）。

理想状态下是通过控制线速度V和角速度ω，转化成控制四个电机，从而控制四驱小车运动。

![image-20240115180047937](https://www.yahboom.com/public/upload/upload-html/1706346845/image-20240115180047937.png)

### 运动学方程

设Vm1，Vm2，Vm3，Vm4为电机M1、M2、M3、M4的速度值，也就是轮子的转速，Vx为小车线速度,Vx为正表示向前，Vx为负表示向后，Vz为小车角速度，Vz为正表示向左，Vz为负表示向右，A为小车左右电机中心点距离W的一半A=W2，B为小车前后电机中心点的距离L的一半B=L2。

当小车前进或者后退时：
```
Vm1 = Vx
Vm2 = Vx
Vm3 = Vx
Vm4 = Vx
```

小车绕几何中心点自转时：
```
Vm1 = -Vz*(A+B)
Vm2 = -Vz*(A+B)
Vm3 = Vz*(A+B)
Vm4 = Vz*(A+B)
```

根据以上公式，我们就可以得到：
```
Vm1 = Vx - Vz*(A+B)
Vm2 = Vx - Vz*(A+B)
Vm3 = Vx + Vz*(A+B)
Vm4 = Vx + Vz*(A+B)
```

---

## 四、核心代码解析

程序源码对应的虚拟机路径为：

```
~/esp/Samples/esp32_samples/car_motion
```

### 运动学控制函数

根据机器人运动学模型分析，得到控制机器人的函数。V_x表示控制线速度[-1.0, 1.0]，V_y无效，V_z表示控制角速度[-5.0, 5.0]。

```c
void Motion_Ctrl(float V_x, float V_y, float V_z)
{
    line_v = V_x;
    angular_v = V_z;
    speed_L1_setup = line_v - angular_v * ROBOT_APB;
    speed_L2_setup = line_v - angular_v * ROBOT_APB;
    speed_R1_setup = line_v + angular_v * ROBOT_APB;
    speed_R2_setup = line_v + angular_v * ROBOT_APB;
    Motor_Set_Speed(speed_L1_setup, speed_L2_setup, speed_R1_setup, speed_R2_setup);
}
```

### 读取运动学速度

通过读取四个电机的速度，从而计算出机器人的运动学速度。

```c
void Motion_Get_Speed(car_motion_t* car)
{
    float speed_m1 = 0, speed_m2 = 0, speed_m3 = 0, speed_m4 = 0;
    Motor_Get_Speed(&speed_m1, &speed_m2, &speed_m3, &speed_m4);

    car->Vx = (speed_m1 + speed_m2 + speed_m3 + speed_m4) / 4;
    car->Vy = 0;
    car->Wz = -(speed_m1 + speed_m2 - speed_m3 - speed_m4) / 4.0f / ROBOT_APB;

    if(car->Wz == 0) car->Wz = 0;
}
```

---

## 五、编译下载烧录固件

> **注意**: 由于烧录完固件后，连接的电机会转动，请先将小车架空，避免小车在桌面乱动。

使用Type-C数据线连接虚拟机/电脑与microROS控制板，如果系统弹窗选择连接到虚拟机上。

激活ESP-IDF开发环境，注意每次打开新终端都需要先激活ESP-IDF开发环境才可以编译固件。

```bash
source ~/esp/esp-idf/export.sh
```

进入项目目录

```bash
cd ~/esp/Samples/esp32_samples/car_motion
```

编译、烧录、打开串口模拟器

```bash
idf.py build flash monitor
```

如果需要退出串口模拟器，请按**Ctrl+]**。

---

## 六、实验效果

串口模拟器打印"hello yahboom"欢迎词。此时会每间隔100毫秒打印一次小车的速度值。并且小车开始按照预设的速度运动，`Motion_Ctrl(0.5, 0, 0)`为调节速度的函数，可根据实际需求调节小车运动速度。理论上小车速度与实际设置会存在一定误差，如果读取的速度和设置的速度差别不大，则表示电机正常。小车运动5秒后自动停止，如需要让电机再次运动，请按一下microROS控制板的复位按键。

![image-20240115184355402](https://www.yahboom.com/public/upload/upload-html/1706346845/image-20240115184355402.png)

---

## 🔗 相关文档

- [[机器人控制笔记]] - 机器人控制理论
- [[PID控制电机速度]] - PID速度控制
