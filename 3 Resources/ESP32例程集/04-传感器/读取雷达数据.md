---
title: è¯»å–é›·è¾¾æ•°æ®
status: active
priority: medium
tags: [esp32/examples, lidar, sensor]
aliases: [é›·è¾¾è¯»å–, MS200æ¿€å…‰é›·è¾¾]
created: 2026-02-19
modified: 2026-02-19
source: https://www.yahboom.com/public/upload/upload-html/1706346880/%E8%AF%BB%E5%8F%96%E9%9B%B7%E8%BE%BE%E6%95%B0%E6%8D%AE.html
related:
  - [[MicroROSæœºå™¨äººæ§åˆ¶æ¿]]
  - [[è¯»å–IMUæ•°æ®]]
---

# è¯»å–é›·è¾¾æ•°æ®

> ä½¿ç”¨microROSæ§åˆ¶æ¿çš„é›·è¾¾æ¥å£ï¼Œå­¦ä¹ ESP32é€šè¿‡ä¸²å£1è¯»å–MS200æ¿€å…‰é›·è¾¾çš„æ•°æ®ï¼Œå¹¶è§£æé›·è¾¾æ•°æ®åŒ…ã€‚

---

## ğŸ“‹ ç›®å½•

- [å®éªŒç›®çš„](#ä¸€å®éªŒç›®çš„)
- [ç¡¬ä»¶è¿æ¥](#äºŒç¡¬ä»¶è¿æ¥)
- [æ ¸å¿ƒä»£ç è§£æ](#ä¸‰æ ¸å¿ƒä»£ç è§£æ)
- [ç¼–è¯‘ä¸‹è½½çƒ§å½•å›ºä»¶](#å››ç¼–è¯‘ä¸‹è½½çƒ§å½•å›ºä»¶)
- [å®éªŒæ•ˆæœ](#äº”å®éªŒæ•ˆæœ)

---

## ä¸€ã€å®éªŒç›®çš„

ä½¿ç”¨microROSæ§åˆ¶æ¿çš„é›·è¾¾æ¥å£ï¼Œå­¦ä¹ ESP32é€šè¿‡ä¸²å£1è¯»å–MS200æ¿€å…‰é›·è¾¾çš„æ•°æ®ï¼Œå¹¶è§£æé›·è¾¾æ•°æ®åŒ…ã€‚

---

## äºŒã€ç¡¬ä»¶è¿æ¥

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒmicroROSæ§åˆ¶æ¿é›†æˆäº†MS200æ¿€å…‰é›·è¾¾æ¥å£ï¼Œéœ€è¦å°†MS200æ¿€å…‰é›·è¾¾çš„æ’çº¿è¿æ¥åˆ°microROSæ§åˆ¶æ¿å’Œæ¿€å…‰é›·è¾¾ä¸Šï¼Œè¿˜éœ€è¦æŠŠtype-Cæ•°æ®çº¿è¿æ¥ç”µè„‘ä¸microROSæ§åˆ¶æ¿ä½œä¸ºçƒ§å½•å›ºä»¶åŠŸèƒ½ã€‚

![image-20240112163507890](https://www.yahboom.com/public/upload/upload-html/1706346880/image-20240112163507890.png)

MS200æ¿€å…‰é›·è¾¾æ¥å£æ’çº¿å…·æœ‰é˜²åæ¥åŠŸèƒ½ï¼Œç›´æ¥å¯¹å‡†æ¥å£æ’å…¥å³å¯ã€‚

![image-20240112173042656](https://www.yahboom.com/public/upload/upload-html/1706346880/image-20240112173042656.png)

---

## ä¸‰ã€æ ¸å¿ƒä»£ç è§£æ

ç¨‹åºæºç å¯¹åº”çš„è™šæ‹Ÿæœºè·¯å¾„ä¸ºï¼š

```
~/esp/Samples/esp32_samples/read_lidar
```

### ä¸²å£åˆå§‹åŒ–

ç”±äºMS200æ¿€å…‰é›·è¾¾ä½¿ç”¨çš„æ˜¯ä¸²å£é€šè®¯ï¼Œè¿™é‡Œé€‰æ‹©ESP32S3çš„ä¸²å£1ä¸MS200æ¿€å…‰é›·è¾¾é€šè®¯ã€‚ä¸²å£1çš„UART1_GPIO_TXDå¯¹åº”ç¡¬ä»¶GPIO17ï¼Œä¸²å£1çš„UART1_GPIO_RXDå¯¹åº”ç¡¬ä»¶GPIO18ï¼Œæ³¢ç‰¹ç‡è®¾ç½®ä¸º230400ã€‚

```c
void Uart1_Init(void)
{
    const uart_config_t uart_config = {
        .baud_rate = 230400,
        .data_bits = UART_DATA_8_BITS,
        .parity = UART_PARITY_DISABLE,
        .stop_bits = UART_STOP_BITS_1,
        .flow_ctrl = UART_HW_FLOWCTRL_DISABLE,
        .source_clk = UART_SCLK_DEFAULT,
    };

    uart_driver_install(UART_NUM_1, RX1_BUF_SIZE * 2, 0, 0, NULL, 0);
    uart_param_config(UART_NUM_1, &uart_config);
    uart_set_pin(UART_NUM_1, UART1_GPIO_TXD, UART1_GPIO_RXD, UART_PIN_NO_CHANGE, UART_PIN_NO_CHANGE);

    RingBuffer_Init(&uart1_ringbuf, RX1_BUF_SIZE);
    xTaskCreate(Uart1_Rx_Task, "Uart1_Rx_Task", 5*1024, NULL, configMAX_PRIORITIES, NULL);
}
```

### MS200æ¿€å…‰é›·è¾¾æ•°æ®è§£æ

MS200æ¿€å…‰é›·è¾¾æ ¹æ®æ¥æ”¶åˆ°çš„åè®®æ•°æ®ï¼Œè§£æç‚¹äº‘æ•°æ®åŒ…ã€‚

```c
static int Ms200_Parse_Package(uint8_t* protocol_buf, ms200_package_t* out_pkg)
{
    uint8_t buf_len = (protocol_buf[1] & 0x1F) * 3 + 11;
    uint8_t check_num = protocol_buf[buf_len-1];
    uint8_t crc8 = Ms200_Calculate_CRC8(protocol_buf, buf_len-1);

    if (crc8 != check_num)
    {
        YB_DEBUG(TAG, "CRC Error:%d, %d", crc8, check_num);
        return ESP_FAIL;
    }

    out_pkg->header = protocol_buf[0];
    out_pkg->count = protocol_buf[1] & 0x1F;
    out_pkg->speed = (protocol_buf[3] << 8) | protocol_buf[2];
    out_pkg->start_angle = (protocol_buf[5] << 8) | protocol_buf[4];
    out_pkg->end_angle = (protocol_buf[buf_len-4] << 8) | protocol_buf[buf_len-5];
    out_pkg->time_stamp = (protocol_buf[buf_len-2] << 8) | protocol_buf[buf_len-3];
    out_pkg->crc8 = protocol_buf[buf_len-1];

    for (int i = 0; i < MS200_POINT_PER_PACK; i++)
    {
        out_pkg->points[i].distance = (protocol_buf[3*i+7] << 8) | protocol_buf[3*i+6];
        out_pkg->points[i].intensity = protocol_buf[3*i+8];
    }

    return ESP_OK;
}
```

### è¯»å–é›·è¾¾è·ç¦»æ•°æ®

è¯»å–MS200æ¿€å…‰é›·è¾¾æŸä¸ªç‚¹æ£€æµ‹åˆ°çš„è·ç¦»ï¼Œå•ä½ä¸ºæ¯«ç±³ã€‚

```c
uint16_t Lidar_Ms200_Get_Distance(uint16_t point)
{
    if (point < MS200_POINT_MAX)
    {
        return lidar_data.points[point].distance;
    }
    return 0;
}
```

---

## å››ã€ç¼–è¯‘ä¸‹è½½çƒ§å½•å›ºä»¶

ä½¿ç”¨Type-Cæ•°æ®çº¿è¿æ¥è™šæ‹Ÿæœº/ç”µè„‘ä¸microROSæ§åˆ¶æ¿ï¼Œå¦‚æœç³»ç»Ÿå¼¹çª—é€‰æ‹©è¿æ¥åˆ°è™šæ‹Ÿæœºä¸Šã€‚

æ¿€æ´»ESP-IDFå¼€å‘ç¯å¢ƒï¼Œæ³¨æ„æ¯æ¬¡æ‰“å¼€æ–°ç»ˆç«¯éƒ½éœ€è¦å…ˆæ¿€æ´»ESP-IDFå¼€å‘ç¯å¢ƒæ‰å¯ä»¥ç¼–è¯‘å›ºä»¶ã€‚

```bash
source ~/esp/esp-idf/export.sh
```

è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd ~/esp/Samples/esp32_samples/read_lidar
```

ç¼–è¯‘ã€çƒ§å½•ã€æ‰“å¼€ä¸²å£æ¨¡æ‹Ÿå™¨

```bash
idf.py build flash monitor
```

å¦‚æœéœ€è¦é€€å‡ºä¸²å£æ¨¡æ‹Ÿå™¨ï¼Œè¯·æŒ‰**Ctrl+]**ã€‚

---

## äº”ã€å®éªŒæ•ˆæœ

ä¸²å£æ¨¡æ‹Ÿå™¨æ‰“å°"hello yahboom"æ¬¢è¿è¯ã€‚å¹¶ä¸”æ¯200æ¯«ç§’æ‰“å°MS200æ¿€å…‰é›·è¾¾0åº¦ï¼Œ90åº¦ï¼Œ180åº¦ï¼Œ270åº¦å››ä¸ªæ–¹å‘æ£€æµ‹åˆ°çš„è·ç¦»ã€‚å…¶ä¸­ï¼ŒMS200æ¿€å…‰é›·è¾¾ç®­å¤´æŒ‡ç¤ºçš„æ–¹å‘ä¸º0åº¦ï¼Œé¡ºæ—¶é’ˆæ–¹å‘è§’åº¦å¢åŠ ã€‚æ­¤æ—¶å¯å°†æ‰‹æŒ¡ä½å…¶ä¸­æŸä¸ªæ–¹å‘ï¼Œè§‚å¯Ÿå…¶æ•°å€¼å˜åŒ–ã€‚

![image-20240116145434323](https://www.yahboom.com/public/upload/upload-html/1706346880/image-20240116145434323.png)

![image-20240112173837427](https://www.yahboom.com/public/upload/upload-html/1706346880/image-20240112173837427.png)

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [[è¯»å–IMUæ•°æ®]] - IMUæ•°æ®è¯»å–
- [[æœºå™¨äººæ§åˆ¶ç¬”è®°]] - æœºå™¨äººæ§åˆ¶ç†è®º
