---
title: ä¸²å£é€šè®¯
status: active
priority: medium
tags: [esp32/examples, uart, communication]
aliases: [UARTé€šè®¯, ä¸²å£å®žéªŒ]
created: 2026-02-19
modified: 2026-02-19
source: https://www.yahboom.com/public/upload/upload-html/1706346767/%E4%B8%B2%E5%8F%A3%E9%80%9A%E8%AE%AF.html
related:
  - [[MicroROSæœºå™¨äººæŽ§åˆ¶æ¿]]
  - [[ESP32å¼€å‘åŸºç¡€]]
---

# ä¸²å£é€šè®¯

> ä½¿ç”¨microROSæŽ§åˆ¶æ¿ä¸Šä¸²å£ï¼Œå­¦ä¹ ä¸²å£å¦‚ä½•æŽ¥æ”¶å’Œå‘é€æ•°æ®ã€‚

---

## ðŸ“‹ ç›®å½•

- [å®žéªŒç›®çš„](#ä¸€å®žéªŒç›®çš„)
- [ç¡¬ä»¶è¿žæŽ¥](#äºŒç¡¬ä»¶è¿žæŽ¥)
- [æ ¸å¿ƒä»£ç è§£æž](#ä¸‰æ ¸å¿ƒä»£ç è§£æž)
- [ç¼–è¯‘ä¸‹è½½çƒ§å½•å›ºä»¶](#å››ç¼–è¯‘ä¸‹è½½çƒ§å½•å›ºä»¶)
- [å®žéªŒæ•ˆæžœ](#äº”å®žéªŒæ•ˆæžœ)

---

## ä¸€ã€å®žéªŒç›®çš„

ä½¿ç”¨microROSæŽ§åˆ¶æ¿ä¸Šä¸²å£ï¼Œå­¦ä¹ ä¸²å£å¦‚ä½•æŽ¥æ”¶å’Œå‘é€æ•°æ®ã€‚

---

## äºŒã€ç¡¬ä»¶è¿žæŽ¥

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCP2102ä¸²å£ä¸ºæ¿è½½å…ƒå™¨ä»¶ï¼Œå°†ä¸²å£ä¿¡å·è½¬åŒ–æˆUSBä¿¡å·ï¼Œéœ€è¦æŠŠtype-Cæ•°æ®çº¿è¿žæŽ¥ç”µè„‘ä¸ŽmicroROSæŽ§åˆ¶æ¿ä½œä¸ºçƒ§å½•å›ºä»¶å’Œä¸²å£é€šè®¯åŠŸèƒ½ã€‚

![image-20240110155801868](https://www.yahboom.com/public/upload/upload-html/1706346767/image-20240110155801868.png)

![image-20240110155902449](https://www.yahboom.com/public/upload/upload-html/1706346767/image-20240110155902449.png)

---

## ä¸‰ã€æ ¸å¿ƒä»£ç è§£æž

ç¨‹åºæºç å¯¹åº”çš„è™šæ‹Ÿæœºè·¯å¾„ä¸ºï¼š

```
~/esp/Samples/esp32_samples/uart
```

ç”±äºŽä¸²å£0ä¸Žä¸²å£1ä½¿ç”¨æ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«åœ¨äºŽå¼•è„šä¸åŒï¼Œä¸²å£1çš„UART1_GPIO_TXDå¯¹åº”ç¡¬ä»¶GPIO17ï¼ŒUART1_GPIO_RXDå¯¹åº”ç¡¬ä»¶GPIO18ã€‚ç”±äºŽä¸²å£1ç”¨äºŽæ¿€å…‰é›·è¾¾é€šè®¯ï¼Œæ‰€ä»¥æ³¢ç‰¹çŽ‡è®¾ç½®ä¸º230400ï¼Œè€Œä¸²å£0ç”¨äºŽé€šè®¯ä½¿ç”¨æ³¢ç‰¹çŽ‡ä¸º115200ã€‚

è¿™é‡Œä»¥ä¸²å£0ä¸ºä¾‹ã€‚

### åˆå§‹åŒ–ä¸²å£0

å…¶ä¸­UART0_GPIO_TXDå¯¹åº”ç¡¬ä»¶GPIO43ï¼ŒUART0_GPIO_RXDå¯¹åº”ç¡¬ä»¶GPIO44ï¼Œè®¾ç½®ä¸²å£0æ³¢ç‰¹çŽ‡ä¸º115200ï¼Œ8ä½æ•°æ®ï¼Œ1ä½åœæ­¢ï¼Œæ— å¥‡å¶æ ¡éªŒã€‚åŒæ—¶åˆå§‹åŒ–ä¸²å£0çš„æŽ¥æ”¶ç¼“å­˜ringbufferå’Œæ‰“å¼€ä¸²å£0æŽ¥æ”¶åŽå°ä»»åŠ¡ã€‚

```c
void Uart0_Init(void)
{
    const uart_config_t uart_config = {
        .baud_rate = 115200,
        .data_bits = UART_DATA_8_BITS,
        .parity = UART_PARITY_DISABLE,
        .stop_bits = UART_STOP_BITS_1,
        .flow_ctrl = UART_HW_FLOWCTRL_DISABLE,
        .source_clk = UART_SCLK_DEFAULT,
    };

    uart_driver_install(UART_NUM_0, RX0_BUF_SIZE * 2, 0, 0, NULL, 0);
    uart_param_config(UART_NUM_0, &uart_config);
    uart_set_pin(UART_NUM_0, UART0_GPIO_TXD, UART0_GPIO_RXD, UART_PIN_NO_CHANGE, UART_PIN_NO_CHANGE);

    RingBuffer_Init(&uart0_ringbuf, RX0_BUF_SIZE);
    xTaskCreate(Uart0_Rx_Task, "Uart0_Rx_Task", 5*1024, NULL, configMAX_PRIORITIES, NULL);
}
```

### ä¸²å£0åŽå°æŽ¥æ”¶ä»»åŠ¡

ä¸»è¦æ˜¯æŠŠæŽ¥æ”¶åˆ°çš„ä¸²å£æ•°æ®ç¼“å­˜èµ·æ¥ï¼Œå­˜å…¥ringbufferé‡Œé¢ï¼Œå¯ä»¥åšåˆ°æ•°æ®å…ˆè¿›å…ˆå‡ºçš„åŠŸèƒ½ã€‚

```c
static void Uart0_Rx_Task(void *arg)
{
    ESP_LOGI(TAG, "Start Uart0_Rx_Task with core:%d", xPortGetCoreID());
    uint16_t temp_len = 255;
    uint8_t* temp_data = (uint8_t*) malloc(temp_len);

    while (1)
    {
        // ä»Žä¸²å£0è¯»å–æ•°æ®ï¼Œå¹¶å°†è¯»å–çš„æ•°æ®ç¼“å­˜åˆ°ringbufferé‡Œã€‚
        const int rxBytes = uart_read_bytes(UART_NUM_0, temp_data, temp_len, 1 / portTICK_PERIOD_MS);

        if (rxBytes > 0)
        {
            for (int i = 0; i < rxBytes; i++)
            {
                RingBuffer_Push(&uart0_ringbuf, temp_data[i]);
            }
        }

        vTaskDelay(pdMS_TO_TICKS(1));
    }

    free(temp_data);
    vTaskDelete(NULL);
}
```

### ä¸²å£å‘é€æ•°æ®

```c
int Uart0_Send_Data(uint8_t* data, uint16_t len)
{
    const int txBytes = uart_write_bytes(UART_NUM_0, data, len);
    return txBytes;
}

int Uart0_Send_Byte(uint8_t data)
{
    uint8_t data1 = data;
    const int txBytes = uart_write_bytes(UART_NUM_0, &data1, 1);
    return txBytes;
}
```

### è¯»å–ä¸²å£ç¼“å­˜æ•°æ®

```c
uint16_t Uart0_Available(void)
{
    return RingBuffer_Get_Used_Count(&uart0_ringbuf);
}

uint8_t Uart0_Read(void)
{
    return RingBuffer_Pop(&uart0_ringbuf);
}

void Uart0_Clean_Buffer(void)
{
    RingBuffer_Clean_Queue(&uart0_ringbuf);
}
```

---

## å››ã€ç¼–è¯‘ä¸‹è½½çƒ§å½•å›ºä»¶

ä½¿ç”¨Type-Cæ•°æ®çº¿è¿žæŽ¥è™šæ‹Ÿæœº/ç”µè„‘ä¸ŽmicroROSæŽ§åˆ¶æ¿ï¼Œå¦‚æžœç³»ç»Ÿå¼¹çª—é€‰æ‹©è¿žæŽ¥åˆ°è™šæ‹Ÿæœºä¸Šã€‚

æ¿€æ´»ESP-IDFå¼€å‘çŽ¯å¢ƒï¼Œæ³¨æ„æ¯æ¬¡æ‰“å¼€æ–°ç»ˆç«¯éƒ½éœ€è¦å…ˆæ¿€æ´»ESP-IDFå¼€å‘çŽ¯å¢ƒæ‰å¯ä»¥ç¼–è¯‘å›ºä»¶ã€‚

```bash
source ~/esp/esp-idf/export.sh
```

è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd ~/esp/Samples/esp32_samples/uart
```

ç¼–è¯‘ã€çƒ§å½•ã€æ‰“å¼€ä¸²å£æ¨¡æ‹Ÿå™¨

```bash
idf.py build flash monitor
```

å¦‚æžœéœ€è¦é€€å‡ºä¸²å£æ¨¡æ‹Ÿå™¨ï¼Œè¯·æŒ‰**Ctrl+]**ã€‚

---

## äº”ã€å®žéªŒæ•ˆæžœ

ä¸²å£æ¨¡æ‹Ÿå™¨æ‰“å°"hello yahboom"æ¬¢è¿Žè¯ã€‚æ­¤æ—¶æŒ‰Ctrl+]é€€å‡ºä¸²å£æ¨¡æ‹Ÿå™¨ã€‚

![image-20240110202524419](https://www.yahboom.com/public/upload/upload-html/1706346767/image-20240110202524419.png)

é‡æ–°æ’æ‹”microROSæŽ§åˆ¶æ¿çš„Type-Cä¸²å£çº¿ï¼Œç„¶åŽé€‰æ‹©è¿žæŽ¥åˆ°ä¸»æœºã€‚

æˆ–è€…åœ¨è™šæ‹Ÿæœºè½¯ä»¶çš„å³ä¸Šè§’æ‰¾åˆ°CP2102çš„è®¾å¤‡å›¾æ ‡ï¼Œå³é”®é€‰æ‹©æ–­å¼€è¿žæŽ¥(è¿žæŽ¥åˆ°ä¸»æœº)ã€‚

æ­¤æ—¶microROSæŽ§åˆ¶æ¿è¿žæŽ¥åˆ°ä¸»æœºä¸Šï¼Œæ‰“å¼€ä¸»æœºçš„ä¸²å£è°ƒè¯•åŠ©æ‰‹ã€‚

æœç´¢CP2102çš„è®¾å¤‡å·å¹¶æ‰“å¼€ä¸²å£ï¼Œæ³¢ç‰¹çŽ‡ä¸º115200ï¼Œ8ä½æ•°æ®ï¼Œ1ä½åœæ­¢ï¼Œæ— æ ¡éªŒï¼Œæ— æµæŽ§åˆ¶ã€‚åœ¨æŽ¥æ”¶è®¾ç½®å’Œå‘é€è®¾ç½®é‡Œé€‰æ‹©ASCIIå­—ç¬¦æ¨¡å¼ã€‚ç„¶åŽåœ¨å‘é€æ¡†è¾“å…¥ä»»æ„å­—ç¬¦ï¼Œç„¶åŽæŒ‰å‘é€ï¼Œä¸²å£ä¼šå°†æŽ¥æ”¶åˆ°çš„å­—ç¬¦åˆå‘é€å›žæ¥ã€‚ä»Žè€Œå®žçŽ°ä¸²å£è‡ªå‘è‡ªæ”¶çš„åŠŸèƒ½ã€‚

![image-20240118180423413](https://www.yahboom.com/public/upload/upload-html/1706346767/image-20240118180423413.png)

å®žéªŒç»“æŸåŽè¯·ç‚¹å‡»å…³é—­ä¸²å£ã€‚

---

## ðŸ”— ç›¸å…³æ–‡æ¡£

- [[ESP32å¼€å‘åŸºç¡€]] - ESP32åŸºç¡€æ•™ç¨‹
- [[3 Resources/01-Tech/MicroROSæœºå™¨äººæŽ§åˆ¶æ¿]] - äº§å“ä¸»é¡µ
