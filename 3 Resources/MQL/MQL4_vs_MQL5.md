# MQL4 vs MQL5 主要差異

MQL5 並非 MQL4 的簡單升級，而是一門經過重新設計的語言。兩者在語法、交易系統和功能上存在顯著差異。

## 總覽比較表

| 特性 | MQL4 | MQL5 |
| :--- | :--- | :--- |
| **語法基礎** | 類 C 語言，程序化 | C++ 風格，完全支援物件導向 (OOP) |
| **倉位系統** | 一個訂單即一個倉位 | 區分訂單、交易和倉位；支援單邊 (Netting) 和鎖倉 (Hedging) |
| **資料結構** | 簡單資料類型 | 引入了類和結構體，更加靈活 |
| **交易執行** | `OrderSend()` 直接發送訂單 | `OrderSend()` 發送請求，或使用 `CTrade` 交易類進行操作 |
| **市場深度 (DOM)** | 不支援 | 原生支援，可獲取 Level 2 市場數據 |
| **指標調用** | `iMA()`, `iRSI()` 等 | `iMA()`, `iRSI()` 等，但返回指標句柄，需配合 `CopyBuffer()` 使用 |
| **測試與優化** | 單線程測試 | 強大的多線程、多分佈式測試器，支援多品種同時測試 |
| **事件處理** | 有限的事件模型 | 擴展的事件模型 (`OnTrade`, `OnTimer`, `OnChartEvent` 等) |
| **時間框架** | 9 個標準時間框架 | 21 個標準時間框架，並支援自定義時間框架 |

## 詳細差異解析

### 1. 語法與物件導向 (OOP)
- **MQL4**: 語法類似於 C 語言，主要進行程序化編程。雖然可以模擬一些 OOP 概念，但並非原生支援。
- **MQL5**: 完全擁抱 C++ 的物件導向特性，支援類、繼承、多型、封裝和模板。這使得代碼結構更清晰、可重用性更高。

### 2. 交易系統與訂單管理
- **MQL4**: 系統相對簡單，每個 `OrderSend()` 會創建一個獨立的訂單（倉位）。管理多個訂單需要遍歷訂單池。
- **MQL5**: 引入了更複雜的系統，將 **訂單 (Order)**、**交易 (Deal/Trade)** 和 **倉位 (Position)** 分開。
    - **Position**: 當前市場上的淨持倉。
    - **Order**: 發送到伺服器的請求（如掛單）。
    - **Deal**: 實際執行的成交記錄。
    - 這種分離在 `Netting` 模式下尤為重要，但在 `Hedging` 模式下，其行為更接近 MQL4。

### 3. 指標數據的獲取
- **MQL4**: `iMA()` 等函數直接返回計算出的指標值。
- **MQL5**: `iMA()` 等函數返回一個 **指標句柄 (handle)**。你需要使用 `CopyBuffer()` 函數，通過這個句柄將指定緩衝區（如 MACD 的主線或信號線）的數據複製到一個陣列中，然後再使用。這種方式更加靈活和高效。

### 4. 策略測試器
- **MQL5** 的策略測試器遠比 MQL4 強大。它支援多線程，可以利用多核 CPU 大幅縮短優化時間。此外，它還支援多品種同步測試和更真實的模擬環境。
